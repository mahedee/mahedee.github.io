<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="https://mahedee.net//feed.xml" rel="self" type="application/atom+xml" /><link href="https://mahedee.net//" rel="alternate" type="text/html" /><updated>2024-12-22T16:51:41-05:00</updated><id>https://mahedee.net//feed.xml</id><title type="html">Think Simple</title><subtitle>Think Simple</subtitle><author><name>Mahedee Hasan</name></author><entry><title type="html">Leveraging the Observer Design Pattern : 10 Real-World Examples in Action</title><link href="https://mahedee.net//leveraging_the_observer_design_pattern_10_real_world_examples_in_action/" rel="alternate" type="text/html" title="Leveraging the Observer Design Pattern : 10 Real-World Examples in Action" /><published>2024-11-01T00:00:00-04:00</published><updated>2024-11-01T00:00:00-04:00</updated><id>https://mahedee.net//leveraging_the_observer_design_pattern_10_real_world_examples_in_action</id><content type="html" xml:base="https://mahedee.net//leveraging_the_observer_design_pattern_10_real_world_examples_in_action/"><![CDATA[<p>The Observer Design Pattern is a behavioral design pattern that allows an object (the <strong>subject</strong>) to notify multiple dependent objects (the <strong>observers</strong>) about changes in its state without knowing who or what those observers are. This pattern is widely used in software systems that require real-time updates or notifications. In this article, we will explore 10 real-world applications where the Observer Pattern is used to enable real-time communication, updates, or notifications.</p>

<p><strong>1. Social Media Notifications</strong></p>

<p><strong>Description:</strong>
Social media platforms, such as Facebook, Twitter, and Instagram, notify users of likes, comments, shares, and messages. These notifications keep users engaged and informed of activities on their posts and accounts they follow.</p>

<p><strong>Observer:</strong>
Users who follow posts, pages, or accounts and receive updates about activities on them.</p>

<p><strong>Subject:</strong>
Posts, accounts, or events that trigger notifications.</p>

<p><strong>How It Works:</strong>
When a user subscribes to a post or account, the system treats them as observers. When an activity (like, comment, share) occurs on the post, the platform (subject) notifies all the users observing it.</p>

<p><strong>2. Chat Applications</strong></p>

<p><strong>Description:</strong>
Messaging platforms, like WhatsApp and Slack, send real-time notifications to users when they receive new messages or mentions. This allows users to stay up-to-date with conversations even when they aren’t actively looking at the app.</p>

<p><strong>Observer:</strong>
Members of a chat group or users in a direct message thread.</p>

<p><strong>Subject:</strong>
The chat group or message thread where new messages are posted.</p>

<p><strong>How It Works:</strong>
Users subscribe to chat groups or message threads. When a new message is posted, the system (subject) notifies all users observing that group or conversation.</p>

<p><strong>3. Online Shopping and Stock Alerts</strong></p>

<p><strong>Description:</strong>
E-commerce platforms such as Amazon and eBay use the Observer Pattern to notify users about price changes, product restocks, or special promotions.</p>

<p><strong>Observer:</strong>
Customers who subscribe to updates for specific products.</p>

<p><strong>Subject:</strong>
The product or offer being tracked by the customer.</p>

<p><strong>How It Works:</strong>
Customers subscribe to specific products, and when any change occurs (e.g., price drop, availability), the platform (subject) notifies all users who have subscribed to that product.</p>

<p><strong>4. Event-Driven Monitoring Systems</strong></p>

<p><strong>Description:</strong>
IT infrastructure monitoring tools, such as Nagios and Datadog, monitor various metrics (e.g., server uptime, CPU usage, or disk space) and alert system administrators when an issue arises.</p>

<p><strong>Observer:</strong>
System administrators or monitoring teams who need real-time alerts.</p>

<p><strong>Subject:</strong>
The monitored system or resource, such as a server or application.</p>

<p><strong>How It Works:</strong>
The system (subject) tracks key metrics (e.g., CPU usage). If the metric crosses a predefined threshold, the system triggers a notification to all observers (admins) who are subscribed to the metric.</p>

<p><strong>5. News Feed Subscriptions</strong></p>

<p><strong>Description:</strong>
News platforms like Google News, BBC, and CNN allow users to follow specific topics, authors, or categories. When a new article is published under a subscribed category or by a followed author, users are notified immediately.</p>

<p><strong>Observer:</strong>
Users who subscribe to categories or authors.</p>

<p><strong>Subject:</strong>
Articles or content within a specific category or published by a specific author.</p>

<p><strong>How It Works:</strong>
When new content is published, the platform (subject) sends real-time updates to all users who are observing the particular topic or author.</p>

<p><strong>6. Gaming Leaderboards</strong></p>

<p><strong>Description:</strong>
Online games, like Fortnite or PUBG, notify players of leaderboard changes, upcoming challenges, or rewards.</p>

<p><strong>Observer:</strong>
Players who track the game’s leaderboard or their in-game performance.</p>

<p><strong>Subject:</strong>
The game’s leaderboard or event system.</p>

<p><strong>How It Works:</strong>
Players subscribe to notifications about leaderboard updates. When their rank changes or when a new event is available, the game (subject) sends an update to the players observing the leaderboard.</p>

<p><strong>7. IoT Systems</strong></p>

<p><strong>Description:</strong>
Smart home devices, such as thermostats (Nest), security cameras, and smart lights, notify users of changes or status updates in real time.</p>

<p><strong>Observer:</strong>
Homeowners or users accessing the smart home system via an app or device.</p>

<p><strong>Subject:</strong>
IoT devices, such as cameras, thermostats, or motion detectors.</p>

<p><strong>How It Works:</strong>
The IoT system (subject) monitors connected devices. When a change occurs (e.g., door opens, temperature rises), the system sends notifications to the users (observers) who are subscribed to those events.</p>

<p><strong>8. Auction Platforms</strong></p>

<p><strong>Description:</strong>
Auction platforms, such as eBay, notify participants of new bids, bid price changes, or auction closing times.</p>

<p><strong>Observer:</strong>
Bidders participating in an auction.</p>

<p><strong>Subject:</strong>
The auction itself, including the item being sold.</p>

<p><strong>How It Works:</strong>
When users place bids on an item, they subscribe to updates. If a bid is placed or the auction is about to close, the platform (subject) notifies all active bidders.</p>

<p><strong>9. Real-Time Traffic Updates</strong></p>

<p><strong>Description:</strong>
Navigation apps like Google Maps and Waze notify users about traffic conditions, road closures, or new incidents along their route.</p>

<p><strong>Observer:</strong>
Drivers using the navigation system.</p>

<p><strong>Subject:</strong>
The route being taken by the user and the traffic data related to it.</p>

<p><strong>How It Works:</strong>
When drivers enter a route, they subscribe to real-time updates. The navigation system (subject) continuously monitors traffic data, and when there’s a change (e.g., a crash or road closure), it sends an update to users along the route.</p>

<p><strong>10. Stock Market and Cryptocurrency Tracking</strong></p>

<p><strong>Description:</strong>
Stock market applications such as Robinhood, E*TRADE, or cryptocurrency platforms like Coinbase notify users of price changes, market trends, or news affecting the stocks or cryptocurrencies they are following.</p>

<p><strong>Observer:</strong>
Investors or traders who are tracking specific financial assets.</p>

<p><strong>Subject:</strong>
The asset (e.g., a stock, cryptocurrency) being tracked.</p>

<p><strong>How It Works:</strong>
Users subscribe to specific stocks or cryptocurrencies. When the price or market trend changes, the system (subject) sends an update to all observers who have subscribed to the asset.</p>

<h3 id="conclusion">Conclusion</h3>

<p>The Observer Design Pattern is invaluable when building systems that require real-time updates or notifications. Whether it’s used for social media notifications, real-time chat alerts, or system monitoring, the Observer pattern ensures that interested parties are notified as soon as an update occurs, improving responsiveness and interactivity. Understanding its real-world applications can help in architecting software systems that are both efficient and scalable.</p>]]></content><author><name>Mahedee Hasan</name></author><category term="Design Pattern" /><category term="Software Architecture" /><category term="design-pattern" /><category term="software-architecture" /><category term="observer-pattern" /><summary type="html"><![CDATA[Discover how the Observer design pattern transforms real-world applications with real-time updates and notifications. In this article, we explore 10 practical examples, from stock market alerts to weather updates, showcasing how subjects and observers work together seamlessly to deliver dynamic user experiences.]]></summary></entry><entry><title type="html">Observer Design Pattern: Create a Real-Time Stock Market Notification System in C#</title><link href="https://mahedee.net//observer_design_pattern_real_time_stock_market_notification_csharp/" rel="alternate" type="text/html" title="Observer Design Pattern: Create a Real-Time Stock Market Notification System in C#" /><published>2024-10-11T00:00:00-04:00</published><updated>2024-10-11T00:00:00-04:00</updated><id>https://mahedee.net//observer_design_pattern_real_time_stock_market_notification_csharp</id><content type="html" xml:base="https://mahedee.net//observer_design_pattern_real_time_stock_market_notification_csharp/"><![CDATA[<p><strong>What is the Observer Design Pattern?</strong>
The Observer Design Pattern is a behavioral design pattern that allows objects to be notified of changes to other objects’ states. It establishes a one-to-many dependency between objects, where the subject (the object being observed) maintains a list of observers (objects that are interested in its state) and notifies them of any changes.</p>

<p><strong>Why use the Observer Design Pattern?</strong>
The Observer pattern is useful when you need to notify multiple objects of changes to a single object’s state without tightly coupling them. It promotes loose coupling between objects, making it easier to maintain and extend the system. It is commonly used in event-driven systems, such as GUI frameworks, real-time monitoring systems, and notification systems.</p>

<p><strong>Key components of the Observer Design Pattern:</strong></p>
<ol>
  <li><strong>Subject</strong>: The object being observed, which maintains a list of observers and notifies them of changes to its state.</li>
  <li><strong>Observer</strong>: The object that is interested in the subject’s state and receives notifications when the subject’s state changes.</li>
  <li><strong>Concrete Subject</strong>: A specific implementation of the subject that contains the state to be observed.</li>
  <li><strong>Concrete Observer</strong>: A specific implementation of the observer that receives notifications from the subject.</li>
  <li><strong>Attach / Registration</strong>: The process of adding an observer to the subject’s list of observers.</li>
  <li><strong>Detach / Deregistration</strong>: The process of removing an observer from the subject’s list of observers.</li>
  <li><strong>Notify</strong>: The process of notifying all observers of changes to the subject’s state.</li>
</ol>

<p><strong>UML Class Diagram of the Observer Design Pattern:</strong></p>

<p><img src="/assets/images/posts/2024/observer-design-pattern.drawio.png" alt="" /></p>

<p><strong>How to implement the Observer Design Pattern in C#?</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nn">ObserverPattern</span>
<span class="p">{</span>
    <span class="c1">// IObserver interface is used to update all the observers</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IObserver</span>
    <span class="p">{</span>
        <span class="c1">// Update method is called when the subject changes</span>
        <span class="k">void</span> <span class="nf">Update</span><span class="p">(</span><span class="kt">string</span> <span class="n">state</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Interface for the subject</span>
    <span class="c1">// It has methods to attach, detach and notify the observers</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">ISubject</span>
    <span class="p">{</span>
        <span class="k">void</span> <span class="nf">Attach</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">observer</span><span class="p">);</span>
        <span class="k">void</span> <span class="nf">Detach</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">observer</span><span class="p">);</span>
        <span class="k">void</span> <span class="nf">Notify</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Concreate Subject class</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ConcreateSubject</span> <span class="p">:</span> <span class="n">ISubject</span>
    <span class="p">{</span>
        <span class="c1">// List of observers attached to the subject</span>
        <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&gt;</span> <span class="n">_observers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&gt;();</span>
        <span class="k">private</span> <span class="kt">string</span> <span class="n">_subjectState</span><span class="p">;</span>

        <span class="k">public</span> <span class="kt">string</span> <span class="n">SubjectState</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">=&gt;</span> <span class="n">_subjectState</span><span class="p">;</span>

            <span class="c1">// When the state changes of subject, notify all the observers</span>
            <span class="k">set</span>
            <span class="p">{</span>
                <span class="n">_subjectState</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
                <span class="c1">// Call Notify method to notify all the observers</span>
                <span class="nf">Notify</span><span class="p">();</span> 
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Attach</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">observer</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_observers</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Detach</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">observer</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_observers</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Notify all the observers</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Notify</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// Call Update method of all the observers attached to the subject</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">observer</span> <span class="k">in</span> <span class="n">_observers</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">observer</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="n">_subjectState</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Concrete Observer class</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ConcreateObserver</span> <span class="p">:</span> <span class="n">IObserver</span>
    <span class="p">{</span>
        <span class="c1">// Used to set the name of the observer</span>
        <span class="k">private</span> <span class="kt">string</span> <span class="n">_observerName</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">ConcreateObserver</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_observerName</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">(</span><span class="kt">string</span> <span class="n">state</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">_observerName</span><span class="p">}</span><span class="s"> received update: State changed to </span><span class="p">{</span><span class="n">state</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>


    <span class="k">internal</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Create a subject</span>
            <span class="n">ConcreateSubject</span> <span class="n">subject</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConcreateSubject</span><span class="p">();</span>

            <span class="c1">// Create observers</span>
            <span class="n">IObserver</span> <span class="n">observer1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConcreateObserver</span><span class="p">(</span><span class="s">"Observer-1"</span><span class="p">);</span>
            <span class="n">IObserver</span> <span class="n">observer2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConcreateObserver</span><span class="p">(</span><span class="s">"Observer-2"</span><span class="p">);</span>
            <span class="n">IObserver</span> <span class="n">observer3</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConcreateObserver</span><span class="p">(</span><span class="s">"Observer-3"</span><span class="p">);</span>

            <span class="c1">// Attach the observers to the subject</span>
            <span class="n">subject</span><span class="p">.</span><span class="nf">Attach</span><span class="p">(</span><span class="n">observer1</span><span class="p">);</span>
            <span class="n">subject</span><span class="p">.</span><span class="nf">Attach</span><span class="p">(</span><span class="n">observer2</span><span class="p">);</span>
            <span class="n">subject</span><span class="p">.</span><span class="nf">Attach</span><span class="p">(</span><span class="n">observer3</span><span class="p">);</span>

            <span class="c1">// Change the state of the subject</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Changing state to State 1"</span><span class="p">);</span>
            <span class="n">subject</span><span class="p">.</span><span class="n">SubjectState</span> <span class="p">=</span> <span class="s">"State-1"</span><span class="p">;</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Changing state to State 2"</span><span class="p">);</span>
            <span class="n">subject</span><span class="p">.</span><span class="n">SubjectState</span> <span class="p">=</span> <span class="s">"State-2"</span><span class="p">;</span>

            <span class="c1">// Detach observer 1</span>
            <span class="n">subject</span><span class="p">.</span><span class="nf">Detach</span><span class="p">(</span><span class="n">observer1</span><span class="p">);</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Changing state to State 3"</span><span class="p">);</span>
            <span class="n">subject</span><span class="p">.</span><span class="n">SubjectState</span> <span class="p">=</span> <span class="s">"State-3"</span><span class="p">;</span>

            <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Output</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Changing state to State 1
Observer-1 received update: State changed to State-1
Observer-2 received update: State changed to State-1
Observer-3 received update: State changed to State-1
Changing state to State 2
Observer-1 received update: State changed to State-2
Observer-2 received update: State changed to State-2
Observer-3 received update: State changed to State-2
Changing state to State 3
Observer-2 received update: State changed to State-3
Observer-3 received update: State changed to State-3
</code></pre></div></div>

<p><strong>Use Case: Real-Time Stock Market Notification System</strong>
Imagine a stock market application where traders are notified every time the price of a stock changes. In this scenario, the stock price is the subject, and the traders are the observers. When the price of a stock changes, all the traders who are interested in that stock should be notified of the change. Let’s implement this use case using the Observer Design Pattern in C#.</p>

<p><strong>UML Class Diagram of the Real-Time Stock Market Notification System:</strong></p>

<p><img src="/assets/images/posts/2024/observer-design-pattern-stock-notification.drawio.png" alt="" /></p>

<p><strong>Implementation of the Real-Time Stock Market Notification System in C#</strong></p>

<p><strong>Step 1: Define the Observer Interface</strong>
The observer interface provides a common contract for all observers to implement.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IObserver</span>
<span class="p">{</span>
    <span class="k">void</span> <span class="nf">Update</span><span class="p">(</span><span class="kt">string</span> <span class="n">symbol</span><span class="p">,</span> <span class="kt">decimal</span> <span class="n">price</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p><strong>Step 2: Define the Subject Interface</strong>
The subject interface defines the methods to register, unregister, and notify observers. Here we define it as <code class="language-plaintext highlighter-rouge">IStock</code>.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IStock</span>
<span class="p">{</span>
    <span class="k">void</span> <span class="nf">Register</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">observer</span><span class="p">);</span>
    <span class="k">void</span> <span class="nf">Unregister</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">observer</span><span class="p">);</span>
    <span class="k">void</span> <span class="nf">Notify</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Step 3: Implement the Stock Class</strong>
The <code class="language-plaintext highlighter-rouge">Stock</code> class is a concrete subject that maintains the stock price and notifies the observers when the price changes.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Stock</span> <span class="p">:</span> <span class="n">IStock</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">_symbol</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">decimal</span> <span class="n">_price</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&gt;</span> <span class="n">_observers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IObserver</span><span class="p">&gt;();</span>

    <span class="k">public</span> <span class="nf">Stock</span><span class="p">(</span><span class="kt">string</span> <span class="n">symbol</span><span class="p">,</span> <span class="kt">decimal</span> <span class="n">price</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_symbol</span> <span class="p">=</span> <span class="n">symbol</span><span class="p">;</span>
        <span class="n">_price</span> <span class="p">=</span> <span class="n">price</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Register</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">observer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_observers</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">Unregister</span><span class="p">(</span><span class="n">IObserver</span> <span class="n">observer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_observers</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// If the price changes, notify the observers (traders)</span>
    <span class="c1">// Here we are calling the Notify method</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">UpdatePrice</span><span class="p">(</span><span class="kt">decimal</span> <span class="n">price</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_price</span> <span class="p">=</span> <span class="n">price</span><span class="p">;</span>
        <span class="nf">Notify</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Notify</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">observer</span> <span class="k">in</span> <span class="n">_observers</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">observer</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="n">_symbol</span><span class="p">,</span> <span class="n">_price</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Step 4: Implement the Trader Class</strong>
The <code class="language-plaintext highlighter-rouge">Trader</code> class is a concrete observer that receives notifications when the stock price changes.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">class</span> <span class="nc">Trader</span> <span class="p">:</span> <span class="n">IObserver</span>
 <span class="p">{</span>
     <span class="c1">// The observer's name</span>
     <span class="k">private</span> <span class="kt">string</span> <span class="n">_name</span><span class="p">;</span>

     <span class="k">public</span> <span class="nf">Trader</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="n">_name</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">public</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">(</span><span class="kt">string</span> <span class="n">symbol</span><span class="p">,</span> <span class="kt">decimal</span> <span class="n">price</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Notified </span><span class="p">{</span><span class="n">_name</span><span class="p">}</span><span class="s"> of </span><span class="p">{</span><span class="n">symbol</span><span class="p">}</span><span class="s">'s price change to </span><span class="p">{</span><span class="n">price</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div></div>

<p><strong>Step 5: Implement the Main Program</strong>
In the main program, we create a stock object and register traders as observers. When the stock price changes, the traders are notified.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Create a stock</span>
        <span class="n">Stock</span> <span class="n">stock</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Stock</span><span class="p">(</span><span class="s">"MSFT"</span><span class="p">,</span> <span class="m">100.00m</span><span class="p">);</span>

        <span class="c1">// Create some traders</span>
        <span class="n">Trader</span> <span class="n">joe</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Trader</span><span class="p">(</span><span class="s">"Joe"</span><span class="p">);</span>
        <span class="n">Trader</span> <span class="n">sally</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Trader</span><span class="p">(</span><span class="s">"Sally"</span><span class="p">);</span>

        <span class="c1">// Register/subscribe the traders</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Registering Joe and Sally"</span><span class="p">);</span>
        <span class="n">stock</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="n">joe</span><span class="p">);</span>
        <span class="n">stock</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="n">sally</span><span class="p">);</span>

        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Changing stock price to 105.00m"</span><span class="p">);</span>
        <span class="c1">// Change the stock price</span>
        <span class="n">stock</span><span class="p">.</span><span class="nf">UpdatePrice</span><span class="p">(</span><span class="m">105.00m</span><span class="p">);</span>

        <span class="c1">// Change the stock price</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Changing stock price to 110.00m"</span><span class="p">);</span>
        <span class="n">stock</span><span class="p">.</span><span class="nf">UpdatePrice</span><span class="p">(</span><span class="m">110.00m</span><span class="p">);</span>

        <span class="c1">// Unregister/unsubscribe a trader</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Unregistering Joe"</span><span class="p">);</span>
        <span class="n">stock</span><span class="p">.</span><span class="nf">Unregister</span><span class="p">(</span><span class="n">joe</span><span class="p">);</span>

        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Changing stock price to 115.00m"</span><span class="p">);</span>
        <span class="c1">// Change the stock price</span>
        <span class="n">stock</span><span class="p">.</span><span class="nf">UpdatePrice</span><span class="p">(</span><span class="m">115.00m</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Now, when you run the program, you should see the following output:</p>

<p><strong>Output</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Registering Joe and Sally
Changing stock price to 105.00m
Notified Joe of MSFT's price change to 105.00
Notified Sally of MSFT's price change to 105.00
Changing stock price to 110.00m
Notified Joe of MSFT's price change to 110.00
Notified Sally of MSFT's price change to 110.00
Unregistering Joe
Changing stock price to 115.00m
Notified Sally of MSFT's price change to 115.00
</code></pre></div></div>

<p>Happy coding!</p>

<p><strong><a href="https://github.com/mahedee/code-sample02/tree/master/ObserverPattern">Source code</a></strong></p>]]></content><author><name>Mahedee Hasan</name></author><category term="C#" /><category term="Design Pattern" /><category term="Software Architecture" /><category term="csharp" /><category term="design-pattern" /><category term="software-architecture" /><category term="observer-pattern" /><summary type="html"><![CDATA[In this article, we'll explore the Observer Design Pattern and its practical application in building a real-time stock market notification system using C#. You'll learn how to implement this pattern to efficiently manage stock price updates and notify users in real-time. The article provides step-by-step instructions, code examples, and insights into how the Observer pattern can be used to build responsive and scalable notification systems.]]></summary></entry><entry><title type="html">Boost Your Productivity - Setting Up and Customizing Windows Terminal with Git Bash and Oh My Posh</title><link href="https://mahedee.net//boost_your_productivity_setting_up_and_customizing_windows_terminal_with_oh_my_posh/" rel="alternate" type="text/html" title="Boost Your Productivity - Setting Up and Customizing Windows Terminal with Git Bash and Oh My Posh" /><published>2024-09-10T00:00:00-04:00</published><updated>2024-09-10T00:00:00-04:00</updated><id>https://mahedee.net//boost_your_productivity_setting_up_and_customizing_windows_terminal_with_oh_my_posh</id><content type="html" xml:base="https://mahedee.net//boost_your_productivity_setting_up_and_customizing_windows_terminal_with_oh_my_posh/"><![CDATA[<p>Windows Terminal is a versatile and powerful tool that allows you to work with multiple command-line environments in one place, including PowerShell, Command Prompt, WSL (Windows Subsystem for Linux), and now Git Bash. By customizing Windows Terminal with “Oh My Posh”, you can enhance your productivity with better themes, prompt customization, intellisence and more. This guide will walk you through configuring Windows Terminal, setting up Oh My Posh, integrating Git Bash, and switching between different terminal profiles.</p>

<p><strong>Step 1: Install Windows Terminal</strong></p>

<p>Before we dive into customizations, make sure Windows Terminal is installed on your system.</p>

<ul>
  <li>Install Windows Terminal via the Microsoft Store:
    <ul>
      <li>Open the <strong>Microsoft Store</strong> on your Windows PC.</li>
      <li>Search for <strong>Windows Terminal</strong> and click <strong>Install</strong>.</li>
    </ul>

    <p>Or, install it using the following PowerShell command:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> winget <span class="nb">install</span> <span class="nt">--id</span> Microsoft.WindowsTerminal <span class="nt">-e</span> <span class="nt">--source</span> winget
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Step 2: Install and Set Up Git Bash</strong></p>

<p>Git Bash is a popular terminal for developers who want a Unix-like experience on Windows. It comes bundled with Git for Windows. To integrate Git Bash into Windows Terminal:</p>

<ol>
  <li><strong>Download Git for Windows</strong>:
    <ul>
      <li>Go to <a href="https://git-scm.com/download/win">Git for Windows</a> and download the installer.</li>
      <li>Follow the installation instructions. Ensure that the option “Git Bash Here” is selected, so you can access Git Bash easily from your terminal.</li>
      <li>You can also install Git for Windows using the following command:</li>
    </ul>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> winget <span class="nb">install </span>Git.Git <span class="nt">-e</span> <span class="nt">--source</span> winget
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Add Git Bash to Windows Terminal</strong>:
Once installed, you’ll need to add Git Bash as a profile in Windows Terminal.</p>

    <ul>
      <li>Open <strong>Windows Terminal</strong> and go to <strong>Settings</strong> (press <strong>Ctrl + ,</strong> or click on the drop-down menu and select <strong>Settings</strong>).</li>
      <li>
        <p>In the <strong>Settings</strong> window, click on <strong>Profiles</strong> and then click on the <strong>Open JSON file</strong> button.</p>
      </li>
      <li>
        <p>In the <strong>profiles.json</strong> file, scroll down to the <code class="language-plaintext highlighter-rouge">"profiles"</code> section and add Git Bash as a new profile like this:</p>

        <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{some-guid-here}"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Git Bash"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"commandline"</span><span class="p">:</span><span class="w"> </span><span class="s2">"</span><span class="se">\"</span><span class="s2">C:</span><span class="se">\\</span><span class="s2">Program Files</span><span class="se">\\</span><span class="s2">Git</span><span class="se">\\</span><span class="s2">bin</span><span class="se">\\</span><span class="s2">bash.exe</span><span class="se">\"</span><span class="s2"> --login -i"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ms-appx:///ProfileIcons/git-bash.png"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"startingDirectory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"%USERPROFILE%"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>        </div>
      </li>
      <li>Replace <code class="language-plaintext highlighter-rouge">{some-guid-here}</code> with a new GUID. You can generate a new GUID using a tool like <a href="https://www.guidgenerator.com/">GUID generator</a>.</li>
      <li>Save the file and close the editor.</li>
    </ul>

    <p>or,</p>
    <ul>
      <li>You can also add it by clicking on the “+” button in the profiles section called “Add a new profile”</li>
      <li>Click on New empty profile</li>
      <li>Name the profile “Git Bash”</li>
      <li>Add the commandline <code class="language-plaintext highlighter-rouge">"C:\\Program Files\\Git\\bin\\bash.exe" --login -i</code> or browse to the location of the <code class="language-plaintext highlighter-rouge">bash.exe</code> file.</li>
      <li>Icon: You can find the Git Bash icon in the Git installation directory. For example, <code class="language-plaintext highlighter-rouge">C:\Program Files\Git\mingw64\share\git\git-for-windows.ico</code>.
       - Starting Directory: <code class="language-plaintext highlighter-rouge">%USERPROFILE%</code>
       - Save the profile.</li>
    </ul>
  </li>
  <li><strong>Switch to Git Bash</strong>:
    <ul>
      <li>Once you’ve saved the profile, Git Bash will now be available in the Windows Terminal dropdown menu.</li>
      <li>Simply select <strong>Git Bash</strong> from the profiles list, and you can start using it in the same terminal window.</li>
    </ul>
  </li>
</ol>

<p><strong>Step 3: Install PowerShell Core (Optional)</strong></p>

<p>While Git Bash is now available, you might want to also use <strong>PowerShell Core</strong> (the cross-platform version of PowerShell). To install PowerShell Core:</p>

<ol>
  <li>Download <strong>PowerShell Core</strong> from the <a href="https://github.com/PowerShell/PowerShell/releases">official GitHub repository</a>.</li>
  <li>Follow the installation instructions for your system.</li>
  <li>Add <strong>PowerShell Core</strong> to Windows Terminal:
    <ul>
      <li>In <strong>Windows Terminal Settings</strong>, add a new profile for PowerShell Core by specifying the path to <code class="language-plaintext highlighter-rouge">pwsh.exe</code>.</li>
      <li>Save the settings.</li>
    </ul>
  </li>
</ol>

<p><strong>Step 4: Install a Font with Powerline Symbols</strong>
   To display special symbols properly, install a <strong>Powerline</strong> font like <strong>CaskaydiaCove</strong> or <strong>FiraCode</strong> from the <a href="https://www.nerdfonts.com/">Nerd Fonts website</a>.</p>
<ul>
  <li>Download the font and install it on your system.</li>
  <li>In my case, I have used <strong>CaskaydiaCove Nerd Font</strong>.</li>
  <li>Or, copy the font to the font directory: <code class="language-plaintext highlighter-rouge">C:\Windows\Fonts</code>.</li>
  <li>Set the installed font in Windows Terminal under <strong>Settings</strong> &gt; <strong>Profiles</strong> &gt; <strong>PowerShell</strong> &gt; <strong>Appearance</strong> &gt; <strong>Font face</strong>.</li>
</ul>

<p><strong>Step 5: Install and Set Up Oh My Posh for PowerShell</strong></p>

<p><strong>Oh My Posh</strong> is a prompt theme engine for PowerShell that can beautify your terminal with themes, segments, and additional functionality. To install it:</p>

<ol>
  <li><strong>Install Oh My Posh</strong>:
    <ul>
      <li>Go to https://ohmyposh.dev/docs/installation/windows and follow the instructions to set up Oh My Posh.
  or,</li>
      <li>Open a PowerShell prompt and run the following command:</li>
    </ul>
  </li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   winget <span class="nb">install </span>JanDeDobbeleer.OhMyPosh <span class="nt">-s</span> winget
</code></pre></div></div>

<ul>
  <li>This installs a couple of things:
    <ul>
      <li>oh-my-posh.exe - Windows executable</li>
      <li>themes - The latest Oh My Posh themes</li>
      <li>You can find the themes in the directory <code class="language-plaintext highlighter-rouge">C:\Users\{your-username}\AppData\Local\Programs\oh-my-posh\themes</code>.</li>
    </ul>
  </li>
  <li>Run following command to update oh-my-posh
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  winget upgrade JanDeDobbeleer.OhMyPosh <span class="nt">-s</span> winget
</code></pre></div>    </div>
  </li>
  <li>Run the following command to check oh-my-posh installed or not
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oh-my-posh <span class="nt">--version</span>

or
oh-my-posh.exe
</code></pre></div>    </div>
  </li>
</ul>

<ol>
  <li><strong>Configure Powershell Profile</strong>:
    <ul>
      <li>Open PowerShell and run the following command to edit your profile. If you don’t have a profile, a window will prompt you to create one. or you can create a profile in the directory <code class="language-plaintext highlighter-rouge">C:\Users\{your-username}\Documents\PowerShell\Microsoft.PowerShell_profile.ps1</code>.</li>
    </ul>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> notepad <span class="nv">$PROFILE</span>
</code></pre></div>    </div>

    <ul>
      <li>
        <p>Add the following lines to the profile script to enable Oh My Posh:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oh-my-posh init pwsh | Invoke-Expression
</code></pre></div>        </div>
      </li>
      <li>
        <p>For advanced feature, I have customized my profile script. You can copy and paste it into your profile script. Here is my profile script. https://gist.github.com/mahedee/f7468bd2c59fa463235e877a8d719f98</p>
      </li>
    </ul>

    <p><strong>Microsoft.PowerShell_profile.ps1</strong></p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   using namespace System.Management.Automation
   using namespace System.Management.Automation.Language
      
   <span class="k">if</span> <span class="o">(</span><span class="nv">$host</span>.Name <span class="nt">-eq</span> <span class="s1">'ConsoleHost'</span><span class="o">)</span>
   <span class="o">{</span>
       Import-Module PSReadLine
   <span class="o">}</span>


   Import-Module <span class="nt">-Name</span> Terminal-Icons

   <span class="c"># oh-my-posh init pwsh --config C:\Users\mahedee\AppData\Local\Programs\oh-my-posh\themes\jandedobbeleer.omp.json | Invoke-Expression</span>
   oh-my-posh init pwsh <span class="nt">--config</span> C:<span class="se">\U</span>sers<span class="se">\m</span>ahedee<span class="se">\A</span>ppData<span class="se">\L</span>ocal<span class="se">\P</span>rograms<span class="se">\o</span>h-my-posh<span class="se">\t</span>hemes<span class="se">\m</span>yposh-mahedee.omp.json | Invoke-Expression
   <span class="c"># oh-my-posh init pwsh --config C:\Users\mahedee\AppData\Local\Programs\oh-my-posh\themes\myposh-hanselman.omp.json | Invoke-Expression</span>
   <span class="c"># oh-my-posh init pwsh --config C:\Users\mahedee\AppData\Local\Programs\oh-my-posh\themes\cobalt2.omp.json | Invoke-Expression</span>

   Register-ArgumentCompleter <span class="nt">-Native</span> <span class="nt">-CommandName</span> winget <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$wordToComplete</span>, <span class="nv">$commandAst</span>, <span class="nv">$cursorPosition</span><span class="o">)</span>
           <span class="o">[</span>Console]::InputEncoding <span class="o">=</span> <span class="o">[</span>Console]::OutputEncoding <span class="o">=</span> <span class="nv">$OutputEncoding</span> <span class="o">=</span> <span class="o">[</span>System.Text.Utf8Encoding]::new<span class="o">()</span>
           <span class="nv">$Local</span>:word <span class="o">=</span> <span class="nv">$wordToComplete</span>.Replace<span class="o">(</span><span class="s1">'"'</span>, <span class="s1">'""'</span><span class="o">)</span>
           <span class="nv">$Local</span>:ast <span class="o">=</span> <span class="nv">$commandAst</span>.ToString<span class="o">()</span>.Replace<span class="o">(</span><span class="s1">'"'</span>, <span class="s1">'""'</span><span class="o">)</span>
           winget <span class="nb">complete</span> <span class="nt">--word</span><span class="o">=</span><span class="s2">"</span><span class="nv">$Local</span><span class="s2">:word"</span> <span class="nt">--commandline</span> <span class="s2">"</span><span class="nv">$Local</span><span class="s2">:ast"</span> <span class="nt">--position</span> <span class="nv">$cursorPosition</span> | ForEach-Object <span class="o">{</span>
               <span class="o">[</span>System.Management.Automation.CompletionResult]::new<span class="o">(</span><span class="nv">$_</span>, <span class="nv">$_</span>, <span class="s1">'ParameterValue'</span>, <span class="nv">$_</span><span class="o">)</span>
           <span class="o">}</span>
   <span class="o">}</span>

   <span class="c"># PowerShell parameter completion shim for the dotnet CLI</span>
   Register-ArgumentCompleter <span class="nt">-Native</span> <span class="nt">-CommandName</span> dotnet <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$commandName</span>, <span class="nv">$wordToComplete</span>, <span class="nv">$cursorPosition</span><span class="o">)</span>
           dotnet <span class="nb">complete</span> <span class="nt">--position</span> <span class="nv">$cursorPosition</span> <span class="s2">"</span><span class="nv">$wordToComplete</span><span class="s2">"</span> | ForEach-Object <span class="o">{</span>
               <span class="o">[</span>System.Management.Automation.CompletionResult]::new<span class="o">(</span><span class="nv">$_</span>, <span class="nv">$_</span>, <span class="s1">'ParameterValue'</span>, <span class="nv">$_</span><span class="o">)</span>
           <span class="o">}</span>
   <span class="o">}</span>

   <span class="c"># ---</span>


   <span class="c"># This is an example profile for PSReadLine.</span>
   <span class="c">#</span>
   <span class="c"># This is roughly what I use so there is some emphasis on emacs bindings,</span>
   <span class="c"># but most of these bindings make sense in Windows mode as well.</span>

   <span class="c"># Searching for commands with up/down arrow is really handy.  The</span>
   <span class="c"># option "moves to end" is useful if you want the cursor at the end</span>
   <span class="c"># of the line while cycling through history like it does w/o searching,</span>
   <span class="c"># without that option, the cursor will remain at the position it was</span>
   <span class="c"># when you used up arrow, which can be useful if you forget the exact</span>
   <span class="c"># string you started the search on.</span>
   Set-PSReadLineKeyHandler <span class="nt">-Key</span> UpArrow <span class="nt">-Function</span> HistorySearchBackward
   Set-PSReadLineKeyHandler <span class="nt">-Key</span> DownArrow <span class="nt">-Function</span> HistorySearchForward

   <span class="c"># This key handler shows the entire or filtered history using Out-GridView. The</span>
   <span class="c"># typed text is used as the substring pattern for filtering. A selected command</span>
   <span class="c"># is inserted to the command line without invoking. Multiple command selection</span>
   <span class="c"># is supported, e.g. selected by Ctrl + Click.</span>
   Set-PSReadLineKeyHandler <span class="nt">-Key</span> F7 <span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> History <span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s1">'Show command history'</span> <span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       <span class="nv">$pattern</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState<span class="o">([</span>ref]<span class="nv">$pattern</span>, <span class="o">[</span>ref]<span class="nv">$null</span><span class="o">)</span>
       <span class="k">if</span> <span class="o">(</span><span class="nv">$pattern</span><span class="o">)</span>
       <span class="o">{</span>
           <span class="nv">$pattern</span> <span class="o">=</span> <span class="o">[</span>regex]::Escape<span class="o">(</span><span class="nv">$pattern</span><span class="o">)</span>
       <span class="o">}</span>

       <span class="nv">$history</span> <span class="o">=</span> <span class="o">[</span>System.Collections.ArrayList]@<span class="o">(</span>
           <span class="nv">$last</span> <span class="o">=</span> <span class="s1">''</span>
           <span class="nv">$lines</span> <span class="o">=</span> <span class="s1">''</span>
           foreach <span class="o">(</span><span class="nv">$line</span> <span class="k">in</span> <span class="o">[</span>System.IO.File]::ReadLines<span class="o">((</span>Get-PSReadLineOption<span class="o">)</span>.HistorySavePath<span class="o">))</span>
           <span class="o">{</span>
               <span class="k">if</span> <span class="o">(</span><span class="nv">$line</span>.EndsWith<span class="o">(</span><span class="s1">'`'</span><span class="o">))</span>
               <span class="o">{</span>
                   <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$line</span>.Substring<span class="o">(</span>0, <span class="nv">$line</span>.Length - 1<span class="o">)</span>
                   <span class="nv">$lines</span> <span class="o">=</span> <span class="k">if</span> <span class="o">(</span><span class="nv">$lines</span><span class="o">)</span>
                   <span class="o">{</span>
                       <span class="s2">"</span><span class="nv">$lines</span><span class="sb">`</span>n<span class="nv">$line</span><span class="s2">"
                   }
                   else
                   {
                       </span><span class="nv">$line</span><span class="s2">
                   }
                   continue
               }

               if (</span><span class="nv">$lines</span><span class="s2">)
               {
                   </span><span class="nv">$line</span><span class="s2"> = "</span><span class="nv">$lines</span><span class="sb">`</span><span class="s2">n</span><span class="nv">$line</span><span class="s2">"</span>
                   <span class="nv">$lines</span> <span class="o">=</span> <span class="s1">''</span>
               <span class="o">}</span>

               <span class="k">if</span> <span class="o">((</span><span class="nv">$line</span> <span class="nt">-cne</span> <span class="nv">$last</span><span class="o">)</span> <span class="nt">-and</span> <span class="o">(!</span><span class="nv">$pattern</span> <span class="nt">-or</span> <span class="o">(</span><span class="nv">$line</span> <span class="nt">-match</span> <span class="nv">$pattern</span><span class="o">)))</span>
               <span class="o">{</span>
                   <span class="nv">$last</span> <span class="o">=</span> <span class="nv">$line</span>
                   <span class="nv">$line</span>
               <span class="o">}</span>
           <span class="o">}</span>
       <span class="o">)</span>
       <span class="nv">$history</span>.Reverse<span class="o">()</span>

       <span class="nv">$command</span> <span class="o">=</span> <span class="nv">$history</span> | Out-GridView <span class="nt">-Title</span> History <span class="nt">-PassThru</span>
       <span class="k">if</span> <span class="o">(</span><span class="nv">$command</span><span class="o">)</span>
       <span class="o">{</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::RevertLine<span class="o">()</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Insert<span class="o">((</span><span class="nv">$command</span> <span class="nt">-join</span> <span class="s2">"</span><span class="sb">`</span>n<span class="s2">"))
       }
   }


   # CaptureScreen is good for blog posts or email showing a transaction
   # of what you did when asking for help or demonstrating a technique.
   Set-PSReadLineKeyHandler -Chord 'Ctrl+d,Ctrl+c' -Function CaptureScreen

   # The built-in word movement uses character delimiters, but token based word
   # movement is also very useful - these are the bindings you'd use if you
   # prefer the token based movements bound to the normal emacs word movement
   # key bindings.
   Set-PSReadLineKeyHandler -Key Alt+d -Function ShellKillWord
   Set-PSReadLineKeyHandler -Key Alt+Backspace -Function ShellBackwardKillWord
   Set-PSReadLineKeyHandler -Key Alt+b -Function ShellBackwardWord
   Set-PSReadLineKeyHandler -Key Alt+f -Function ShellForwardWord
   Set-PSReadLineKeyHandler -Key Alt+B -Function SelectShellBackwardWord
   Set-PSReadLineKeyHandler -Key Alt+F -Function SelectShellForwardWord

   #region Smart Insert/Delete

   # The next four key handlers are designed to make entering matched quotes
   # parens, and braces a nicer experience.  I'd like to include functions
   # in the module that do this, but this implementation still isn't as smart
   # as ReSharper, so I'm just providing it as a sample.

   Set-PSReadLineKeyHandler -Key '"</span><span class="s1">',"'</span><span class="s2">" </span><span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> SmartInsertQuote <span class="sb">`</span><span class="s2">
                           -LongDescription "</span>Insert paired quotes <span class="k">if </span>not already on a quote<span class="s2">" </span><span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>

       <span class="nv">$quote</span> <span class="o">=</span> <span class="nv">$key</span>.KeyChar

       <span class="nv">$selectionStart</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$selectionLength</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetSelectionState<span class="o">([</span>ref]<span class="nv">$selectionStart</span>, <span class="o">[</span>ref]<span class="nv">$selectionLength</span><span class="o">)</span>

       <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState<span class="o">([</span>ref]<span class="nv">$line</span>, <span class="o">[</span>ref]<span class="nv">$cursor</span><span class="o">)</span>

       <span class="c"># If text is selected, just quote it without any smarts</span>
       <span class="k">if</span> <span class="o">(</span><span class="nv">$selectionStart</span> <span class="nt">-ne</span> <span class="nt">-1</span><span class="o">)</span>
       <span class="o">{</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Replace<span class="o">(</span><span class="nv">$selectionStart</span>, <span class="nv">$selectionLength</span>, <span class="nv">$quote</span> + <span class="nv">$line</span>.SubString<span class="o">(</span><span class="nv">$selectionStart</span>, <span class="nv">$selectionLength</span><span class="o">)</span> + <span class="nv">$quote</span><span class="o">)</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::SetCursorPosition<span class="o">(</span><span class="nv">$selectionStart</span> + <span class="nv">$selectionLength</span> + 2<span class="o">)</span>
           <span class="k">return</span>
       <span class="o">}</span>

       <span class="nv">$ast</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$tokens</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$parseErrors</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState<span class="o">([</span>ref]<span class="nv">$ast</span>, <span class="o">[</span>ref]<span class="nv">$tokens</span>, <span class="o">[</span>ref]<span class="nv">$parseErrors</span>, <span class="o">[</span>ref]<span class="nv">$null</span><span class="o">)</span>

       <span class="k">function </span>FindToken
       <span class="o">{</span>
           param<span class="o">(</span><span class="nv">$tokens</span>, <span class="nv">$cursor</span><span class="o">)</span>

           foreach <span class="o">(</span><span class="nv">$token</span> <span class="k">in</span> <span class="nv">$tokens</span><span class="o">)</span>
           <span class="o">{</span>
               <span class="k">if</span> <span class="o">(</span><span class="nv">$cursor</span> <span class="nt">-lt</span> <span class="nv">$token</span>.Extent.StartOffset<span class="o">)</span> <span class="o">{</span> <span class="k">continue</span> <span class="o">}</span>
               <span class="k">if</span> <span class="o">(</span><span class="nv">$cursor</span> <span class="nt">-lt</span> <span class="nv">$token</span>.Extent.EndOffset<span class="o">)</span> <span class="o">{</span>
                   <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$token</span>
                   <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$token</span> <span class="nt">-as</span> <span class="o">[</span>StringExpandableToken]
                   <span class="k">if</span> <span class="o">(</span><span class="nv">$token</span><span class="o">)</span> <span class="o">{</span>
                       <span class="nv">$nested</span> <span class="o">=</span> FindToken <span class="nv">$token</span>.NestedTokens <span class="nv">$cursor</span>
                       <span class="k">if</span> <span class="o">(</span><span class="nv">$nested</span><span class="o">)</span> <span class="o">{</span> <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$nested</span> <span class="o">}</span>
                   <span class="o">}</span>

                   <span class="k">return</span> <span class="nv">$result</span>
               <span class="o">}</span>
           <span class="o">}</span>
           <span class="k">return</span> <span class="nv">$null</span>
       <span class="o">}</span>

       <span class="nv">$token</span> <span class="o">=</span> FindToken <span class="nv">$tokens</span> <span class="nv">$cursor</span>

       <span class="c"># If we're on or inside a **quoted** string token (so not generic), we need to be smarter</span>
       <span class="k">if</span> <span class="o">(</span><span class="nv">$token</span> <span class="nt">-is</span> <span class="o">[</span>StringToken] <span class="nt">-and</span> <span class="nv">$token</span>.Kind <span class="nt">-ne</span> <span class="o">[</span>TokenKind]::Generic<span class="o">)</span> <span class="o">{</span>
           <span class="c"># If we're at the start of the string, assume we're inserting a new string</span>
           <span class="k">if</span> <span class="o">(</span><span class="nv">$token</span>.Extent.StartOffset <span class="nt">-eq</span> <span class="nv">$cursor</span><span class="o">)</span> <span class="o">{</span>
               <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Insert<span class="o">(</span><span class="s2">"</span><span class="nv">$quote$quote</span><span class="s2"> "</span><span class="o">)</span>
               <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::SetCursorPosition<span class="o">(</span><span class="nv">$cursor</span> + 1<span class="o">)</span>
               <span class="k">return</span>
           <span class="o">}</span>

           <span class="c"># If we're at the end of the string, move over the closing quote if present.</span>
           <span class="k">if</span> <span class="o">(</span><span class="nv">$token</span>.Extent.EndOffset <span class="nt">-eq</span> <span class="o">(</span><span class="nv">$cursor</span> + 1<span class="o">)</span> <span class="nt">-and</span> <span class="nv">$line</span><span class="o">[</span><span class="nv">$cursor</span><span class="o">]</span> <span class="nt">-eq</span> <span class="nv">$quote</span><span class="o">)</span> <span class="o">{</span>
               <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::SetCursorPosition<span class="o">(</span><span class="nv">$cursor</span> + 1<span class="o">)</span>
               <span class="k">return</span>
           <span class="o">}</span>
       <span class="o">}</span>

       <span class="k">if</span> <span class="o">(</span><span class="nv">$null</span> <span class="nt">-eq</span> <span class="nv">$token</span> <span class="nt">-or</span>
           <span class="nv">$token</span>.Kind <span class="nt">-eq</span> <span class="o">[</span>TokenKind]::RParen <span class="nt">-or</span> <span class="nv">$token</span>.Kind <span class="nt">-eq</span> <span class="o">[</span>TokenKind]::RCurly <span class="nt">-or</span> <span class="nv">$token</span>.Kind <span class="nt">-eq</span> <span class="o">[</span>TokenKind]::RBracket<span class="o">)</span> <span class="o">{</span>
           <span class="k">if</span> <span class="o">(</span><span class="nv">$line</span><span class="o">[</span>0..<span class="nv">$cursor</span><span class="o">]</span>.Where<span class="o">{</span><span class="nv">$_</span> <span class="nt">-eq</span> <span class="nv">$quote</span><span class="o">}</span>.Count % 2 <span class="nt">-eq</span> 1<span class="o">)</span> <span class="o">{</span>
               <span class="c"># Odd number of quotes before the cursor, insert a single quote</span>
               <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Insert<span class="o">(</span><span class="nv">$quote</span><span class="o">)</span>
           <span class="o">}</span>
           <span class="k">else</span> <span class="o">{</span>
               <span class="c"># Insert matching quotes, move cursor to be in between the quotes</span>
               <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Insert<span class="o">(</span><span class="s2">"</span><span class="nv">$quote$quote</span><span class="s2">"</span><span class="o">)</span>
               <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::SetCursorPosition<span class="o">(</span><span class="nv">$cursor</span> + 1<span class="o">)</span>
           <span class="o">}</span>
           <span class="k">return</span>
       <span class="o">}</span>

       <span class="c"># If cursor is at the start of a token, enclose it in quotes.</span>
       <span class="k">if</span> <span class="o">(</span><span class="nv">$token</span>.Extent.StartOffset <span class="nt">-eq</span> <span class="nv">$cursor</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">if</span> <span class="o">(</span><span class="nv">$token</span>.Kind <span class="nt">-eq</span> <span class="o">[</span>TokenKind]::Generic <span class="nt">-or</span> <span class="nv">$token</span>.Kind <span class="nt">-eq</span> <span class="o">[</span>TokenKind]::Identifier <span class="nt">-or</span> 
               <span class="nv">$token</span>.Kind <span class="nt">-eq</span> <span class="o">[</span>TokenKind]::Variable <span class="nt">-or</span> <span class="nv">$token</span>.TokenFlags.hasFlag<span class="o">([</span>TokenFlags]::Keyword<span class="o">))</span> <span class="o">{</span>
               <span class="nv">$end</span> <span class="o">=</span> <span class="nv">$token</span>.Extent.EndOffset
               <span class="nv">$len</span> <span class="o">=</span> <span class="nv">$end</span> - <span class="nv">$cursor</span>
               <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Replace<span class="o">(</span><span class="nv">$cursor</span>, <span class="nv">$len</span>, <span class="nv">$quote</span> + <span class="nv">$line</span>.SubString<span class="o">(</span><span class="nv">$cursor</span>, <span class="nv">$len</span><span class="o">)</span> + <span class="nv">$quote</span><span class="o">)</span>
               <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::SetCursorPosition<span class="o">(</span><span class="nv">$end</span> + 2<span class="o">)</span>
               <span class="k">return</span>
           <span class="o">}</span>
       <span class="o">}</span>

       <span class="c"># We failed to be smart, so just insert a single quote</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Insert<span class="o">(</span><span class="nv">$quote</span><span class="o">)</span>
   <span class="o">}</span>

   Set-PSReadLineKeyHandler <span class="nt">-Key</span> <span class="s1">'('</span>,<span class="s1">'{'</span>,<span class="s1">'['</span> <span class="sb">`</span><span class="s2">
                           -BriefDescription InsertPairedBraces </span><span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Insert matching braces"</span> <span class="sb">`</span><span class="s2">
                           -ScriptBlock {
       param(</span><span class="nv">$key</span><span class="s2">, </span><span class="nv">$arg</span><span class="s2">)

       </span><span class="nv">$closeChar</span><span class="s2"> = switch (</span><span class="nv">$key</span><span class="s2">.KeyChar)
       {
           &lt;#case#&gt; '(' { [char]')'; break }
           &lt;#case#&gt; '{' { [char]'}'; break }
           &lt;#case#&gt; '[' { [char]']'; break }
       }

       </span><span class="nv">$selectionStart</span><span class="s2"> = </span><span class="nv">$null</span><span class="s2">
       </span><span class="nv">$selectionLength</span><span class="s2"> = </span><span class="nv">$null</span><span class="s2">
       [Microsoft.PowerShell.PSConsoleReadLine]::GetSelectionState([ref]</span><span class="nv">$selectionStart</span><span class="s2">, [ref]</span><span class="nv">$selectionLength</span><span class="s2">)

       </span><span class="nv">$line</span><span class="s2"> = </span><span class="nv">$null</span><span class="s2">
       </span><span class="nv">$cursor</span><span class="s2"> = </span><span class="nv">$null</span><span class="s2">
       [Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState([ref]</span><span class="nv">$line</span><span class="s2">, [ref]</span><span class="nv">$cursor</span><span class="s2">)
          
       if (</span><span class="nv">$selectionStart</span><span class="s2"> -ne -1)
       {
         # Text is selected, wrap it in brackets
         [Microsoft.PowerShell.PSConsoleReadLine]::Replace(</span><span class="nv">$selectionStart</span><span class="s2">, </span><span class="nv">$selectionLength</span><span class="s2">, </span><span class="nv">$key</span><span class="s2">.KeyChar + </span><span class="nv">$line</span><span class="s2">.SubString(</span><span class="nv">$selectionStart</span><span class="s2">, </span><span class="nv">$selectionLength</span><span class="s2">) + </span><span class="nv">$closeChar</span><span class="s2">)
         [Microsoft.PowerShell.PSConsoleReadLine]::SetCursorPosition(</span><span class="nv">$selectionStart</span><span class="s2"> + </span><span class="nv">$selectionLength</span><span class="s2"> + 2)
       } else {
         # No text is selected, insert a pair
         [Microsoft.PowerShell.PSConsoleReadLine]::Insert("</span><span class="si">$(</span><span class="nv">$key</span>.KeyChar<span class="si">)</span><span class="nv">$closeChar</span><span class="s2">")
         [Microsoft.PowerShell.PSConsoleReadLine]::SetCursorPosition(</span><span class="nv">$cursor</span><span class="s2"> + 1)
       }
   }

   Set-PSReadLineKeyHandler -Key ')',']','}' </span><span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> SmartCloseBraces <span class="sb">`</span><span class="s2">
                           -LongDescription "</span>Insert closing brace or skip<span class="s2">" </span><span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>

       <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState<span class="o">([</span>ref]<span class="nv">$line</span>, <span class="o">[</span>ref]<span class="nv">$cursor</span><span class="o">)</span>

       <span class="k">if</span> <span class="o">(</span><span class="nv">$line</span><span class="o">[</span><span class="nv">$cursor</span><span class="o">]</span> <span class="nt">-eq</span> <span class="nv">$key</span>.KeyChar<span class="o">)</span>
       <span class="o">{</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::SetCursorPosition<span class="o">(</span><span class="nv">$cursor</span> + 1<span class="o">)</span>
       <span class="o">}</span>
       <span class="k">else</span>
       <span class="o">{</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Insert<span class="o">(</span><span class="s2">"</span><span class="si">$(</span><span class="nv">$key</span>.KeyChar<span class="si">)</span><span class="s2">"</span><span class="o">)</span>
       <span class="o">}</span>
   <span class="o">}</span>

   Set-PSReadLineKeyHandler <span class="nt">-Key</span> Backspace <span class="sb">`</span><span class="s2">
                           -BriefDescription SmartBackspace </span><span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Delete previous character or matching quotes/parens/braces"</span> <span class="sb">`</span><span class="s2">
                           -ScriptBlock {
       param(</span><span class="nv">$key</span><span class="s2">, </span><span class="nv">$arg</span><span class="s2">)

       </span><span class="nv">$line</span><span class="s2"> = </span><span class="nv">$null</span><span class="s2">
       </span><span class="nv">$cursor</span><span class="s2"> = </span><span class="nv">$null</span><span class="s2">
       [Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState([ref]</span><span class="nv">$line</span><span class="s2">, [ref]</span><span class="nv">$cursor</span><span class="s2">)

       if (</span><span class="nv">$cursor</span><span class="s2"> -gt 0)
       {
           </span><span class="nv">$toMatch</span><span class="s2"> = </span><span class="nv">$null</span><span class="s2">
           if (</span><span class="nv">$cursor</span><span class="s2"> -lt </span><span class="nv">$line</span><span class="s2">.Length)
           {
               switch (</span><span class="nv">$line</span><span class="s2">[</span><span class="nv">$cursor</span><span class="s2">])
               {
                   &lt;#case#&gt; '"</span><span class="s1">' { $toMatch = '</span><span class="s2">"'; break }
                   &lt;#case#&gt; "</span><span class="s1">'" { $toMatch = "'</span><span class="s2">"; break }
                   &lt;#case#&gt; ')' { </span><span class="nv">$toMatch</span><span class="s2"> = '('; break }
                   &lt;#case#&gt; ']' { </span><span class="nv">$toMatch</span><span class="s2"> = '['; break }
                   &lt;#case#&gt; '}' { </span><span class="nv">$toMatch</span><span class="s2"> = '{'; break }
               }
           }

           if (</span><span class="nv">$toMatch</span><span class="s2"> -ne </span><span class="nv">$null</span><span class="s2"> -and </span><span class="nv">$line</span><span class="s2">[</span><span class="nv">$cursor</span><span class="s2">-1] -eq </span><span class="nv">$toMatch</span><span class="s2">)
           {
               [Microsoft.PowerShell.PSConsoleReadLine]::Delete(</span><span class="nv">$cursor</span><span class="s2"> - 1, 2)
           }
           else
           {
               [Microsoft.PowerShell.PSConsoleReadLine]::BackwardDeleteChar(</span><span class="nv">$key</span><span class="s2">, </span><span class="nv">$arg</span><span class="s2">)
           }
       }
   }

   #endregion Smart Insert/Delete

   # Sometimes you enter a command but realize you forgot to do something else first.
   # This binding will let you save that command in the history so you can recall it,
   # but it doesn't actually execute.  It also clears the line with RevertLine so the
   # undo stack is reset - though redo will still reconstruct the command line.
   Set-PSReadLineKeyHandler -Key Alt+w </span><span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> SaveInHistory <span class="sb">`</span><span class="s2">
                           -LongDescription "</span>Save current line <span class="k">in </span><span class="nb">history </span>but <span class="k">do </span>not execute<span class="s2">" </span><span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>

       <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState<span class="o">([</span>ref]<span class="nv">$line</span>, <span class="o">[</span>ref]<span class="nv">$cursor</span><span class="o">)</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::AddToHistory<span class="o">(</span><span class="nv">$line</span><span class="o">)</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::RevertLine<span class="o">()</span>
   <span class="o">}</span>

   <span class="c"># Insert text from the clipboard as a here string</span>
   Set-PSReadLineKeyHandler <span class="nt">-Key</span> Ctrl+V <span class="sb">`</span><span class="s2">
                           -BriefDescription PasteAsHereString </span><span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Paste the clipboard text as a here string"</span> <span class="sb">`</span><span class="s2">
                           -ScriptBlock {
       param(</span><span class="nv">$key</span><span class="s2">, </span><span class="nv">$arg</span><span class="s2">)

       Add-Type -Assembly PresentationCore
       if ([System.Windows.Clipboard]::ContainsText())
       {
           # Get clipboard text - remove trailing spaces, convert </span><span class="se">\r\n</span><span class="s2"> to </span><span class="se">\n</span><span class="s2">, and remove the final </span><span class="se">\n</span><span class="s2">.
           </span><span class="nv">$text</span><span class="s2"> = ([System.Windows.Clipboard]::GetText() -replace "</span><span class="se">\p</span><span class="o">{</span>Zs<span class="o">}</span><span class="k">*</span><span class="sb">`</span><span class="s2">r?</span><span class="sb">`</span>n<span class="s2">","</span><span class="sb">`</span><span class="s2">n"</span><span class="o">)</span>.TrimEnd<span class="o">()</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Insert<span class="o">(</span><span class="s2">"@'</span><span class="sb">`</span>n<span class="nv">$text</span><span class="sb">`</span><span class="s2">n'@"</span><span class="o">)</span>
       <span class="o">}</span>
       <span class="k">else</span>
       <span class="o">{</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Ding<span class="o">()</span>
       <span class="o">}</span>
   <span class="o">}</span>

   <span class="c"># Sometimes you want to get a property of invoke a member on what you've entered so far</span>
   <span class="c"># but you need parens to do that.  This binding will help by putting parens around the current selection,</span>
   <span class="c"># or if nothing is selected, the whole line.</span>
   Set-PSReadLineKeyHandler <span class="nt">-Key</span> <span class="s1">'Alt+('</span> <span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> ParenthesizeSelection <span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Put parenthesis around the selection or entire line and move the cursor to after the closing parenthesis"</span> <span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>

       <span class="nv">$selectionStart</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$selectionLength</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetSelectionState<span class="o">([</span>ref]<span class="nv">$selectionStart</span>, <span class="o">[</span>ref]<span class="nv">$selectionLength</span><span class="o">)</span>

       <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState<span class="o">([</span>ref]<span class="nv">$line</span>, <span class="o">[</span>ref]<span class="nv">$cursor</span><span class="o">)</span>
       <span class="k">if</span> <span class="o">(</span><span class="nv">$selectionStart</span> <span class="nt">-ne</span> <span class="nt">-1</span><span class="o">)</span>
       <span class="o">{</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Replace<span class="o">(</span><span class="nv">$selectionStart</span>, <span class="nv">$selectionLength</span>, <span class="s1">'('</span> + <span class="nv">$line</span>.SubString<span class="o">(</span><span class="nv">$selectionStart</span>, <span class="nv">$selectionLength</span><span class="o">)</span> + <span class="s1">')'</span><span class="o">)</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::SetCursorPosition<span class="o">(</span><span class="nv">$selectionStart</span> + <span class="nv">$selectionLength</span> + 2<span class="o">)</span>
       <span class="o">}</span>
       <span class="k">else</span>
       <span class="o">{</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Replace<span class="o">(</span>0, <span class="nv">$line</span>.Length, <span class="s1">'('</span> + <span class="nv">$line</span> + <span class="s1">')'</span><span class="o">)</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::EndOfLine<span class="o">()</span>
       <span class="o">}</span>
   <span class="o">}</span>

   <span class="c"># Each time you press Alt+', this key handler will change the token</span>
   <span class="c"># under or before the cursor.  It will cycle through single quotes, double quotes, or</span>
   <span class="c"># no quotes each time it is invoked.</span>
   Set-PSReadLineKeyHandler <span class="nt">-Key</span> <span class="s2">"Alt+'"</span> <span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> ToggleQuoteArgument <span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Toggle quotes on the argument under the cursor"</span> <span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>

       <span class="nv">$ast</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$tokens</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$errors</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState<span class="o">([</span>ref]<span class="nv">$ast</span>, <span class="o">[</span>ref]<span class="nv">$tokens</span>, <span class="o">[</span>ref]<span class="nv">$errors</span>, <span class="o">[</span>ref]<span class="nv">$cursor</span><span class="o">)</span>

       <span class="nv">$tokenToChange</span> <span class="o">=</span> <span class="nv">$null</span>
       foreach <span class="o">(</span><span class="nv">$token</span> <span class="k">in</span> <span class="nv">$tokens</span><span class="o">)</span>
       <span class="o">{</span>
           <span class="nv">$extent</span> <span class="o">=</span> <span class="nv">$token</span>.Extent
           <span class="k">if</span> <span class="o">(</span><span class="nv">$extent</span>.StartOffset <span class="nt">-le</span> <span class="nv">$cursor</span> <span class="nt">-and</span> <span class="nv">$extent</span>.EndOffset <span class="nt">-ge</span> <span class="nv">$cursor</span><span class="o">)</span>
           <span class="o">{</span>
               <span class="nv">$tokenToChange</span> <span class="o">=</span> <span class="nv">$token</span>

               <span class="c"># If the cursor is at the end (it's really 1 past the end) of the previous token,</span>
               <span class="c"># we only want to change the previous token if there is no token under the cursor</span>
               <span class="k">if</span> <span class="o">(</span><span class="nv">$extent</span>.EndOffset <span class="nt">-eq</span> <span class="nv">$cursor</span> <span class="nt">-and</span> <span class="nv">$foreach</span>.MoveNext<span class="o">())</span>
               <span class="o">{</span>
                   <span class="nv">$nextToken</span> <span class="o">=</span> <span class="nv">$foreach</span>.Current
                   <span class="k">if</span> <span class="o">(</span><span class="nv">$nextToken</span>.Extent.StartOffset <span class="nt">-eq</span> <span class="nv">$cursor</span><span class="o">)</span>
                   <span class="o">{</span>
                       <span class="nv">$tokenToChange</span> <span class="o">=</span> <span class="nv">$nextToken</span>
                   <span class="o">}</span>
               <span class="o">}</span>
               <span class="nb">break</span>
           <span class="o">}</span>
       <span class="o">}</span>

       <span class="k">if</span> <span class="o">(</span><span class="nv">$tokenToChange</span> <span class="nt">-ne</span> <span class="nv">$null</span><span class="o">)</span>
       <span class="o">{</span>
           <span class="nv">$extent</span> <span class="o">=</span> <span class="nv">$tokenToChange</span>.Extent
           <span class="nv">$tokenText</span> <span class="o">=</span> <span class="nv">$extent</span>.Text
           <span class="k">if</span> <span class="o">(</span><span class="nv">$tokenText</span><span class="o">[</span>0] <span class="nt">-eq</span> <span class="s1">'"'</span> <span class="nt">-and</span> <span class="nv">$tokenText</span><span class="o">[</span><span class="nt">-1</span><span class="o">]</span> <span class="nt">-eq</span> <span class="s1">'"'</span><span class="o">)</span>
           <span class="o">{</span>
               <span class="c"># Switch to no quotes</span>
               <span class="nv">$replacement</span> <span class="o">=</span> <span class="nv">$tokenText</span>.Substring<span class="o">(</span>1, <span class="nv">$tokenText</span>.Length - 2<span class="o">)</span>
           <span class="o">}</span>
           elseif <span class="o">(</span><span class="nv">$tokenText</span><span class="o">[</span>0] <span class="nt">-eq</span> <span class="s2">"'"</span> <span class="nt">-and</span> <span class="nv">$tokenText</span><span class="o">[</span><span class="nt">-1</span><span class="o">]</span> <span class="nt">-eq</span> <span class="s2">"'"</span><span class="o">)</span>
           <span class="o">{</span>
               <span class="c"># Switch to double quotes</span>
               <span class="nv">$replacement</span> <span class="o">=</span> <span class="s1">'"'</span> + <span class="nv">$tokenText</span>.Substring<span class="o">(</span>1, <span class="nv">$tokenText</span>.Length - 2<span class="o">)</span> + <span class="s1">'"'</span>
           <span class="o">}</span>
           <span class="k">else</span>
           <span class="o">{</span>
               <span class="c"># Add single quotes</span>
               <span class="nv">$replacement</span> <span class="o">=</span> <span class="s2">"'"</span> + <span class="nv">$tokenText</span> + <span class="s2">"'"</span>
           <span class="o">}</span>

           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Replace<span class="o">(</span>
               <span class="nv">$extent</span>.StartOffset,
               <span class="nv">$tokenText</span>.Length,
               <span class="nv">$replacement</span><span class="o">)</span>
       <span class="o">}</span>
   <span class="o">}</span>

   <span class="c"># This example will replace any aliases on the command line with the resolved commands.</span>
   Set-PSReadLineKeyHandler <span class="nt">-Key</span> <span class="s2">"Alt+%"</span> <span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> ExpandAliases <span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Replace all aliases with the full command"</span> <span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>

       <span class="nv">$ast</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$tokens</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$errors</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState<span class="o">([</span>ref]<span class="nv">$ast</span>, <span class="o">[</span>ref]<span class="nv">$tokens</span>, <span class="o">[</span>ref]<span class="nv">$errors</span>, <span class="o">[</span>ref]<span class="nv">$cursor</span><span class="o">)</span>

       <span class="nv">$startAdjustment</span> <span class="o">=</span> 0
       foreach <span class="o">(</span><span class="nv">$token</span> <span class="k">in</span> <span class="nv">$tokens</span><span class="o">)</span>
       <span class="o">{</span>
           <span class="k">if</span> <span class="o">(</span><span class="nv">$token</span>.TokenFlags <span class="nt">-band</span> <span class="o">[</span>TokenFlags]::CommandName<span class="o">)</span>
           <span class="o">{</span>
               <span class="nv">$alias</span> <span class="o">=</span> <span class="nv">$ExecutionContext</span>.InvokeCommand.GetCommand<span class="o">(</span><span class="nv">$token</span>.Extent.Text, <span class="s1">'Alias'</span><span class="o">)</span>
               <span class="k">if</span> <span class="o">(</span><span class="nv">$alias</span> <span class="nt">-ne</span> <span class="nv">$null</span><span class="o">)</span>
               <span class="o">{</span>
                   <span class="nv">$resolvedCommand</span> <span class="o">=</span> <span class="nv">$alias</span>.ResolvedCommandName
                   <span class="k">if</span> <span class="o">(</span><span class="nv">$resolvedCommand</span> <span class="nt">-ne</span> <span class="nv">$null</span><span class="o">)</span>
                   <span class="o">{</span>
                       <span class="nv">$extent</span> <span class="o">=</span> <span class="nv">$token</span>.Extent
                       <span class="nv">$length</span> <span class="o">=</span> <span class="nv">$extent</span>.EndOffset - <span class="nv">$extent</span>.StartOffset
                       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Replace<span class="o">(</span>
                           <span class="nv">$extent</span>.StartOffset + <span class="nv">$startAdjustment</span>,
                           <span class="nv">$length</span>,
                           <span class="nv">$resolvedCommand</span><span class="o">)</span>

                       <span class="c"># Our copy of the tokens won't have been updated, so we need to</span>
                       <span class="c"># adjust by the difference in length</span>
                       <span class="nv">$startAdjustment</span> +<span class="o">=</span> <span class="o">(</span><span class="nv">$resolvedCommand</span>.Length - <span class="nv">$length</span><span class="o">)</span>
                   <span class="o">}</span>
               <span class="o">}</span>
           <span class="o">}</span>
       <span class="o">}</span>
   <span class="o">}</span>

   <span class="c"># F1 for help on the command line - naturally</span>
   Set-PSReadLineKeyHandler <span class="nt">-Key</span> F1 <span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> CommandHelp <span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Open the help window for the current command"</span> <span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>

       <span class="nv">$ast</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$tokens</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$errors</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState<span class="o">([</span>ref]<span class="nv">$ast</span>, <span class="o">[</span>ref]<span class="nv">$tokens</span>, <span class="o">[</span>ref]<span class="nv">$errors</span>, <span class="o">[</span>ref]<span class="nv">$cursor</span><span class="o">)</span>

       <span class="nv">$commandAst</span> <span class="o">=</span> <span class="nv">$ast</span>.FindAll<span class="o">(</span> <span class="o">{</span>
           <span class="nv">$node</span> <span class="o">=</span> <span class="nv">$args</span><span class="o">[</span>0]
           <span class="nv">$node</span> <span class="nt">-is</span> <span class="o">[</span>CommandAst] <span class="nt">-and</span>
               <span class="nv">$node</span>.Extent.StartOffset <span class="nt">-le</span> <span class="nv">$cursor</span> <span class="nt">-and</span>
               <span class="nv">$node</span>.Extent.EndOffset <span class="nt">-ge</span> <span class="nv">$cursor</span>
           <span class="o">}</span>, <span class="nv">$true</span><span class="o">)</span> | Select-Object <span class="nt">-Last</span> 1

       <span class="k">if</span> <span class="o">(</span><span class="nv">$commandAst</span> <span class="nt">-ne</span> <span class="nv">$null</span><span class="o">)</span>
       <span class="o">{</span>
           <span class="nv">$commandName</span> <span class="o">=</span> <span class="nv">$commandAst</span>.GetCommandName<span class="o">()</span>
           <span class="k">if</span> <span class="o">(</span><span class="nv">$commandName</span> <span class="nt">-ne</span> <span class="nv">$null</span><span class="o">)</span>
           <span class="o">{</span>
               <span class="nv">$command</span> <span class="o">=</span> <span class="nv">$ExecutionContext</span>.InvokeCommand.GetCommand<span class="o">(</span><span class="nv">$commandName</span>, <span class="s1">'All'</span><span class="o">)</span>
               <span class="k">if</span> <span class="o">(</span><span class="nv">$command</span> <span class="nt">-is</span> <span class="o">[</span>AliasInfo]<span class="o">)</span>
               <span class="o">{</span>
                   <span class="nv">$commandName</span> <span class="o">=</span> <span class="nv">$command</span>.ResolvedCommandName
               <span class="o">}</span>

               <span class="k">if</span> <span class="o">(</span><span class="nv">$commandName</span> <span class="nt">-ne</span> <span class="nv">$null</span><span class="o">)</span>
               <span class="o">{</span>
                   Get-Help <span class="nv">$commandName</span> <span class="nt">-ShowWindow</span>
               <span class="o">}</span>
           <span class="o">}</span>
       <span class="o">}</span>
   <span class="o">}</span>


   <span class="c">#</span>
   <span class="c"># Ctrl+Shift+j then type a key to mark the current directory.</span>
   <span class="c"># Ctrj+j then the same key will change back to that directory without</span>
   <span class="c"># needing to type cd and won't change the command line.</span>

   <span class="c">#</span>
   <span class="nv">$global</span>:PSReadLineMarks <span class="o">=</span> @<span class="o">{}</span>

   Set-PSReadLineKeyHandler <span class="nt">-Key</span> Ctrl+J <span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> MarkDirectory <span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Mark the current directory"</span> <span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>

       <span class="nv">$key</span> <span class="o">=</span> <span class="o">[</span>Console]::ReadKey<span class="o">(</span><span class="nv">$true</span><span class="o">)</span>
       <span class="nv">$global</span>:PSReadLineMarks[<span class="nv">$key</span>.KeyChar] <span class="o">=</span> <span class="nv">$pwd</span>
   <span class="o">}</span>

   Set-PSReadLineKeyHandler <span class="nt">-Key</span> Ctrl+j <span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> JumpDirectory <span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Goto the marked directory"</span> <span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>

       <span class="nv">$key</span> <span class="o">=</span> <span class="o">[</span>Console]::ReadKey<span class="o">()</span>
       <span class="nv">$dir</span> <span class="o">=</span> <span class="nv">$global</span>:PSReadLineMarks[<span class="nv">$key</span>.KeyChar]
       <span class="k">if</span> <span class="o">(</span><span class="nv">$dir</span><span class="o">)</span>
       <span class="o">{</span>
           <span class="nb">cd</span> <span class="nv">$dir</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::InvokePrompt<span class="o">()</span>
       <span class="o">}</span>
   <span class="o">}</span>

   Set-PSReadLineKeyHandler <span class="nt">-Key</span> Alt+j <span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> ShowDirectoryMarks <span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Show the currently marked directories"</span> <span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>

       <span class="nv">$global</span>:PSReadLineMarks.GetEnumerator<span class="o">()</span> | % <span class="o">{</span>
           <span class="o">[</span>PSCustomObject]@<span class="o">{</span>Key <span class="o">=</span> <span class="nv">$_</span>.Key<span class="p">;</span> Dir <span class="o">=</span> <span class="nv">$_</span>.Value<span class="o">}</span> <span class="o">}</span> |
           Format-Table <span class="nt">-AutoSize</span> | Out-Host

       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::InvokePrompt<span class="o">()</span>
   <span class="o">}</span>

   <span class="c"># Auto correct 'git cmt' to 'git commit'</span>
   Set-PSReadLineOption <span class="nt">-CommandValidationHandler</span> <span class="o">{</span>
       param<span class="o">([</span>CommandAst]<span class="nv">$CommandAst</span><span class="o">)</span>

       switch <span class="o">(</span><span class="nv">$CommandAst</span>.GetCommandName<span class="o">())</span>
       <span class="o">{</span>
           <span class="s1">'git'</span> <span class="o">{</span>
               <span class="nv">$gitCmd</span> <span class="o">=</span> <span class="nv">$CommandAst</span>.CommandElements[1].Extent
               switch <span class="o">(</span><span class="nv">$gitCmd</span>.Text<span class="o">)</span>
               <span class="o">{</span>
                   <span class="s1">'cmt'</span> <span class="o">{</span>
                       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Replace<span class="o">(</span>
                           <span class="nv">$gitCmd</span>.StartOffset, <span class="nv">$gitCmd</span>.EndOffset - <span class="nv">$gitCmd</span>.StartOffset, <span class="s1">'commit'</span><span class="o">)</span>
                   <span class="o">}</span>
               <span class="o">}</span>
           <span class="o">}</span>
       <span class="o">}</span>
   <span class="o">}</span>

   <span class="c"># `ForwardChar` accepts the entire suggestion text when the cursor is at the end of the line.</span>
   <span class="c"># This custom binding makes `RightArrow` behave similarly - accepting the next word instead of the entire suggestion text.</span>
   Set-PSReadLineKeyHandler <span class="nt">-Key</span> RightArrow <span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> ForwardCharAndAcceptNextSuggestionWord <span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Move cursor one character to the right in the current editing line and accept the next word in suggestion when it's at the end of current editing line"</span> <span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>

       <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState<span class="o">([</span>ref]<span class="nv">$line</span>, <span class="o">[</span>ref]<span class="nv">$cursor</span><span class="o">)</span>

       <span class="k">if</span> <span class="o">(</span><span class="nv">$cursor</span> <span class="nt">-lt</span> <span class="nv">$line</span>.Length<span class="o">)</span> <span class="o">{</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::ForwardChar<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>
       <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::AcceptNextSuggestionWord<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>
       <span class="o">}</span>
   <span class="o">}</span>

   <span class="c"># Cycle through arguments on current line and select the text. This makes it easier to quickly change the argument if re-running a previously run command from the history</span>
   <span class="c"># or if using a psreadline predictor. You can also use a digit argument to specify which argument you want to select, i.e. Alt+1, Alt+a selects the first argument</span>
   <span class="c"># on the command line. </span>
   Set-PSReadLineKeyHandler <span class="nt">-Key</span> Alt+a <span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> SelectCommandArguments <span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Set current selection to next command argument in the command line. Use of digit argument selects argument by position"</span> <span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       param<span class="o">(</span><span class="nv">$key</span>, <span class="nv">$arg</span><span class="o">)</span>
        
       <span class="nv">$ast</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$null</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::GetBufferState<span class="o">([</span>ref]<span class="nv">$ast</span>, <span class="o">[</span>ref]<span class="nv">$null</span>, <span class="o">[</span>ref]<span class="nv">$null</span>, <span class="o">[</span>ref]<span class="nv">$cursor</span><span class="o">)</span>
        
       <span class="nv">$asts</span> <span class="o">=</span> <span class="nv">$ast</span>.FindAll<span class="o">(</span> <span class="o">{</span>
           <span class="nv">$args</span><span class="o">[</span>0] <span class="nt">-is</span> <span class="o">[</span>System.Management.Automation.Language.ExpressionAst] <span class="nt">-and</span>
           <span class="nv">$args</span><span class="o">[</span>0].Parent <span class="nt">-is</span> <span class="o">[</span>System.Management.Automation.Language.CommandAst] <span class="nt">-and</span>
           <span class="nv">$args</span><span class="o">[</span>0].Extent.StartOffset <span class="nt">-ne</span> <span class="nv">$args</span><span class="o">[</span>0].Parent.Extent.StartOffset
         <span class="o">}</span>, <span class="nv">$true</span><span class="o">)</span>
        
       <span class="k">if</span> <span class="o">(</span><span class="nv">$asts</span>.Count <span class="nt">-eq</span> 0<span class="o">)</span> <span class="o">{</span>
           <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Ding<span class="o">()</span>
           <span class="k">return</span>
       <span class="o">}</span>
          
       <span class="nv">$nextAst</span> <span class="o">=</span> <span class="nv">$null</span>

       <span class="k">if</span> <span class="o">(</span><span class="nv">$null</span> <span class="nt">-ne</span> <span class="nv">$arg</span><span class="o">)</span> <span class="o">{</span>
           <span class="nv">$nextAst</span> <span class="o">=</span> <span class="nv">$asts</span><span class="o">[</span><span class="nv">$arg</span> - 1]
       <span class="o">}</span>
       <span class="k">else</span> <span class="o">{</span>
           foreach <span class="o">(</span><span class="nv">$ast</span> <span class="k">in</span> <span class="nv">$asts</span><span class="o">)</span> <span class="o">{</span>
               <span class="k">if</span> <span class="o">(</span><span class="nv">$ast</span>.Extent.StartOffset <span class="nt">-ge</span> <span class="nv">$cursor</span><span class="o">)</span> <span class="o">{</span>
                   <span class="nv">$nextAst</span> <span class="o">=</span> <span class="nv">$ast</span>
                   <span class="nb">break</span>
               <span class="o">}</span>
           <span class="o">}</span> 
              
           <span class="k">if</span> <span class="o">(</span><span class="nv">$null</span> <span class="nt">-eq</span> <span class="nv">$nextAst</span><span class="o">)</span> <span class="o">{</span>
               <span class="nv">$nextAst</span> <span class="o">=</span> <span class="nv">$asts</span><span class="o">[</span>0]
           <span class="o">}</span>
       <span class="o">}</span>

       <span class="nv">$startOffsetAdjustment</span> <span class="o">=</span> 0
       <span class="nv">$endOffsetAdjustment</span> <span class="o">=</span> 0

       <span class="k">if</span> <span class="o">(</span><span class="nv">$nextAst</span> <span class="nt">-is</span> <span class="o">[</span>System.Management.Automation.Language.StringConstantExpressionAst] <span class="nt">-and</span>
           <span class="nv">$nextAst</span>.StringConstantType <span class="nt">-ne</span> <span class="o">[</span>System.Management.Automation.Language.StringConstantType]::BareWord<span class="o">)</span> <span class="o">{</span>
               <span class="nv">$startOffsetAdjustment</span> <span class="o">=</span> 1
               <span class="nv">$endOffsetAdjustment</span> <span class="o">=</span> 2
       <span class="o">}</span>
        
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::SetCursorPosition<span class="o">(</span><span class="nv">$nextAst</span>.Extent.StartOffset + <span class="nv">$startOffsetAdjustment</span><span class="o">)</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::SetMark<span class="o">(</span><span class="nv">$null</span>, <span class="nv">$null</span><span class="o">)</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::SelectForwardChar<span class="o">(</span><span class="nv">$null</span>, <span class="o">(</span><span class="nv">$nextAst</span>.Extent.EndOffset - <span class="nv">$nextAst</span>.Extent.StartOffset<span class="o">)</span> - <span class="nv">$endOffsetAdjustment</span><span class="o">)</span>
   <span class="o">}</span>


   Set-PSReadLineOption <span class="nt">-PredictionSource</span> History
   Set-PSReadLineOption <span class="nt">-PredictionViewStyle</span> ListView
   Set-PSReadLineOption <span class="nt">-EditMode</span> Windows


   <span class="c"># This is an example of a macro that you might use to execute a command.</span>
   <span class="c"># This will add the command to history.</span>
   Set-PSReadLineKeyHandler <span class="nt">-Key</span> Ctrl+Shift+b <span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> BuildCurrentDirectory <span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Build the current directory"</span> <span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::RevertLine<span class="o">()</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Insert<span class="o">(</span><span class="s2">"dotnet build"</span><span class="o">)</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::AcceptLine<span class="o">()</span>
   <span class="o">}</span>

   Set-PSReadLineKeyHandler <span class="nt">-Key</span> Ctrl+Shift+t <span class="sb">`</span>
                           <span class="nt">-BriefDescription</span> BuildCurrentDirectory <span class="sb">`</span>
                           <span class="nt">-LongDescription</span> <span class="s2">"Build the current directory"</span> <span class="sb">`</span>
                           <span class="nt">-ScriptBlock</span> <span class="o">{</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::RevertLine<span class="o">()</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::Insert<span class="o">(</span><span class="s2">"dotnet test"</span><span class="o">)</span>
       <span class="o">[</span>Microsoft.PowerShell.PSConsoleReadLine]::AcceptLine<span class="o">()</span>
   <span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ol>

<ul>
  <li>You can follow this reference: https://ohmyposh.dev/docs/installation/prompt</li>
</ul>

<ol>
  <li><strong>Configure Terminal Settings</strong>
    <ul>
      <li>Open Windows Terminal and go to <strong>Settings</strong>.</li>
      <li>At the bottom, click on <strong>Open JSON file</strong>.</li>
      <li>The <code class="language-plaintext highlighter-rouge">settings.json</code> file will open in your default text editor.</li>
      <li>Add the following lines to the <code class="language-plaintext highlighter-rouge">settings.json</code> file to enable Oh My Posh:</li>
      <li>Here is my settings.json file. You can copy and paste it into your settings.json file. https://gist.github.com/mahedee/44fa5b644aa06597456d8cac5c2f3dd2</li>
    </ul>
  </li>
</ol>

<p><strong>settings.json</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"$help"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://aka.ms/terminal-documentation"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"$schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://aka.ms/terminal-profiles-schema"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"actions"</span><span class="p">:</span><span class="w"> 
        </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> 
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"copy"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"singleLine"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User.copy.644BA8F2"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ctrl+c"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> 
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"newTab"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User.newTab.5DEADB41"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ctrl+t"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> 
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"commandPalette"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User.commandPalette.D3F0B923"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ctrl+shift+p"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> 
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"splitPane"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"split"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"splitMode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"duplicate"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User.splitPane.A6751878"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alt+shift+d"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"paste"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User.paste"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ctrl+v"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"toggleAlwaysOnTop"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User.toggleAlwaysOnTop"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alt+shift+f11"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"closePane"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User.closePane"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ctrl+w"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> 
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"splitPane"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User.splitPane.91AB55B1"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ctrl+shift+minus"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"toggleFocusMode"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User.toggleFocusMode"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"shift+f11"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unbound"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ctrl+d"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">"find"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User.find"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ctrl+shift+f"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> 
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"openSettings"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"settingsUI"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User.openSettings.6CD791B"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ctrl+shift+comma"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"copyFormatting"</span><span class="p">:</span><span class="w"> </span><span class="s2">"none"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"copyOnSelect"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"defaultProfile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{61c54bbd-c2c6-5271-96e7-009a87ff44bf}"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"newTabMenu"</span><span class="p">:</span><span class="w"> 
        </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"remainingProfiles"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"profiles"</span><span class="p">:</span><span class="w"> 
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"defaults"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
            </span><span class="nl">"list"</span><span class="p">:</span><span class="w"> 
            </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"commandline"</span><span class="p">:</span><span class="w"> </span><span class="s2">"%SystemRoot%</span><span class="se">\\</span><span class="s2">System32</span><span class="se">\\</span><span class="s2">WindowsPowerShell</span><span class="se">\\</span><span class="s2">v1.0</span><span class="se">\\</span><span class="s2">powershell.exe"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"font"</span><span class="p">:</span><span class="w"> 
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"face"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CaskaydiaCove Nerd Font"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nl">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{61c54bbd-c2c6-5271-96e7-009a87ff44bf}"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Windows PowerShell"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"commandline"</span><span class="p">:</span><span class="w"> </span><span class="s2">"%SystemRoot%</span><span class="se">\\</span><span class="s2">System32</span><span class="se">\\</span><span class="s2">cmd.exe"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{0caa0dad-35be-5f56-a8ff-afceeeaa6101}"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Command Prompt"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{b453ae62-4e3d-5e58-b989-0a998ec441b8}"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Azure Cloud Shell"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Windows.Terminal.Azure"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{8d610568-1d18-58b9-abbd-c7eec0a40dd4}"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Developer Command Prompt for VS 2022"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Windows.Terminal.VisualStudio"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{97f5749f-a899-50f2-a042-7cf1e52bf252}"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Developer PowerShell for VS 2022"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Windows.Terminal.VisualStudio"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"commandline"</span><span class="p">:</span><span class="w"> </span><span class="s2">"C:</span><span class="se">\\</span><span class="s2">Program Files</span><span class="se">\\</span><span class="s2">Git</span><span class="se">\\</span><span class="s2">bin</span><span class="se">\\</span><span class="s2">bash.exe"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"font"</span><span class="p">:</span><span class="w"> 
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"face"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CaskaydiaCove Nerd Font"</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="nl">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{0b98aac8-d3d9-404f-a6a5-236565bb4610}"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"C:</span><span class="se">\\</span><span class="s2">Program Files</span><span class="se">\\</span><span class="s2">Git</span><span class="se">\\</span><span class="s2">mingw64</span><span class="se">\\</span><span class="s2">share</span><span class="se">\\</span><span class="s2">git</span><span class="se">\\</span><span class="s2">git-for-windows.ico"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Git Bash"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"startingDirectory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"%USERPROFILE%"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{16208362-94fc-5b1f-a491-5b2624d5ab56}"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Visual Studio Debug Console"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VSDebugConsole"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{72b5d9e6-2c71-5e9a-bf26-e8f53ae4c661}"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Developer Command Prompt for VS 2022 (2)"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Windows.Terminal.VisualStudio"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{62090c5f-ff51-5b36-8031-449b2b91dff2}"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Developer PowerShell for VS 2022 (2)"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Windows.Terminal.VisualStudio"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"schemes"</span><span class="p">:</span><span class="w"> 
        </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"background"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#300A24"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"black"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#171421"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"blue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#0037DA"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"brightBlack"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#767676"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"brightBlue"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#08458F"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"brightCyan"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#2C9FB3"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"brightGreen"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#26A269"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"brightPurple"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#A347BA"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"brightRed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#C01C28"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"brightWhite"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#F2F2F2"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"brightYellow"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#A2734C"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"cursorColor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#FFFFFF"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"cyan"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#3A96DD"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"foreground"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#FFFFFF"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"green"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#26A269"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ubuntu-ColorScheme"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"purple"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#881798"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"red"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#C21A23"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"selectionBackground"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#FFFFFF"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"white"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#CCCCCC"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"yellow"</span><span class="p">:</span><span class="w"> </span><span class="s2">"#A2734C"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"themes"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>Run the following command to Install PowerShell Gallery Modules. This is used to install the Terminal-Icons module, which is required by Oh My Posh:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Install-Module <span class="nt">-Name</span> Terminal-Icons <span class="nt">-Repository</span> PSGallery
</code></pre></div></div>

<ol>
  <li><strong>Configure Theme</strong>:
    <ul>
      <li>You can choose a theme from the <a href="https://ohmyposh.dev/docs/themes">Oh My Posh theme gallery</a>.</li>
      <li>Generally themes are located in <code class="language-plaintext highlighter-rouge">C:\Users\{your-username}\AppData\Local\Programs\oh-my-posh\themes</code>.</li>
      <li>
        <p>You can initialize Oh My Posh with a specific theme by running the following command:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oh-my-posh init pwsh <span class="nt">--config</span> C:<span class="se">\U</span>sers<span class="se">\{</span>your-username<span class="o">}</span><span class="se">\A</span>ppData<span class="se">\L</span>ocal<span class="se">\P</span>rograms<span class="se">\o</span>h-my-posh<span class="se">\t</span>hemes<span class="se">\j</span>andedobbeleer.omp.json | Invoke-Expression
</code></pre></div>        </div>
      </li>
      <li>In my case, I have created a custom theme named <code class="language-plaintext highlighter-rouge">myposh-mahedee.omp.json</code></li>
      <li>
        <p>You can copy it from here:
https://gist.github.com/mahedee/e93c0f1f145dcb6db804c73fa4ed859e</p>
      </li>
      <li>Create a file named <code class="language-plaintext highlighter-rouge">myposh-mahedee.omp.json</code> and copy it to the themes directory.</li>
      <li>
        <p>Now initialize Oh My Posh with this theme:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oh-my-posh init pwsh <span class="nt">--config</span> C:<span class="se">\U</span>sers<span class="se">\{</span>your-username<span class="o">}</span><span class="se">\A</span>ppData<span class="se">\L</span>ocal<span class="se">\P</span>rograms<span class="se">\o</span>h-my-posh<span class="se">\t</span>hemes<span class="se">\m</span>yposh-mahedee.omp.json | Invoke-Expression
</code></pre></div>        </div>
      </li>
      <li>
        <p>In my case and as per example below, you will see the theme is configured in the PowerShell profile script - Microsoft.PowerShell_profile.ps1 as follows:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> oh-my-posh init pwsh <span class="nt">--config</span> C:<span class="se">\U</span>sers<span class="se">\m</span>ahedee<span class="se">\A</span>ppData<span class="se">\L</span>ocal<span class="se">\P</span>rograms<span class="se">\o</span>h-my-posh<span class="se">\t</span>hemes<span class="se">\m</span>yposh-mahedee.omp.json | Invoke-Expression
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<p><strong>Step 6: Configure IntelliSense in PowerShell using PSReadLine</strong></p>
<ul>
  <li>Install the PSReadLine module by running the following command in PowerShell:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Install-Module <span class="nt">-Name</span> PSReadLine <span class="nt">-AllowClobber</span> <span class="nt">-Force</span>
</code></pre></div>    </div>
    <p>References: https://learn.microsoft.com/en-us/powershell/module/psreadline/about/about_psreadline?view=powershell-7.4</p>
  </li>
  <li>Enable Predictive IntelliSense by running the following command:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Set-PSReadLineOption <span class="nt">-PredictionSource</span> History
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Step 7: Restart Windows Terminal</strong></p>
<ul>
  <li>After saving the profile, close and reopen Windows Terminal to see the changes.</li>
  <li>Now you should see the Oh My Posh theme applied to your PowerShell prompt, making it visually appealing and informative.</li>
  <li>Use the terminal as you normally would, and enjoy the enhanced experience provided by Oh My Posh.</li>
  <li>You can see the theme is applied in the PowerShell prompt as shown below:</li>
</ul>

<p><img src="/assets/images/posts/2024/my-terminal.png" alt="Oh My Posh Theme" /></p>

<p><strong>Efficient Command Usage and History</strong></p>

<p>Windows Terminal makes it easy to work efficiently and navigate your history:</p>

<ol>
  <li>
    <p><strong>Use the Up and Down Arrow Keys</strong>: To quickly scroll through the history of commands.</p>
  </li>
  <li>
    <p><strong>Search Through History</strong>: Press <strong>Ctrl + R</strong> and start typing a command to search for it.</p>
  </li>
  <li>
    <p><strong>Save Command History</strong>: By default, PowerShell saves the history. If you want to ensure your history is saved across sessions, add this to your <code class="language-plaintext highlighter-rouge">$PROFILE</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$historyPath</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$env</span><span class="s2">:USERPROFILE</span><span class="se">\D</span><span class="s2">ocuments</span><span class="se">\P</span><span class="s2">owerShell_history.txt"</span>
<span class="k">if</span> <span class="o">(</span>Test-Path <span class="nv">$historyPath</span><span class="o">)</span> <span class="o">{</span>
    Get-Content <span class="nv">$historyPath</span> | Add-History
<span class="o">}</span>
Register-EngineEvent PowerShell.Exiting <span class="nt">-Action</span> <span class="o">{</span> Get-History | Export-Csv <span class="nv">$historyPath</span> <span class="nt">-NoTypeInformation</span> <span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Use Aliases for Common Commands</strong>:
In PowerShell or Git Bash, create aliases for long commands to make them quicker to type:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Set-Alias gs git status
Set-Alias gl git log
</code></pre></div>    </div>
  </li>
</ol>

<p><strong>Additional Tips and Tricks</strong></p>

<ol>
  <li><strong>Split Panes</strong>: You can split your terminal into multiple panes.
    <ul>
      <li><strong>Ctrl + Shift + D</strong>: Split horizontally.</li>
      <li><strong>Alt + Shift + D</strong>: Split vertically.</li>
      <li><strong>Ctrl + Shift + W</strong>: Close a pane.</li>
    </ul>
  </li>
  <li><strong>Quick Access to Profiles</strong>: You can easily switch between profiles in Windows Terminal via the dropdown menu or by using the keyboard shortcut.
    <ul>
      <li><strong>Ctrl + Tab</strong>: Cycle through profiles.</li>
      <li><strong>Ctrl + Shift + Tab</strong>: Cycle through profiles in reverse order.</li>
    </ul>
  </li>
  <li><strong>Use Profiles for Different Environments</strong>: Create multiple profiles for PowerShell, Git Bash, WSL, or other environments and switch seamlessly between them.</li>
</ol>

<p><strong>Conclusion</strong></p>

<p>By following these steps, you’ve successfully set up a productive and efficient Windows Terminal environment. With <strong>Oh My Posh</strong>, you’ve made your PowerShell experience visually appealing and informative. You’ve also integrated <strong>Git Bash</strong> for a seamless Unix-like experience on Windows, making it easier to switch between different tools and environments. Similar way you can include Ubuntu, putty etc.</p>

<p>Windows Terminal offers unmatched flexibility in managing your development tools, and with the addition of themes, custom profiles, and persistent command history, your workflow will be more efficient than ever before.</p>

<p>Happy coding!</p>]]></content><author><name>Mahedee Hasan</name></author><category term="Windows" /><category term="Terminal" /><category term="Git Bash" /><category term="Productivity" /><category term="PowerShell" /><category term="windows" /><category term="terminal" /><category term="gitbash" /><category term="productivity" /><category term="powershell" /><summary type="html"><![CDATA[Discover how to enhance your productivity by setting up and customizing Windows Terminal with Git Bash and Oh My Posh. This comprehensive guide walks you through the installation, configuration, and optimization of your terminal environment, making it easier and more efficient to work on development projects.]]></summary></entry><entry><title type="html">How to Configure SSL and HTTPS for RabbitMQ in Docker</title><link href="https://mahedee.net//how-to-configure-ssl-and-https-for-rabbitmq-in-docker/" rel="alternate" type="text/html" title="How to Configure SSL and HTTPS for RabbitMQ in Docker" /><published>2024-08-02T00:00:00-04:00</published><updated>2024-08-02T00:00:00-04:00</updated><id>https://mahedee.net//how-to-configure-ssl-and-https-for-rabbitmq-in-docker</id><content type="html" xml:base="https://mahedee.net//how-to-configure-ssl-and-https-for-rabbitmq-in-docker/"><![CDATA[<p>Securing RabbitMQ with SSL/TLS and enabling HTTPS access for the Management UI is essential to protect data and ensure a secure environment. This guide walks you through the steps to set up RabbitMQ with SSL/TLS on Docker Desktop and enable HTTPS for the Management UI. Follow along to configure RabbitMQ to handle encrypted AMQP connections as well as a secure Management interface.</p>

<p><strong>Prerequisites</strong></p>

<p>To follow this guide, you’ll need:</p>
<ol>
  <li><strong>Docker Desktop</strong>: Installed and running on your machine.</li>
  <li><strong>RabbitMQ Configuration Files</strong>: Basic familiarity with RabbitMQ configurations and SSL certificates.</li>
  <li><strong>OpenSSL</strong>: To create self-signed certificates if needed.</li>
</ol>

<p><strong>Step 1: Create SSL/TLS Certificates</strong></p>

<p>To secure RabbitMQ over SSL, you’ll need three key files:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">ca_certificate.pem</code>: Certificate Authority (CA) certificate. This file is required for RabbitMQ to validate client certificates.</li>
  <li><code class="language-plaintext highlighter-rouge">server_certificate.pem</code>: Server certificate signed by the CA. This file is used by RabbitMQ to authenticate itself to clients.</li>
  <li><code class="language-plaintext highlighter-rouge">server_key.pem</code>: Private key for the server certificate. This file is used by RabbitMQ to decrypt incoming client requests.</li>
</ul>

<p><strong>Creating Self-Signed Certificates</strong></p>

<p><strong>1: Create a Certificate Authority (CA)</strong></p>

<p>First, create a CA certificate to sign the server certificate.</p>

<p>1.1 <strong>Generate a private key for the CA</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   openssl genpkey <span class="nt">-algorithm</span> RSA <span class="nt">-out</span> ca_key.pem <span class="nt">-aes256</span>
</code></pre></div></div>

<ul>
  <li>You’ll be prompted to create a passphrase for the CA key. Remember this, as it will be needed to sign certificates.</li>
</ul>

<p>1.2 <strong>Generate a CA certificate</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   openssl req <span class="nt">-x509</span> <span class="nt">-new</span> <span class="nt">-nodes</span> <span class="nt">-key</span> ca_key.pem <span class="nt">-sha256</span> <span class="nt">-days</span> 3650 <span class="nt">-out</span> ca_certificate.pem
</code></pre></div></div>

<ul>
  <li>You’ll be asked to fill out details for the CA certificate (such as country, organization, etc.). This will generate the <code class="language-plaintext highlighter-rouge">ca_certificate.pem</code> file.</li>
  <li>You can keep everything blank if you’re creating a self-signed certificate for testing purposes.</li>
</ul>

<p><strong>2: Create the Server Certificate and Key</strong></p>

<p>Next, create the server certificate that RabbitMQ will use, signed by your CA.</p>

<p>2.1. <strong>Generate a private key for the server</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   openssl genpkey <span class="nt">-algorithm</span> RSA <span class="nt">-out</span> server_key.pem
</code></pre></div></div>

<p>2.2. <strong>Create a Certificate Signing Request (CSR) for the server certificate</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   openssl req <span class="nt">-new</span> <span class="nt">-key</span> server_key.pem <span class="nt">-out</span> server_csr.pem
</code></pre></div></div>

<ul>
  <li>You’ll be prompted to enter details for the server. Be sure to set <code class="language-plaintext highlighter-rouge">Common Name (CN)</code> to the server’s hostname or IP address, as clients will check this when verifying the server’s identity.</li>
  <li>You can keep other fields blank for testing purposes.</li>
</ul>

<p>2.3. <strong>Sign the server certificate with the CA</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   openssl x509 <span class="nt">-req</span> <span class="nt">-in</span> server_csr.pem <span class="nt">-CA</span> ca_certificate.pem <span class="nt">-CAkey</span> ca_key.pem <span class="nt">-CAcreateserial</span> <span class="nt">-out</span> server_certificate.pem <span class="nt">-days</span> 3650 <span class="nt">-sha256</span>
</code></pre></div></div>

<ul>
  <li>This step signs the <code class="language-plaintext highlighter-rouge">server_certificate.pem</code> with <code class="language-plaintext highlighter-rouge">ca_certificate.pem</code>, creating a valid SSL certificate for the server. The <code class="language-plaintext highlighter-rouge">-CAcreateserial</code> flag creates a <code class="language-plaintext highlighter-rouge">ca_certificate.srl</code> file that manages the CA’s serial numbers for certificates.</li>
</ul>

<p>After completing the above steps, you should have these files:</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">ca_certificate.pem</code></strong>: The CA certificate file used to verify server identity.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">server_certificate.pem</code></strong>: The server’s signed certificate file.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">server_key.pem</code></strong>: The server’s private key file.</li>
</ul>

<p>These files can now be used in the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> setup you configured earlier. Ensure the certificates are placed in the correct <code class="language-plaintext highlighter-rouge">certs</code> directory and that permissions are set to secure access to the private key (<code class="language-plaintext highlighter-rouge">server_key.pem</code>).</p>

<p><strong>Step 2: Set Up <code class="language-plaintext highlighter-rouge">rabbitmq.conf</code> for SSL and HTTPS</strong></p>

<p>RabbitMQ requires configurations to enable SSL for AMQP client connections (on port 5671) and HTTPS for the Management UI (on port 15671). Let’s create a <code class="language-plaintext highlighter-rouge">rabbitmq.conf</code> file with these configurations:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># SSL settings for the main AMQP listener (used for client connections over SSL/TLS)
listeners.ssl.default = 5671                     # AMQP listener over SSL/TLS on port 5671
ssl_options.cacertfile = /etc/rabbitmq/certs/ca_certificate.pem  # Path to the CA certificate to verify client certificates
ssl_options.certfile = /etc/rabbitmq/certs/server_certificate.pem # Path to the server certificate for RabbitMQ
ssl_options.keyfile = /etc/rabbitmq/certs/server_key.pem         # Path to the server private key for SSL
ssl_options.verify = verify_peer                # Requires clients to present valid certificates (mutual authentication)
ssl_options.fail_if_no_peer_cert = true         # Disconnects clients if they don't present a valid certificate

# Enable HTTPS for the management interface
management.listener.port = 15671                # Port for accessing RabbitMQ Management UI over HTTPS
management.listener.ssl = true                  # Enable SSL for the management UI listener
management.listener.ip = 0.0.0.0                # Bind to all available network interfaces to accept external connections

# SSL options for HTTPS management listener
management.listener.ssl_opts.cacertfile = /etc/rabbitmq/certs/ca_certificate.pem  # CA certificate for HTTPS verification
management.listener.ssl_opts.certfile = /etc/rabbitmq/certs/server_certificate.pem # Server certificate for HTTPS
management.listener.ssl_opts.keyfile = /etc/rabbitmq/certs/server_key.pem         # Private key for HTTPS
management.listener.ssl_opts.verify = verify_none          # Allows clients to access without presenting a client certificate
management.listener.ssl_opts.fail_if_no_peer_cert = false  # Does not require client certificates for HTTPS access

</code></pre></div></div>

<p>In this configuration:</p>
<ul>
  <li><strong>AMQP (5671)</strong>: The <code class="language-plaintext highlighter-rouge">verify_peer</code> and <code class="language-plaintext highlighter-rouge">fail_if_no_peer_cert</code> options enforce strict client certificate validation.</li>
  <li><strong>Management UI (15671)</strong>: Allows HTTPS access without requiring client certificates.</li>
</ul>

<p>Save this file as <code class="language-plaintext highlighter-rouge">rabbitmq.conf</code>.</p>

<p><strong>Step 3: Configure <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> for RabbitMQ</strong></p>

<p>To set up RabbitMQ with the configurations and certificates, we need to update <code class="language-plaintext highlighter-rouge">docker-compose.yml</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">rabbitmq</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">rabbitmq:3-management</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">rabbitmq</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5671:5671"</span>         <span class="c1"># RabbitMQ SSL port</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">15671:15671"</span>       <span class="c1"># RabbitMQ management plugin port</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">RABBITMQ_DEFAULT_USER</span><span class="pi">:</span> <span class="s">user</span>             <span class="c1"># Default username</span>
      <span class="na">RABBITMQ_DEFAULT_PASS</span><span class="pi">:</span> <span class="s">password</span>         <span class="c1"># Default password</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">rabbitmq_data:/var/lib/rabbitmq</span>      <span class="c1"># Data persistence</span>
      <span class="pi">-</span> <span class="s">./certs:/etc/rabbitmq/certs</span>          <span class="c1"># Mount the certs directory of local machine to the container directory</span>
      <span class="pi">-</span> <span class="s">./rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf</span>  <span class="c1"># Custom RabbitMQ configuration file. This file is used to enable SSL and configure the SSL certificates. rabbitmq.conf file is mounted to the container directory /etc/rabbitmq/rabbitmq.conf</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">rabbitmq-server"</span><span class="pi">]</span>            <span class="c1"># Start the RabbitMQ server. This command is used to start the RabbitMQ server with the custom configuration file.</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">rabbitmq_data</span><span class="pi">:</span>

<span class="c1">#rabbitmq_data is mounted to /var/lib/rabbitmq inside the container. RabbitMQ stores its data in /var/lib/rabbitmq by default, so mounting a persistent volume to this location ensures that data generated by RabbitMQ is saved in the rabbitmq_data volume.</span>

</code></pre></div></div>

<p><strong>Explanation of the Volume Mounts</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">rabbitmq_data</code>: Ensures RabbitMQ data (queues, exchanges, etc.) persist across container restarts.</li>
  <li><code class="language-plaintext highlighter-rouge">./certs</code>: Mounts the local certificates folder to <code class="language-plaintext highlighter-rouge">/etc/rabbitmq/certs</code> inside the container, where RabbitMQ can access them.</li>
  <li><code class="language-plaintext highlighter-rouge">./rabbitmq.conf</code>: Mounts the custom configuration file into <code class="language-plaintext highlighter-rouge">/etc/rabbitmq/rabbitmq.conf</code> inside the container.</li>
</ul>

<p>The folder structure as follows:</p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rabbitmq-ssl
│   docker-compose.yml
│   rabbitmq.conf
│   certs/
│       ca_certificate.pem
│       server_certificate.pem
│       server_key.pem
</code></pre></div></div>

<p><strong>Step 4: Start RabbitMQ and Verify SSL Configuration</strong></p>

<ol>
  <li>
    <p>Run the following command to start the RabbitMQ container with HTTPS and SSL enabled:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up <span class="nt">-d</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Verify that RabbitMQ is listening on the correct ports:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker ps
</code></pre></div>    </div>
    <p>You should see ports 5671 (for AMQP over SSL) and 15671 (for HTTPS management) mapped.</p>
  </li>
</ol>

<p><strong>Step 5: Access the RabbitMQ Management UI over HTTPS</strong></p>

<p>Open your browser and navigate to <code class="language-plaintext highlighter-rouge">https://localhost:15671</code>. If you’re using a self-signed certificate, you’ll likely see a security warning. Proceed by accepting the certificate to access the Management UI.</p>

<p><strong>Step 6: Configure AMQP Clients for SSL Connections</strong></p>

<p>For applications or services that connect to RabbitMQ over AMQP, use the following settings:</p>
<ul>
  <li><strong>URL</strong>: <code class="language-plaintext highlighter-rouge">amqps://localhost:5671</code></li>
  <li><strong>CA Certificate</strong>: <code class="language-plaintext highlighter-rouge">ca_certificate.pem</code> (for client validation)</li>
</ul>

<p>Client applications should verify the RabbitMQ server certificate by using <code class="language-plaintext highlighter-rouge">ca_certificate.pem</code>. Depending on the client library, you may need to specify additional SSL options.</p>

<p><strong>Troubleshooting Tips</strong></p>

<ul>
  <li><strong>Permissions</strong>: Ensure that the <code class="language-plaintext highlighter-rouge">.pem</code> files are readable by the RabbitMQ process inside the container.</li>
  <li><strong>SSL/TLS Version Compatibility</strong>: Some clients may have specific SSL/TLS requirements. Ensure your configuration aligns with the client’s requirements.</li>
</ul>

<p><strong>Conclusion</strong></p>

<p>Setting up RabbitMQ with SSL/TLS and enabling HTTPS access for the Management UI greatly enhances security, especially in production environments. With these configurations, RabbitMQ can securely handle both AMQP client connections and browser-based management over HTTPS.</p>

<p>Following these steps, you’ll have a robust, secure RabbitMQ instance that protects your data in transit and allows safe administration.</p>

<p><strong>Note for docker container:</strong></p>
<ul>
  <li>docker exec -it rabbitmq bash - access the container terminal, rabbitmq is the container name</li>
  <li>docker exec -it rabbitmq ls -l /etc/rabbitmq/certs - list the certs in the container</li>
  <li>You can access container terminal from docker desktop as follows:
    <ul>
      <li>Click on the container</li>
      <li>Click on Termianl tab</li>
    </ul>
  </li>
</ul>]]></content><author><name>Mahedee Hasan</name></author><category term="RabbitMQ" /><category term="Docker" /><category term="SSL" /><category term="rabbitmq" /><category term="docker" /><category term="ssl" /><summary type="html"><![CDATA[Securing RabbitMQ with SSL/TLS and enabling HTTPS access for the Management UI is essential to protect data and ensure a secure environment. This guide walks you through the steps to set up RabbitMQ with SSL/TLS on Docker Desktop and enable HTTPS for the Management UI. Follow along to configure RabbitMQ to handle encrypted AMQP connections as well as a secure Management interface.]]></summary></entry><entry><title type="html">Step-by-Step Guide: Deploying an ASP.NET Core Application with Azure Kubernetes Services, Azure SQL Server, and Azure Container Registry</title><link href="https://mahedee.net//step-by-step-guide-deploying-aspnet-core-application-with-aks-acr-sql/" rel="alternate" type="text/html" title="Step-by-Step Guide: Deploying an ASP.NET Core Application with Azure Kubernetes Services, Azure SQL Server, and Azure Container Registry" /><published>2024-07-07T00:00:00-04:00</published><updated>2024-07-07T00:00:00-04:00</updated><id>https://mahedee.net//step-by-step-guide-deploying-aspnet-core-application-with-aks-acr-sql</id><content type="html" xml:base="https://mahedee.net//step-by-step-guide-deploying-aspnet-core-application-with-aks-acr-sql/"><![CDATA[<p><strong>What is Azure Kubernetes Services (AKS)?</strong> 
Azure Kubernetes Services (AKS) is a managed Kubernetes service provided by Microsoft Azure. It offers a simplified way to deploy, manage, and scale containerized applications using Kubernetes. AKS is a fully managed service that eliminates the complexity of managing Kubernetes clusters, allowing you to focus on building and deploying your applications.</p>

<p><strong>What is Azure SQL Server?</strong>
Azure SQL Server is a managed relational database service provided by Microsoft Azure. It offers a scalable, secure, and fully managed database service that is compatible with SQL Server. Azure SQL Server provides high availability, automatic backups, and built-in security features to protect your data.</p>

<p><strong>What is Azure Container Registry (ACR)?</strong>
Azure Container Registry (ACR) is a managed container registry provided by Microsoft Azure. It allows you to store and manage container images securely in the cloud. ACR integrates with Azure services like Azure Kubernetes Services (AKS) to simplify the deployment of containerized applications.</p>

<p>In this article, you’ll learn how to deploy an ASP.NET Core application using Azure Kubernetes Services (AKS), Azure SQL Server, and Azure Container Registry (ACR). The steps below assume you have some basic familiarity with ASP.NET Core, Azure services, and Docker.</p>

<p><strong>Prerequisites</strong>
Before you begin, ensure you have the following:</p>
<ul>
  <li>An Azure subscription (create a free account if you don’t have one)</li>
  <li>Azure CLI installed on your local machine</li>
  <li>Docker Desktop installed on your local machine</li>
  <li>Visual Studio or any other code editor</li>
  <li>Basic knowledge of ASP.NET Core, Docker, and Kubernetes</li>
  <li>Kubectl installed on your local machine</li>
</ul>

<p><strong>Step 1: Create an Azure SQL Database</strong></p>
<ul>
  <li>Open the Azure portal and sign in with your Azure account.</li>
  <li>Click on the “Create a resource” button and search for “SQL Database”.</li>
  <li>Click on the “Create” button to create a new SQL Database.</li>
  <li>Fill in the required details like server name, database name, resource group, and pricing tier.</li>
  <li>Click on the “Review + create” button to create the SQL Database.</li>
</ul>

<p>or</p>
<ul>
  <li>Login to Azure CLI</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az login
</code></pre></div></div>

<ul>
  <li>Create a resource group for the SQL Server and Database</li>
  <li>Create a SQL Server and Database using Azure CLI</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create a resource group</span>
az group create <span class="nt">--name</span> &lt;ResourceGroupName&gt; <span class="nt">--location</span> &lt;Location&gt;

<span class="c"># Create a SQL Server</span>
az sql server create <span class="nt">--name</span> &lt;SqlServerName&gt; <span class="nt">--resource-group</span> &lt;ResourceGroupName&gt; <span class="nt">--location</span> &lt;Location&gt; <span class="nt">--admin-user</span> &lt;AdminUser&gt; <span class="nt">--admin-password</span> &lt;AdminPassword&gt;

<span class="c"># Create a SQL Database with the S0 pricing tier</span>
az sql db create <span class="nt">--resource-group</span> &lt;ResourceGroupName&gt; <span class="nt">--server</span> &lt;SqlServerName&gt; <span class="nt">--name</span> &lt;DatabaseName&gt; <span class="nt">--service-objective</span> S0
</code></pre></div></div>

<p>Example of creating a SQL Server and Database using Azure CLI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create a resource group named myresourcegroup in the westus location</span>
az group create <span class="nt">--name</span> myresourcegroup <span class="nt">--location</span> westus

<span class="c"># Create a SQL Server named myserver in the myresourcegroup resource group with the admin user mahedee and password mypass@123</span>
az sql server create <span class="nt">--name</span> mahedeesqlserver <span class="nt">--resource-group</span> myresourcegroup <span class="nt">--location</span> westus <span class="nt">--admin-user</span> mahedee <span class="nt">--admin-password</span> mypass@123

<span class="c"># Create a SQL Database named mydatabase in the myresourcegroup resource group with the S0 pricing tier</span>
az sql db create <span class="nt">--resource-group</span> myresourcegroup <span class="nt">--server</span> mahedeesqlserver <span class="nt">--name</span> HRMDB <span class="nt">--service-objective</span> S0
</code></pre></div></div>

<ul>
  <li>Set Up Firewall Rules Allow your local machine or AKS to access the SQL server.</li>
  <li>Try to connect to the SQL Server using SQL Server Management Studio (SSMS) or Azure Data Studio to verify the connection.</li>
  <li>You will get a message that the IP address is not allowed to access the server.</li>
  <li>It will show the IP address range that is need to be added to the firewall rules.</li>
  <li>Collect start and end IP address range from the error message and add the IP address range to the firewall rules using the Azure CLI.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Allow your local machine to access the SQL server</span>
az sql server firewall-rule create <span class="nt">--resource-group</span> myresourcegroup <span class="nt">--server</span> mahedeesqlserver <span class="nt">--name</span> AllowLocalMachine <span class="nt">--start-ip-address</span> &lt;YourIPAddress&gt; <span class="nt">--end-ip-address</span> &lt;YourIPAddress&gt;
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Example: Allow your local machine to access the SQL server</span>
az sql server firewall-rule create <span class="nt">--resource-group</span> myresourcegroup <span class="nt">--server</span> mahedeesqlserver <span class="nt">--name</span> AllowLocalMachine <span class="nt">--start-ip-address</span> 162.237.182.0 <span class="nt">--end-ip-address</span> 162.237.182.255
</code></pre></div></div>

<p><strong>Step 2: Create an ASP.NET Core Application</strong></p>

<ul>
  <li>Create a new ASP.NET Core application using Visual Studio or the .NET CLI.</li>
  <li>Install the required NuGet packages for Azure SQL Database and Entity Framework Core.</li>
  <li>Configure the connection string to your Azure SQL Database.</li>
  <li>Create the required models and DbContext for your application.</li>
  <li>Add the required services and middleware to your application.</li>
  <li>Build and run your ASP.NET Core application locally to test it.</li>
</ul>

<p>In this Article I have created an asp.net core web api application name HRM.API. Source of the application is given at the end of the article.</p>

<ul>
  <li>
    <p>Now create a Dockerfile in the root of your project to containerize your ASP.NET Core application.</p>
  </li>
  <li>
    <p>I have added lot of comments in the Dockerfile to explain each step.</p>
  </li>
</ul>

<p><strong>Dockerfile</strong></p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Define the base image</span>
<span class="c"># Use the official ASP.NET Core runtime image the alias base sets here to use it in the next stage</span>

<span class="c"># Switches the execution to a user named app. This is a security best practice to avoid running as root.</span>
<span class="c"># The app user must exist in the aspnet:8.0 image. If not, this command will fail unless the user is created beforehand.</span>

<span class="c"># Sets the working directory to /app. All subsequent commands in this stage will be relative to this directory.</span>

<span class="c"># Informs Docker that the container will listen on ports 8080 and 8081. </span>
<span class="c"># This is for documentation purposes and does not expose the ports to the host by itself; you need to publish these ports explicitly with docker run -p.</span>

<span class="k">FROM</span><span class="w"> </span><span class="s">mcr.microsoft.com/dotnet/aspnet:8.0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">base</span>
<span class="k">USER</span><span class="s"> app</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">EXPOSE</span><span class="s"> 8080</span>
<span class="k">EXPOSE</span><span class="s"> 8081</span>


<span class="c"># Define the Build Stage</span>
<span class="c"># Use the official ASP.NET Core SDK image to build the application</span>
<span class="c"># Set the working directory to /src. This directory will be existing only in the build stage.</span>
<span class="c"># Copies all files from the current directory on the host machine to the /src directory in the container.</span>
<span class="c"># Restores project dependencies from the .csproj file. This ensures all necessary NuGet packages are downloaded.</span>
<span class="c"># Builds the application in Release configuration and outputs the compiled files to the /app directory inside the container.</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">mcr.microsoft.com/dotnet/sdk:8.0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build</span>
<span class="k">WORKDIR</span><span class="s"> /src</span>
<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">RUN </span>dotnet restore
<span class="k">RUN </span>dotnet publish <span class="nt">-c</span> Release <span class="nt">-o</span> /app

<span class="c"># Final State</span>
<span class="c"># Use the base image defined in the first stage.</span>
<span class="c"># Set the working directory to /app.</span>
<span class="c"># Copies the compiled application from the build stage to the /app directory in the final image.</span>
<span class="c"># Defines the command to run when the container starts. Here, it launches the application by executing the .NET runtime to run the HRM.API.dll file.</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">final</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> --from=build /app .</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["dotnet", "HRM.API.dll"]</span>

<span class="c"># You can see only the app directory in the final image because Multi-stage builds isolate the content of each stage from the other stages.</span>
<span class="c"># Docker multi-stage build process implicitly discards everything in the intermediate stages when the final stage is built.</span>
</code></pre></div></div>

<ul>
  <li>Build and Test the Docker Image Locally</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Build the Docker image using the Dockerfile</span>
docker build <span class="nt">-t</span> hrm:latest <span class="nb">.</span>

<span class="c"># Run the Docker image locally</span>
docker run <span class="nt">-p</span> 8080:8080 hrm:latest
</code></pre></div></div>

<p>Access your application at http://localhost:8080/swagger/index.html to verify it works.</p>

<p><strong>Step 3: Create an Azure Container Registry (ACR)</strong></p>
<ul>
  <li>Open the Azure portal and sign in with your Azure account.</li>
  <li>Click on “Create a resource” and search for “Container Registry”.</li>
  <li>Select “Container Registry” and click on “Create”.</li>
  <li>Fill in the required details like registry name, resource group, location, and SKU.</li>
  <li>Click on “Review + create” and then “Create” to create the ACR.</li>
</ul>

<p>or</p>
<ul>
  <li>Create an Azure Container Registry using Azure CLI</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create a resource group for the ACR</span>
<span class="c"># Since we already have a resource group, we can skip this step</span>
az group create <span class="nt">--name</span> &lt;ResourceGroupName&gt; <span class="nt">--location</span> &lt;Location&gt;

<span class="c"># Create an ACR</span>
az acr create <span class="nt">--name</span> &lt;ACRName&gt; <span class="nt">--resource-group</span> &lt;ResourceGroupName&gt; <span class="nt">--sku</span> Basic <span class="nt">--location</span> &lt;Location&gt;
</code></pre></div></div>

<p>Example of creating an Azure Container Registry using Azure CLI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create a resource group named myresourcegroup in the westus location</span>
<span class="c"># Since we already have a resource group, we can skip this step</span>
az group create <span class="nt">--name</span> myresourcegroup <span class="nt">--location</span> westus

<span class="c"># Create an ACR named myacr in the myresourcegroup resource group with the Basic SKU</span>
az acr create <span class="nt">--name</span> mh17acr <span class="nt">--resource-group</span> myresourcegroup <span class="nt">--sku</span> Basic <span class="nt">--location</span> westus
</code></pre></div></div>

<p><strong>Step 4: Push the Docker Image to Azure Container Registry (ACR)</strong></p>
<ul>
  <li>Tag the Docker image with the ACR URL. Tagging the image with the ACR URL is required to push the image to the ACR.</li>
  <li>Log in to the ACR using the Azure CLI.</li>
  <li>Push the Docker image to the ACR.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Tag the Docker image with the ACR URL</span>
docker tag hrm:latest &lt;ACRName&gt;.azurecr.io/hrm:latest
<span class="c"># Login to the ACR using the Azure CLI</span>
az acr login <span class="nt">--name</span> &lt;ACRName&gt;
<span class="c"># Push the Docker image to the ACR</span>
docker push &lt;ACRName&gt;.azurecr.io/hrm:latest
</code></pre></div></div>
<p>Example of pushing a Docker image to Azure Container Registry using Azure CLI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Tag the Docker image with the ACR URL</span>
docker tag hrm:latest mh17acr.azurecr.io/hrm:latest
<span class="c"># Login to the ACR using the Azure CLI</span>
az acr login <span class="nt">--name</span> mh17acr
<span class="c"># Push the Docker image to the ACR</span>
docker push mh17acr.azurecr.io/hrm:latest
</code></pre></div></div>
<ul>
  <li>Verify that the Docker image is successfully pushed to the ACR by checking the ACR in the Azure portal. or using Azure CLI</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># List the repositories in the ACR</span>
az acr repository list <span class="nt">--name</span> &lt;ACRName&gt; <span class="nt">--output</span> table
</code></pre></div></div>
<p>Example of listing the repositories in the ACR using Azure CLI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># List the repositories in the ACR</span>
  az acr repository list <span class="nt">--name</span> mh17acr <span class="nt">--output</span> table
</code></pre></div></div>

<p><strong>Step 5: Create an Azure Kubernetes Services (AKS) Cluster</strong></p>
<ul>
  <li>Open the Azure portal and sign in with your Azure account.</li>
  <li>Click on the “Create a resource” button and search for “Kubernetes Service”.</li>
  <li>Click on “Create” to create a new AKS cluster.</li>
  <li>Fill in the required information, such as the resource group, location, and cluster name.</li>
  <li>Basics Tab:
    <ul>
      <li>Subscription: Choose your Azure subscription.</li>
      <li>Resource Group: Create a new resource group or select an existing one.</li>
      <li>Kubernetes Cluster Name: Enter a unique name for your AKS cluster.</li>
      <li>Region: Select the region for your cluster.</li>
      <li>Click “Next: Node Pools” to proceed.</li>
    </ul>
  </li>
  <li>Node Pools Tab:
    <ul>
      <li>Click “Add a node pool” to add a new node pool.</li>
      <li>Node Pool Name: Enter a name for the node pool.</li>
      <li>Virtual Machine Size: Choose the VM size for the node pool.</li>
      <li>Node Count: Enter the number of nodes in the pool.</li>
      <li>Click “Next: Authentication” to proceed.</li>
    </ul>
  </li>
  <li>Authentication Tab:
    <ul>
      <li>Leave the default settings for authentication.</li>
      <li>Click “Next: Networking” to proceed.</li>
    </ul>
  </li>
  <li>Networking Tab:
    <ul>
      <li>Leave the default settings for networking.</li>
      <li>Click “Next: Monitoring” to proceed.</li>
    </ul>
  </li>
  <li>Monitoring Tab:
    <ul>
      <li>Enable monitoring if required.</li>
      <li>Click “Next: Tags” to proceed.</li>
    </ul>
  </li>
  <li>Tags Tab:
    <ul>
      <li>Add any required tags to the cluster.</li>
      <li>Click “Next: Review + create” to proceed.</li>
    </ul>
  </li>
  <li>Review + create Tab:
    <ul>
      <li>Review the cluster configuration.</li>
      <li>Click “Create” to create the AKS cluster.</li>
    </ul>
  </li>
  <li>Click on “Review + create” and then “Create” to create the AKS cluster.</li>
  <li>Once the cluster is created, click on the “Connect” button to connect to the cluster using kubectl.</li>
</ul>

<p>or</p>
<ul>
  <li>Create an AKS cluster using Azure CLI</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create a resource group for the AKS cluster</span>
az group create <span class="nt">--name</span> &lt;ResourceGroupName&gt; <span class="nt">--location</span> &lt;Location&gt;
<span class="c"># Create an AKS cluster</span>
az aks create <span class="nt">--resource-group</span> &lt;ResourceGroupName&gt; <span class="nt">--name</span> &lt;AKSName&gt; <span class="nt">--node-count</span> &lt;NumberOfNodes&gt; <span class="nt">--enable-addons</span> monitoring <span class="nt">--generate-ssh-keys</span>
</code></pre></div></div>
<p>Example of creating an AKS cluster using Azure CLI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create a resource group for the AKS cluster</span>
<span class="c"># Since we already have a resource group, we can skip this step</span>
az group create <span class="nt">--name</span> myresourcegroup <span class="nt">--location</span> westus

<span class="c"># Create an AKS cluster</span>
az aks create <span class="nt">--resource-group</span> myresourcegroup <span class="nt">--name</span> myakscluster <span class="nt">--node-count</span> 1 <span class="nt">--enable-addons</span> monitoring <span class="nt">--generate-ssh-keys</span> <span class="nt">--location</span> westus <span class="nt">--kubernetes-version</span> 1.29.9 <span class="nt">--node-vm-size</span> Standard_B2s <span class="nt">--enable-cluster-autoscaler</span> <span class="nt">--min-count</span> 1 <span class="nt">--max-count</span> 3
</code></pre></div></div>
<p>Note: Sometimes, CLI commands may not work due to the version of the CLI. In that case, you can use the Azure portal to create the AKS cluster.</p>

<ul>
  <li>Now Connect to the AKS cluster. Use the following command to connect to the AKS cluster:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az aks get-credentials <span class="nt">--resource-group</span> &lt;ResourceGroupName&gt; <span class="nt">--name</span> &lt;AKSName&gt;
</code></pre></div></div>

<p>Example of connecting to an AKS cluster using Azure CLI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Connect to the AKS cluster</span>
az aks get-credentials <span class="nt">--resource-group</span> myresourcegroup <span class="nt">--name</span> myakscluster

<span class="c"># Output</span>
Merged <span class="s2">"myakscluster"</span> as current context <span class="k">in</span> /Users/username/.kube/config
</code></pre></div></div>

<ul>
  <li>To get the list of contexts, run the following command:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl config get-contexts
</code></pre></div></div>
<ul>
  <li>To switch to a different context, run the following command:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl config use-context &lt;ContextName&gt;
</code></pre></div></div>

<p><strong>Step 6: Link ACR(Azure Container Registry) to AKS</strong>
If the Azure Kubernetes Service (AKS) cluster is not linked to your ACR, Kubernetes cannot pull the image.</p>

<p>Run the following command to allow AKS to access your ACR:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az aks update <span class="nt">-n</span> &lt;aks-cluster-name&gt; <span class="nt">-g</span> &lt;resource-group-name&gt; <span class="nt">--attach-acr</span> mh17acr
</code></pre></div></div>

<p>Example of linking an ACR to an AKS cluster using Azure CLI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Link the ACR to the AKS cluster</span>
az aks update <span class="nt">-n</span> myakscluster <span class="nt">-g</span> myresourcegroup <span class="nt">--attach-acr</span> mh17acr 
</code></pre></div></div>

<p><strong>Step 7: Deploy the ASP.NET Core Application to AKS</strong></p>

<ul>
  <li>Connect to the AKS cluster</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az aks get-credentials <span class="nt">--resource-group</span> &lt;ResourceGroupName&gt; <span class="nt">--name</span> &lt;AKSName&gt;
</code></pre></div></div>

<p>Example of connecting to an AKS cluster using Azure CLI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Connect to the AKS cluster</span>
az aks get-credentials <span class="nt">--resource-group</span> myresourcegroup <span class="nt">--name</span> myakscluster

<span class="c"># Output</span>
Merged <span class="s2">"myakscluster"</span> as current context <span class="k">in</span> /Users/username/.kube/config
</code></pre></div></div>

<ul>
  <li>To get the list of contexts, run the following command:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl config get-contexts
</code></pre></div></div>
<ul>
  <li>To switch to a different context, run the following command:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl config use-context &lt;ContextName&gt;
</code></pre></div></div>

<ul>
  <li>Create a Kubernetes Pod for the ASP.NET Core application</li>
  <li>
    <p>Here I used lots of comments to explain each section of the yaml file. You can remove the comments before using it.</p>

    <p><strong>pod_aks.yml</strong></p>
  </li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span> <span class="c1"># Pod is the smallest deployable unit in Kubernetes and it represents a single instance of a running process in your cluster.</span>
<span class="na">metadata</span><span class="pi">:</span> <span class="c1"># Metadata section provides information about the Pod</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-pod</span> <span class="c1"># Name of the Pod. Name must be unique within the namespace.</span>
  <span class="na">labels</span><span class="pi">:</span>       <span class="c1"># Labels are key/value pairs that are attached to objects, such as pods. Labels are intended to be used to specify identifying attributes of objects that are meaningful and relevant to users.</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">hrm-api</span>

<span class="c1"># Specification for the Pod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span> <span class="c1"># List of containers within the Pod</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-ctr</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">mh17acr.azurecr.io/hrm:latest</span> 
      <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span> <span class="c1"># Port that the container will expose</span>
      <span class="na">env</span><span class="pi">:</span> <span class="c1"># List of environment variables to set in the container</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ConnectionStrings__DefaultConnection</span> <span class="c1"># Name of the environment variable. Here __ is used to represent the hierarchy of the connection string. It means ConnectionStrings:DefaultConnection</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Server=mahedeesqlserver.database.windows.net;Database=HRMDB;User</span><span class="nv"> </span><span class="s">Id=mahedee;Password=mypass@123;MultipleActiveResultSets=true"</span>
  
</code></pre></div></div>

<ul>
  <li>Create a Kubernetes Service for the ASP.NET Core application</li>
  <li>
    <p>Here I used lots of comments to explain each section of the yaml file. You can remove the comments before using it.</p>

    <p><strong>service_aks.yml</strong></p>
  </li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">hrm-api</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="c1"># First port configuration</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">8011</span> <span class="c1"># Port that the service will expose</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span> <span class="c1"># Protocol that the service will use</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span> <span class="c1"># Port on the container where traffic will be directed</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">http</span> <span class="c1"># Name of the port (useful for service discovery)</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30376</span> <span class="c1"># Specific port on the cluster nodes to expose (used with NodePort/LoadBalancer services)</span>
    <span class="c1"># Second port configuration</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">8081</span> <span class="c1"># Port that the service will expose</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span> <span class="c1"># Protocol that the service will use</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8081</span> <span class="c1"># Port on the container where traffic will be directed</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">https</span> <span class="c1"># Name of the port (useful for service discovery)</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30676</span> <span class="c1"># Specific port on the cluster nodes to expose (used with NodePort/LoadBalancer services)</span>
  <span class="c1"># Selector matches Pods with the label "app: hrm-api"</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">hrm-api</span>
<span class="na">status</span><span class="pi">:</span>
  <span class="na">loadBalancer</span><span class="pi">:</span> <span class="pi">{}</span> <span class="c1"># Placeholder for LoadBalancer details (IP or DNS name) once provisioned</span>

<span class="c1"># Use spaces (2 or 4 spaces) for indentation in YAML files; tabs are not allowed.</span>
<span class="c1"># The YAML specification prohibits the use of tabs, and using spaces ensures consistency and proper parsing.</span>
  
</code></pre></div></div>

<ul>
  <li>
    <p>Deploy the ASP.NET Core application to the AKS cluster</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> pod_aks.yml
kubectl apply <span class="nt">-f</span> service_aks.yml
</code></pre></div>    </div>
  </li>
  <li>
    <p>Verify that the ASP.NET Core application is deployed to the AKS cluster by checking the pods and services in the Kubernetes dashboard or using the following commands:</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  kubectl get pods

  Output:

  NAME      READY   STATUS    RESTARTS   AGE
  hrm-pod   1/1     Running   0          16s
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  kubectl get svc

  Output:
  NAME          TYPE           CLUSTER-IP   EXTERNAL-IP      PORT<span class="o">(</span>S<span class="o">)</span>                         AGE
  hrm-service   LoadBalancer   10.0.80.25   52.137.187.193   8011:30376/TCP,8081:30676/TCP   24s
  kubernetes    ClusterIP      10.0.0.1     &lt;none&gt;           443/TCP                         21m
</code></pre></div></div>

<ul>
  <li>Access the ASP.NET Core application using the external IP address of the service.</li>
  <li>In this access the application using the following URL:</li>
</ul>

<p>http://52.137.187.193:8011/swagger/index.html</p>

<ul>
  <li>To delete the pod and service, use the following commands:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete <span class="nt">-f</span> pod_aks.yml
kubectl delete <span class="nt">-f</span> service_aks.yml
</code></pre></div></div>

<ul>
  <li>Command to get log of a pod
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl logs <span class="nt">-f</span> hrm-pod
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Trouble Shooting: Application cannot connect to the Azure SQL Database</strong></p>
<ul>
  <li>Run the following command to check the logs of the pod to identify any connection issues:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl logs <span class="nt">-f</span> hrm-pod
</code></pre></div>    </div>
  </li>
  <li>You will get the error message in the logs if there is any issue connecting to the Azure SQL Database.</li>
  <li>It says AKS pod cannot connect to the Azure SQL Database. It will show source IP address is not allowed to access the server.</li>
  <li>To resolve this issue, you need to allow the AKS cluster’s IP address to access the Azure SQL Database.</li>
  <li>Run the following command to set up the firewall rule to allow the AKS cluster’s IP address to access the Azure SQL Database:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az sql server firewall-rule create <span class="nt">--resource-group</span> &lt;ResourceGroupName&gt; <span class="nt">--server</span> &lt;SqlServerName&gt; <span class="nt">--name</span> AllowAKSIP <span class="nt">--start-ip-address</span> 13.64.73.58 <span class="nt">--end-ip-address</span> 13.64.73.58
</code></pre></div>    </div>
    <p>Example:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az sql server firewall-rule create <span class="nt">--resource-group</span> &lt;ResourceGroupName&gt; <span class="nt">--server</span> &lt;SqlServerName&gt; <span class="nt">--name</span> AllowAKSIP <span class="nt">--start-ip-address</span> 13.64.73.58 <span class="nt">--end-ip-address</span> 13.64.73.58
</code></pre></div>    </div>
  </li>
  <li>After setting up the firewall rule, try to access the Azure SQL Database from the AKS pod again. The connection should be successful now.</li>
  <li>Kubernetes pods ip address can be changed after restart. So, it is better to use static ip address for the AKS cluster.</li>
</ul>

<p><strong>Common Commands:</strong></p>

<ul>
  <li>To update azur CLI run the following command:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az upgrade
</code></pre></div></div>

<ul>
  <li>To know the region of the AKS cluster, run the following command:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az aks show <span class="nt">-n</span> &lt;aks-cluster-name&gt; <span class="nt">-g</span> &lt;resource-group-name&gt; <span class="nt">--query</span> location <span class="nt">-o</span> tsv
</code></pre></div>    </div>
  </li>
  <li>To know the region of the Azure SQL Database, run the following command:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az sql server show <span class="nt">-n</span> &lt;sql-server-name&gt; <span class="nt">-g</span> &lt;resource-group-name&gt; <span class="nt">--query</span> location <span class="nt">-o</span> tsv
</code></pre></div>    </div>
  </li>
  <li>To know the ip address of the AKS cluster, run the following command:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az aks show <span class="nt">-n</span> &lt;aks-cluster-name&gt; <span class="nt">-g</span> &lt;resource-group-name&gt; <span class="nt">--query</span> outboundIpAddresses <span class="nt">-o</span> tsv
</code></pre></div>    </div>
  </li>
  <li>To get list of contexts, run the following command:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl config get-contexts
</code></pre></div>    </div>
  </li>
  <li>To switch to a different context, run the following command:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl config use-context &lt;context-name&gt;
</code></pre></div>    </div>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods <span class="nt">--watch</span>  <span class="c"># Watch the pods in the current namespace</span>
</code></pre></div></div>

<ul>
  <li>To get the logs of a pod, run the following command:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl logs <span class="nt">-f</span> &lt;pod-name&gt;
</code></pre></div>    </div>
  </li>
  <li>To get the logs of a pod in a specific container, run the following command:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl logs <span class="nt">-f</span> &lt;pod-name&gt; <span class="nt">-c</span> &lt;container-name&gt;
</code></pre></div>    </div>
  </li>
  <li>Describe a pod
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl describe pod &lt;pod-name&gt;
</code></pre></div>    </div>
  </li>
  <li>To get the details of a pod, run the following command:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pod &lt;pod-name&gt; <span class="nt">-o</span> yaml
</code></pre></div>    </div>
  </li>
</ul>

<p><strong><a href="https://github.com/mahedee/code-sample02/tree/master/aks-hrm">Source code</a></strong></p>]]></content><author><name>Mahedee Hasan</name></author><category term="ASP.NET Core" /><category term="Kubernetes" /><category term="SQL Server" /><category term="Docker" /><category term="Azure" /><category term="DevOps" /><category term="Microservices" /><category term="aspnetcore" /><category term="kubernetes" /><category term="sqlserver" /><category term="docker" /><category term="azure" /><category term="devops" /><category term="microservices" /><summary type="html"><![CDATA[Securing RabbitMQ with SSL/TLS and enabling HTTPS access for the Management UI is essential to protect data and ensure a secure environment. This guide walks you through the steps to set up RabbitMQ with SSL/TLS on Docker Desktop and enable HTTPS for the Management UI. Follow along to configure RabbitMQ to handle encrypted AMQP connections as well as a secure Management interface.]]></summary></entry><entry><title type="html">Understanding Different Kinds of Kubernetes Resources</title><link href="https://mahedee.net//understanding-different-kinds-of-kubernetes-resources/" rel="alternate" type="text/html" title="Understanding Different Kinds of Kubernetes Resources" /><published>2024-06-08T00:00:00-04:00</published><updated>2024-06-08T00:00:00-04:00</updated><id>https://mahedee.net//understanding-different-kinds-of-kubernetes-resources</id><content type="html" xml:base="https://mahedee.net//understanding-different-kinds-of-kubernetes-resources/"><![CDATA[<p>Kubernetes, a leading container orchestration platform, is designed to simplify the deployment, scaling, and management of applications. Central to Kubernetes are its <strong>resources</strong>, each tailored for specific tasks like running applications, managing storage, or ensuring smooth communication between components. Understanding these resources is crucial for leveraging Kubernetes to its full potential.</p>

<p>Here’s a comprehensive guide to the most commonly used Kubernetes resources, their purposes, and use cases.</p>

<p><strong>1. Pod</strong>
The <strong>Pod</strong> is the smallest and most basic deployable unit in Kubernetes. A Pod encapsulates one or more tightly coupled containers that share the same network namespace and storage.</p>

<p><strong>Purpose</strong>:</p>
<ul>
  <li>To host application containers, often one per Pod.</li>
  <li>Acts as the building block for higher-level abstractions like Deployments.</li>
</ul>

<p><strong>Use Case</strong>:</p>
<ul>
  <li>Deploying simple applications or debugging purposes.</li>
</ul>

<p><strong>Example</strong>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-pod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-container</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">mh17acr.azurecr.io/hrm:latest</span>
      <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
</code></pre></div></div>

<p><strong>2. Deployment</strong>
A <strong>Deployment</strong> is a higher-level abstraction that manages a group of Pods. It handles updates, scaling, and fault tolerance for stateless applications.</p>

<p><strong>Purpose</strong>:</p>
<ul>
  <li>To ensure a specific number of replicas are running.</li>
  <li>Supports rolling updates and rollbacks.</li>
</ul>

<p><strong>Use Case</strong>:</p>
<ul>
  <li>Deploying scalable, stateless applications.</li>
</ul>

<p><strong>Example</strong>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-deployment</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">hrm-api</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">hrm-api</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-container</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">mh17acr.azurecr.io/hrm:latest</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
</code></pre></div></div>

<p><strong>3. Service</strong>
A <strong>Service</strong> provides a stable network endpoint for accessing a group of Pods. It abstracts the dynamic nature of Pods and exposes them through a fixed IP or DNS.</p>

<p><strong>Purpose</strong>:</p>
<ul>
  <li>To route traffic to Pods, regardless of their lifecycle.</li>
  <li>Supports load balancing.</li>
</ul>

<p><strong>Use Case</strong>:</p>
<ul>
  <li>Connecting frontend applications to backend APIs.</li>
</ul>

<p><strong>Example</strong>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">hrm-api</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">ClusterIP</span>
</code></pre></div></div>

<p><strong>4. ConfigMap</strong>
A <strong>ConfigMap</strong> is used to store non-sensitive configuration data as key-value pairs. This allows configuration changes without rebuilding container images.</p>

<p><strong>Purpose</strong>:</p>
<ul>
  <li>To decouple configuration from application logic.</li>
</ul>

<p><strong>Use Case</strong>:</p>
<ul>
  <li>Managing application settings like environment variables.</li>
</ul>

<p><strong>Example</strong>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-config</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>
  <span class="na">log_level</span><span class="pi">:</span> <span class="s">debug</span>
</code></pre></div></div>

<p><strong>5. Secret</strong>
A <strong>Secret</strong> securely stores sensitive information, such as passwords, tokens, and keys. Unlike ConfigMaps, Secrets encode data in Base64 for security.</p>

<p><strong>Purpose</strong>:</p>
<ul>
  <li>To securely manage sensitive data.</li>
</ul>

<p><strong>Use Case</strong>:</p>
<ul>
  <li>Storing database credentials or API keys.</li>
</ul>

<p><strong>Example</strong>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-secret</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">bXlwYXNzd29yZA==</span> <span class="c1"># Base64 encoded "mypassword"</span>
</code></pre></div></div>

<p><strong>6. StatefulSet</strong>
A <strong>StatefulSet</strong> manages stateful applications, ensuring each Pod has a unique, stable identity and persistent storage.</p>

<p><strong>Purpose</strong>:</p>
<ul>
  <li>To deploy applications that require stable Pod identities and ordered deployment.</li>
</ul>

<p><strong>Use Case</strong>:</p>
<ul>
  <li>Databases, distributed systems, or applications requiring persistent storage.</li>
</ul>

<p><strong>Example</strong>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">StatefulSet</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-db</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">serviceName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">hrm-db-service"</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">hrm-db</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">hrm-db</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mysql-container</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:5.7</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">3306</span>
</code></pre></div></div>

<p><strong>7. Job</strong>
A <strong>Job</strong> runs tasks to completion, such as batch processing or database migrations. It ensures the task is retried upon failure.</p>

<p><strong>Purpose</strong>:</p>
<ul>
  <li>To run one-time or short-lived tasks.</li>
</ul>

<p><strong>Use Case</strong>:</p>
<ul>
  <li>Running a data import job or executing scripts.</li>
</ul>

<p><strong>Example</strong>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">batch/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Job</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-job</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-task</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">busybox</span>
          <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">sh"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-c"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">echo</span><span class="nv"> </span><span class="s">'Hello,</span><span class="nv"> </span><span class="s">Kubernetes!'"</span><span class="pi">]</span>
      <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">Never</span>
  <span class="na">backoffLimit</span><span class="pi">:</span> <span class="m">4</span>
</code></pre></div></div>

<p><strong>8. CronJob</strong>
A <strong>CronJob</strong> schedules Jobs at specific times, like a cron job in Linux.</p>

<p><strong>Purpose</strong>:</p>
<ul>
  <li>To run periodic tasks automatically.</li>
</ul>

<p><strong>Use Case</strong>:</p>
<ul>
  <li>Running backups, generating reports, or performing maintenance tasks.</li>
</ul>

<p><strong>Example</strong>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">batch/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CronJob</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-cronjob</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">schedule</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0</span><span class="nv"> </span><span class="s">3</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*"</span> <span class="c1"># Run daily at 3 AM</span>
  <span class="na">jobTemplate</span><span class="pi">:</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">template</span><span class="pi">:</span>
        <span class="na">spec</span><span class="pi">:</span>
          <span class="na">containers</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-task</span>
              <span class="na">image</span><span class="pi">:</span> <span class="s">busybox</span>
              <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">sh"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-c"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">echo</span><span class="nv"> </span><span class="s">'Scheduled</span><span class="nv"> </span><span class="s">Task'"</span><span class="pi">]</span>
          <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">OnFailure</span>
</code></pre></div></div>

<p><strong>9. PersistentVolume (PV) and PersistentVolumeClaim (PVC)</strong>
A <strong>PersistentVolume (PV)</strong> represents physical storage in the cluster, while a <strong>PersistentVolumeClaim (PVC)</strong> requests specific storage resources from a PV.</p>

<p><strong>Purpose</strong>:</p>
<ul>
  <li>To manage persistent storage for stateful applications.</li>
</ul>

<p><strong>Use Case</strong>:</p>
<ul>
  <li>Storing database data or application logs.</li>
</ul>

<p><strong>Example</strong>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># PersistentVolume</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolume</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-pv</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">capacity</span><span class="pi">:</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="s">5Gi</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">hostPath</span><span class="pi">:</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s">/data/hrm</span>

<span class="c1"># PersistentVolumeClaim</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">hrm-pvc</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">5Gi</span>
</code></pre></div></div>

<p><strong>Conclusion</strong>
Kubernetes resources provide powerful abstractions to deploy, manage, and scale applications in a cloud-native way. By understanding these resource types and their purposes, you can design robust, scalable, and secure architectures tailored to your application’s needs. Whether you’re deploying a stateless microservice or managing a complex stateful database, Kubernetes has the tools to make it easier.</p>]]></content><author><name>Mahedee Hasan</name></author><category term="Kubernetes" /><category term="Docker" /><category term="Microservices" /><category term="DevOps" /><category term="Azure" /><category term="kubernetes" /><category term="docker" /><category term="azure" /><category term="devops" /><category term="microservices" /><summary type="html"><![CDATA[Learn about the different types of Kubernetes resources, their purposes, and how they help manage and scale applications in a containerized environment. Perfect for beginners and experts alike!]]></summary></entry><entry><title type="html">Step-by-Step Guide to Running Jekyll Minimal Mistake Blog on Windows</title><link href="https://mahedee.net//step_by_step_guide_to_running_jekyll_minimal_mistake_blog_on_windows/" rel="alternate" type="text/html" title="Step-by-Step Guide to Running Jekyll Minimal Mistake Blog on Windows" /><published>2024-05-01T00:00:00-04:00</published><updated>2024-05-01T00:00:00-04:00</updated><id>https://mahedee.net//step_by_step_guide_to_running_jekyll_minimal_mistake_blog_on_windows</id><content type="html" xml:base="https://mahedee.net//step_by_step_guide_to_running_jekyll_minimal_mistake_blog_on_windows/"><![CDATA[<p>Jekyll is a fantastic tool for building static websites, and the Minimal Mistakes theme offers a professional, clean design for blogs. This guide will walk you through the steps to build, run, and deploy your Jekyll blog on Windows and host it on GitHub Pages.</p>

<p><strong>Step 1: Install Ruby and Development Kit</strong></p>

<ul>
  <li>Download and install Ruby+Devkit from <a href="https://rubyinstaller.org/">RubyInstaller</a>. During installation, ensure you select the option to add Ruby executables to your PATH.</li>
  <li>
    <p>Configure Ruby and the Development Kit:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ridk <span class="nb">install</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Verify the installation:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ruby <span class="nt">--version</span>
 gem <span class="nt">--version</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Step 2: Install Jekyll and Bundler</strong></p>

<ul>
  <li>
    <p>Install Bundler, the Ruby dependency manager:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> gem <span class="nb">install </span>bundler
</code></pre></div>    </div>
  </li>
  <li>
    <p>Install Jekyll:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> gem <span class="nb">install </span>jekyll
</code></pre></div>    </div>
  </li>
  <li>
    <p>Confirm the installation:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> jekyll <span class="nt">--version</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Step 3: Create Your Blog with Minimal Mistakes Theme</strong></p>

<ul>
  <li>
    <p>Clone the Minimal Mistakes starter repository:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> git clone https://github.com/mmistakes/minimal-mistakes.git my-blog
</code></pre></div>    </div>
  </li>
  <li>
    <p>Navigate to your blog directory:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">cd </span>my-blog
</code></pre></div>    </div>
  </li>
  <li>Install project dependencies:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> bundle <span class="nb">install</span>
</code></pre></div>    </div>
  </li>
  <li>Serve the blog locally to preview it:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> bundle <span class="nb">exec </span>jekyll serve
</code></pre></div>    </div>
  </li>
  <li>Open your browser and visit:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> http://localhost:4000
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Step 4: Customize Your Blog</strong></p>

<ul>
  <li>
    <p><strong>Update Configuration:</strong><br />
 Edit <code class="language-plaintext highlighter-rouge">_config.yml</code> to personalize your blog’s title, description, author, and other settings.</p>
  </li>
  <li>
    <p><strong>Add Posts:</strong><br />
 Add new blog posts in the <code class="language-plaintext highlighter-rouge">_posts</code> folder. Use the format:</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> YYYY-MM-DD-post-title.md
</code></pre></div>    </div>
  </li>
</ul>

<p>*<strong>Customize Pages:</strong><br />
   Create new pages (e.g., <code class="language-plaintext highlighter-rouge">about.md</code>) and link them in <code class="language-plaintext highlighter-rouge">_config.yml</code>.</p>

<p><strong>Step 5: Deploy Your Blog to GitHub Pages</strong></p>

<ol>
  <li>Initialize a Git repository in your project directory:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git init
git add <span class="nb">.</span>
git commit <span class="nt">-m</span> <span class="s2">"Initial commit"</span>
</code></pre></div>    </div>
  </li>
  <li>Create a new repository on GitHub and link it to your local project:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git remote add origin &lt;repository-url&gt;
git branch <span class="nt">-M</span> main
git push <span class="nt">-u</span> origin main
</code></pre></div>    </div>
  </li>
  <li>Enable GitHub Pages:
    <ul>
      <li>Go to your GitHub repository’s <strong>Settings</strong>.</li>
      <li>Under <strong>Pages</strong>, set the branch to <code class="language-plaintext highlighter-rouge">main</code> and the folder to <code class="language-plaintext highlighter-rouge">/ (root)</code>.</li>
      <li>Save your changes.</li>
    </ul>
  </li>
  <li>Your blog will be live at:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://&lt;username&gt;.github.io/&lt;repository-name&gt;/
</code></pre></div>    </div>
  </li>
</ol>

<p><strong>Build and deploy release for production</strong></p>
<ul>
  <li>Go to the root direcotry of the project. Ex. My-blog</li>
  <li>Open terminal and run command <code class="language-plaintext highlighter-rouge">jekyll build site.url</code></li>
  <li>Go to the site directory. Ex. My-blog/site</li>
  <li>Copy the content of the site directory</li>
  <li>Go to the root directory of the repository on GitHub. Ex. mahedee.github.io</li>
  <li>Paste the content to the root directory</li>
  <li>Commit and push the changes to the repository on GitHub both my-blog and mahedee.github.io</li>
  <li>Now browse the site using: https://mahedee.github.io/</li>
</ul>

<p><strong>Troubleshooting</strong></p>
<ul>
  <li>
    <p>Changing the Site URL for Production</p>

    <ul>
      <li>You don’t need to manually change links when switching between development and production. Instead, set the “url” parameter in <code class="language-plaintext highlighter-rouge">_config.yml</code>.</li>
      <li>This approach has two benefits:
        <ul>
          <li>When running <code class="language-plaintext highlighter-rouge">jekyll serve</code>, the <code class="language-plaintext highlighter-rouge">site.url</code> is set to <code class="language-plaintext highlighter-rouge">http://localhost:4000</code>.</li>
          <li>When running <code class="language-plaintext highlighter-rouge">jekyll build</code>, the <code class="language-plaintext highlighter-rouge">site.url</code> is replaced with the domain name specified in <code class="language-plaintext highlighter-rouge">_config.yml</code>.</li>
        </ul>
      </li>
      <li>After building, deploy the contents of the <code class="language-plaintext highlighter-rouge">_site</code> directory to the root of your server where your domain points.</li>
    </ul>
  </li>
</ul>

<p><strong>Conclusion</strong></p>

<p>Deploying a Jekyll blog with the Minimal Mistakes theme on Windows is straightforward. With Ruby, Jekyll, and GitHub Pages, you can easily create, customize, and host a beautiful static website. Follow this guide to get your blog up and running today!</p>]]></content><author><name>Mahedee Hasan</name></author><category term="Blog" /><category term="Configuration" /><category term="Jekyll" /><category term="Windows" /><category term="Ruby" /><category term="jekyll" /><category term="configuration" /><category term="windows" /><category term="ruby" /><category term="blog" /><summary type="html"><![CDATA[Discover how to effortlessly build, run, and deploy a Jekyll blog using the Minimal Mistakes theme on Windows. This step-by-step guide walks you through setting up Ruby, installing dependencies, customizing your site, and deploying it to GitHub Pages]]></summary></entry><entry><title type="html">Step-by-Step Guide: Configuring Ubuntu and PuTTY in Windows Terminal</title><link href="https://mahedee.net//configure_ubuntu_putty_windows_terminal/" rel="alternate" type="text/html" title="Step-by-Step Guide: Configuring Ubuntu and PuTTY in Windows Terminal" /><published>2024-04-10T00:00:00-04:00</published><updated>2024-04-10T00:00:00-04:00</updated><id>https://mahedee.net//configure_ubuntu_putty_windows_terminal</id><content type="html" xml:base="https://mahedee.net//configure_ubuntu_putty_windows_terminal/"><![CDATA[<p>Windows Terminal is a powerful tool that can unify multiple command-line interfaces, including Ubuntu (via WSL) and PuTTY. This guide will help you integrate both into Windows Terminal for an efficient and streamlined workflow.</p>

<p><strong>Step 1. Install Windows Terminal</strong></p>

<p>If you haven’t already, install Windows Terminal from the Microsoft Store:</p>

<ul>
  <li>Open the Microsoft Store.</li>
  <li>Search for Windows Terminal.</li>
  <li>Click Install.</li>
</ul>

<p><strong>Step 2. Add Ubuntu to Windows Terminal</strong></p>

<p><strong>Install WSL</strong>
To use Ubuntu, you must enable and install the Windows Subsystem for Linux (WSL):</p>

<ul>
  <li>
    <p>Open PowerShell as Administrator and run:</p>

    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">wsl</span><span class="w"> </span><span class="nt">--install</span><span class="w">
</span></code></pre></div>    </div>

    <p>This installs the latest version of WSL along with a default Linux distribution, usually Ubuntu.</p>
  </li>
  <li>If Ubuntu is not installed, you can manually install it from the Microsoft Store:
    <ul>
      <li>Open the Microsoft Store.</li>
      <li>Search for <strong>Ubuntu</strong>.</li>
      <li>Install the version you prefer (e.g., Ubuntu 20.04).
 or,</li>
      <li>
        <p>Run the following command in PowerShell:</p>

        <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wsl</span><span class="w"> </span><span class="nt">--install</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="nx">Ubuntu</span><span class="w">
</span></code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>Once installed, launch Ubuntu to set up your username and password.</li>
  <li>
    <p>To set up a user and password, run the following command in Ubuntu:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>adduser &lt;username&gt;
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Check Installed WSL Distributions</strong>
Run the following command in PowerShell to verify Ubuntu is installed:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="n">wsl</span><span class="w"> </span><span class="nt">--list</span><span class="w"> </span><span class="nt">--verbose</span><span class="w">
</span></code></pre></div></div>

<p>You’ll see a list of all installed WSL distributions.</p>

<p><strong>Step 3: Add Ubuntu Profile to Windows Terminal</strong></p>

<p>Ubuntu is usually added automatically. If not, add it manually:</p>

<ul>
  <li>Open <strong>Windows Terminal</strong>.</li>
  <li>Click the <strong>down arrow</strong> in the top menu and select <strong>Settings</strong>.</li>
  <li>Scroll down to <strong>JSON file</strong> or click “Open JSON file” to edit it directly.</li>
  <li>
    <p>Add the following JSON snippet for Ubuntu:</p>

    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{2c4de342-38b7-51cf-b940-2309a097f518}"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ubuntu"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Windows.Terminal.Wsl"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ms-appx:///ProfileIcons/{2c4de342-38b7-51cf-b940-2309a097f518}.png"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Save and close the JSON file.</p>
  </li>
  <li>Or, Click on the dropdown menu and select Settings.</li>
  <li>Click on the Add a new profile button.</li>
  <li>Click on the New empty profile button.</li>
  <li>Add name as Ubuntu and set the commandline as wsl.exe -d Ubuntu.</li>
  <li>Restart Windows Terminal, and Ubuntu will appear in the dropdown menu.</li>
</ul>

<p><strong>Step 4. Add PuTTY to Windows Terminal</strong></p>

<p>PuTTY is a popular SSH client and can also be integrated into Windows Terminal.</p>

<p><strong>Install PuTTY</strong></p>
<ul>
  <li>Download PuTTY from the official <a href="https://www.putty.org/">PuTTY website</a>.</li>
  <li>Install PuTTY on your system.</li>
</ul>

<p><strong>Add a Profile for PuTTY</strong></p>
<ul>
  <li>Open Windows Terminal.</li>
  <li>Go to <strong>Settings</strong> and open the <strong>JSON file</strong> for editing.</li>
  <li>
    <p>Add the following JSON snippet to configure PuTTY:</p>

    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
      </span><span class="nl">"commandline"</span><span class="p">:</span><span class="w"> </span><span class="s2">"C:</span><span class="se">\\</span><span class="s2">Program Files</span><span class="se">\\</span><span class="s2">PuTTY</span><span class="se">\\</span><span class="s2">putty.exe"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"guid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{82a5e4dc-8b1d-4635-804d-0f03a20aff5e}"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"hidden"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"icon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"C:</span><span class="se">\\</span><span class="s2">Program Files</span><span class="se">\\</span><span class="s2">PuTTY</span><span class="se">\\</span><span class="s2">putty.ico"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PuTTY"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"startingDirectory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"%USERPROFILE%"</span><span class="w">
  </span><span class="p">}</span><span class="err">,</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Or, Click on the dropdown menu and select Settings.</li>
  <li>Click on the Add a new profile button.</li>
  <li>Click on the New empty profile button.</li>
  <li>Add name as PuTTY and set the commandline as C:\Program Files\PuTTY\putty.exe.</li>
  <li>Save and restart Windows Terminal. PuTTY will now be available in the dropdown menu.</li>
</ul>

<p><strong>Customize Ubuntu and PuTTY Profiles</strong></p>

<p><strong>Customization Options</strong>
You can further customize each profile with options like fonts, color schemes, or starting directories:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"fontFace"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cascadia Code PL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"colorScheme"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Campbell"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"startingDirectory"</span><span class="p">:</span><span class="w"> </span><span class="s2">"//wsl$/Ubuntu/home/&lt;your-username&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"backgroundImage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"C:/path/to/your/background.png"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"backgroundImageOpacity"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>Steps to Apply Customization</strong></p>
<ul>
  <li>Replace <code class="language-plaintext highlighter-rouge">&lt;your-username&gt;</code> with your Ubuntu username.</li>
  <li>Update paths to match your setup.</li>
  <li>Save and restart Windows Terminal.</li>
</ul>

<p><strong>Verify Profiles</strong></p>
<ul>
  <li>To verify your configuration:
    <ul>
      <li>Open Windows Terminal.</li>
      <li>Click the dropdown menu and check if <strong>Ubuntu</strong> and <strong>PuTTY</strong> appear.</li>
      <li>Launch each profile to ensure they work correctly.</li>
    </ul>
  </li>
</ul>

<p><strong>Bonus: Enable SSH with Ubuntu</strong></p>

<p>You can also use Ubuntu for SSH connections instead of PuTTY by installing OpenSSH:</p>

<ul>
  <li>
    <p>Open Ubuntu and run:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">sudo </span>apt update
 <span class="nb">sudo </span>apt <span class="nb">install </span>openssh-client
</code></pre></div>    </div>
  </li>
  <li>
    <p>Use SSH commands directly in your Ubuntu profile, such as:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ssh user@hostname
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Conclusion</strong></p>

<p>By integrating <strong>Ubuntu</strong> and <strong>PuTTY</strong> into Windows Terminal, you can manage your development and administrative tasks more efficiently. The unified interface allows for seamless switching between environments, enhancing your productivity and workflow.</p>]]></content><author><name>Mahedee Hasan</name></author><category term="Windows" /><category term="Terminal" /><category term="Ubuntu" /><category term="PuTTY" /><category term="Productivity" /><category term="PowerShell" /><category term="Command" /><category term="windows" /><category term="terminal" /><category term="ubuntu" /><category term="putty" /><category term="productivity" /><category term="powershell" /><category term="wsl" /><category term="command" /><summary type="html"><![CDATA[Discover how to integrate Ubuntu (via WSL) and PuTTY into Windows Terminal for a seamless command-line experience. This step-by-step guide walks you through the installation, configuration, and customization process, helping you boost productivity and streamline your workflow.]]></summary></entry><entry><title type="html">Utilizing Bulk Operations with Entity Framework and ASP.NET Core</title><link href="https://mahedee.net//utilizing_bulk_operations_with_entity_framework_and_aspnet_core/" rel="alternate" type="text/html" title="Utilizing Bulk Operations with Entity Framework and ASP.NET Core" /><published>2024-03-02T00:00:00-05:00</published><updated>2024-03-02T00:00:00-05:00</updated><id>https://mahedee.net//utilizing_bulk_operations_with_entity_framework_and_aspnet_core</id><content type="html" xml:base="https://mahedee.net//utilizing_bulk_operations_with_entity_framework_and_aspnet_core/"><![CDATA[<p>A bulk operation refers to the execution of a single operation that involves multiple data entries or rows in a database, typically performed in a batch. Instead of processing each entry individually, bulk operations allow for the manipulation or retrieval of data in a more efficient manner.</p>

<p>The benefits of bulk operations include:</p>

<ol>
  <li>
    <p>Improved Performance: By processing multiple data entries in a single operation, bulk operations can significantly reduce the overhead associated with multiple individual operations, resulting in improved performance and reduced latency.</p>
  </li>
  <li>
    <p>Reduced Resource Usage: Bulk operations require fewer resources compared to performing the same task iteratively on each data entry. This can lead to better utilization of system resources and improved scalability.</p>
  </li>
  <li>
    <p>Enhanced Throughput: With the ability to handle large volumes of data more efficiently, bulk operations can increase the throughput of data processing tasks, allowing applications to handle higher workloads without sacrificing performance.</p>
  </li>
  <li>
    <p>Minimized Database Overhead: Bulk operations can help minimize the overhead on the database server by reducing the number of transactions and communication overhead associated with processing individual data entries.</p>
  </li>
  <li>
    <p>Simplified Code Logic: By consolidating multiple operations into a single bulk operation, developers can write simpler and more concise code, leading to easier maintenance and reduced complexity in application logic.</p>
  </li>
</ol>

<p>To perform bulk operations in an ASP.NET Core application, we can leverage the capabilities of Entity Framework Core and the EFCore.BulkExtensions library. This article will explore the practical implementation of bulk operations using these tools, providing insights into how to optimize database operations and enhance application performance.</p>

<p><strong>EFCore BulkExtensions</strong></p>

<p>EFCore.BulkExtensions is a popular library that extends the functionality of Entity Framework Core by providing support for bulk operations such as bulk insert, update, delete, and merge. This library offers a convenient and efficient way to perform bulk operations on database entities, allowing developers to streamline data processing tasks and improve application performance.</p>

<p>In this article, we will focus on the following bulk operations using EFCore.BulkExtensions and Entity Framework Core.</p>

<p><strong>Tools and Technology Used</strong></p>

<ul>
  <li>ASP.net core Web API</li>
  <li>Visual C#</li>
  <li>Entity Framework</li>
  <li>EFCore.BulkExtensions</li>
  <li>SQL Server</li>
</ul>

<p><strong>Step 1: Create a asp.net core web api project name EFBulkBatch</strong></p>

<p><strong>Step 2: Install the following nuget packages in the project.</strong></p>

<div class="language-ps highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">EFCore.BulkExtensions</span>
<span class="nf">Microsoft.AspNetCore.OpenApi</span>
<span class="nf">Microsoft.EntityFrameworkCore</span>
<span class="nf">Microsoft.EntityFrameworkCore.SqlServer</span>
<span class="nf">Microsoft.EntityFrameworkCore.Tools</span>
</code></pre></div></div>

<p><strong>Step 3: Create two Model class name Customer and Employee in Models folder</strong></p>

<ul>
  <li>Customer class will be used to perform bulk operation using Entity Framework.</li>
  <li>Employee class will be used to perform bulk operation using EFCore.BulkExtensions.</li>
</ul>

<p><strong>Customer.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">namespace</span> <span class="nn">EFBulkBatch.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Customer</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Email</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Phone</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Employee.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">namespace</span> <span class="nn">EFBulkBatch.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Employee</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Designation</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Department</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Step 4: Create Db Context class name ApplicationDbContext in Db folder.</strong></p>

<p><strong>ApplicationDbContext.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">EFBulkBatch.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">EFBulkBatch.Db</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ApplicationDbContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">ApplicationDbContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="p">&lt;</span><span class="n">ApplicationDbContext</span><span class="p">&gt;</span> <span class="n">options</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="p">{</span>
            
        <span class="p">}</span>
        
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;</span> <span class="n">Employees</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;</span> <span class="n">Customers</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>


</code></pre></div></div>

<p><strong>Step 5: Create CustomerService class in Manager folder to perform bulk operation using Entity Framework.</strong></p>

<p><strong>Manager/CustomerService.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">EFBulkBatch.Db</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EFBulkBatch.Models</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">EFBulkBatch.Managers</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">CustomerService</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ApplicationDbContext</span> <span class="n">_context</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">DateTime</span> <span class="n">_startTime</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">TimeSpan</span> <span class="n">_elapsedTime</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">CustomerService</span><span class="p">(</span><span class="n">ApplicationDbContext</span> <span class="n">context</span><span class="p">)</span> 
        <span class="p">{</span>
            <span class="n">_context</span> <span class="p">=</span> <span class="n">context</span><span class="p">;</span>
        <span class="p">}</span>


        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">TimeSpan</span><span class="p">&gt;</span> <span class="nf">AddBulkCustomerAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// C# 9.0 feature: Target-typed new expressions</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;</span> <span class="n">customers</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
            <span class="n">_startTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">100000</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">customers</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Customer</span>
                <span class="p">{</span>
                    <span class="n">Name</span> <span class="p">=</span> <span class="s">$"Customer </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span><span class="p">,</span>
                    <span class="n">Email</span> <span class="p">=</span> <span class="s">$"Email </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span><span class="p">,</span>
                    <span class="n">Phone</span> <span class="p">=</span> <span class="s">$"Phone </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span>
                <span class="p">});</span>
            <span class="p">}</span>

            <span class="c1">// Use AddRange to add multiple entities</span>
            <span class="n">_context</span><span class="p">.</span><span class="n">Customers</span><span class="p">.</span><span class="nf">AddRange</span><span class="p">(</span><span class="n">customers</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>
            <span class="n">_elapsedTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span> <span class="p">-</span> <span class="n">_startTime</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">_elapsedTime</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">TimeSpan</span><span class="p">&gt;</span> <span class="nf">UpdateBulkCustomerAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// C# 9.0 feature: Target-typed new expressions</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;</span> <span class="n">customers</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
            <span class="n">_startTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">100000</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">customers</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Customer</span>
                <span class="p">{</span>
                    <span class="n">Id</span> <span class="p">=</span> <span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">,</span>
                    <span class="n">Name</span> <span class="p">=</span> <span class="s">$"Update Customer </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span><span class="p">,</span>
                    <span class="n">Email</span> <span class="p">=</span> <span class="s">$"Update Email </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span><span class="p">,</span>
                    <span class="n">Phone</span> <span class="p">=</span> <span class="s">$"Update Phone </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span>
                <span class="p">});</span>
            <span class="p">}</span>

            <span class="c1">// Use UpdateRange to update multiple entities</span>
            <span class="n">_context</span><span class="p">.</span><span class="n">Customers</span><span class="p">.</span><span class="nf">UpdateRange</span><span class="p">(</span><span class="n">customers</span><span class="p">);</span>
 
            <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>

            <span class="n">_elapsedTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span> <span class="p">-</span> <span class="n">_startTime</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">_elapsedTime</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">TimeSpan</span><span class="p">&gt;</span> <span class="nf">DeleteBulkCustomerAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;</span> <span class="n">customers</span> <span class="p">=</span> <span class="n">_context</span><span class="p">.</span><span class="n">Customers</span><span class="p">.</span><span class="nf">ToList</span><span class="p">();</span>
            <span class="n">_startTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>

            <span class="c1">// Use RemoveRange to delete multiple entities</span>
            <span class="n">_context</span><span class="p">.</span><span class="n">Customers</span><span class="p">.</span><span class="nf">RemoveRange</span><span class="p">(</span><span class="n">customers</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>
            <span class="n">_elapsedTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span> <span class="p">-</span> <span class="n">_startTime</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">_elapsedTime</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Step 6: Create EmployeeService class in Manager folder to perform bulk operation using EFCore.BulkExtensions.</strong></p>

<p><strong>Manager/EmployeeService.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">EFBulkBatch.Db</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EFBulkBatch.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EFCore.BulkExtensions</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">EFBulkBatch.Managers</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">EmployeeService</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ApplicationDbContext</span> <span class="n">_dbContext</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">DateTime</span> <span class="n">_startTime</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">TimeSpan</span> <span class="n">_elapsedTime</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">EmployeeService</span><span class="p">(</span><span class="n">ApplicationDbContext</span> <span class="n">dbContext</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_dbContext</span> <span class="p">=</span> <span class="n">dbContext</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">TimeSpan</span><span class="p">&gt;</span> <span class="nf">AddBulkDataAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// C# 9.0 feature: Target-typed new expressions</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;</span> <span class="n">employees</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
            <span class="n">_startTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>

            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">100000</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">employees</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Employee</span>
                <span class="p">{</span>
                    <span class="n">Name</span> <span class="p">=</span> <span class="s">$"Employee </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span><span class="p">,</span>
                    <span class="n">Designation</span> <span class="p">=</span> <span class="s">$"Designation </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span><span class="p">,</span>
                    <span class="n">Department</span> <span class="p">=</span> <span class="s">$"Department </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span>
                <span class="p">});</span>
            <span class="p">}</span>

         
            <span class="c1">// Use BulkInsertAsync to add multiple entities</span>
            <span class="k">await</span> <span class="n">_dbContext</span><span class="p">.</span><span class="nf">BulkInsertAsync</span><span class="p">(</span><span class="n">employees</span><span class="p">);</span>
            <span class="n">_elapsedTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span> <span class="p">-</span> <span class="n">_startTime</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">_elapsedTime</span><span class="p">;</span>
        <span class="p">}</span>


        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">TimeSpan</span><span class="p">&gt;</span> <span class="nf">UpdateBulkDataAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// C# 9.0 feature: Target-typed new expressions</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;</span> <span class="n">employees</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
            <span class="n">_startTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">100000</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">employees</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Employee</span>
                <span class="p">{</span>
                    <span class="n">Id</span> <span class="p">=</span> <span class="n">i</span> <span class="p">+</span> <span class="m">1</span><span class="p">,</span>
                    <span class="n">Name</span> <span class="p">=</span> <span class="s">$"Update Employee </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span><span class="p">,</span>
                    <span class="n">Designation</span> <span class="p">=</span> <span class="s">$"Update Designation </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span><span class="p">,</span>
                    <span class="n">Department</span> <span class="p">=</span> <span class="s">$"Update Department </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span>
                <span class="p">});</span>
            <span class="p">}</span>

            <span class="c1">// Use BulkUpdateAsync to update multiple entities</span>
            <span class="k">await</span> <span class="n">_dbContext</span><span class="p">.</span><span class="nf">BulkUpdateAsync</span><span class="p">(</span><span class="n">employees</span><span class="p">);</span>
            <span class="n">_elapsedTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span> <span class="p">-</span> <span class="n">_startTime</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">_elapsedTime</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">TimeSpan</span><span class="p">&gt;</span> <span class="nf">DeleteBulkDataAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// C# 9.0 feature: Target-typed new expressions</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;</span> <span class="n">employees</span> <span class="p">=</span> <span class="n">_dbContext</span><span class="p">.</span><span class="n">Employees</span><span class="p">.</span><span class="nf">ToList</span><span class="p">();</span>
            <span class="n">_startTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>

            <span class="c1">// Use BulkDeleteAsync to delete multiple entities</span>
            <span class="k">await</span> <span class="n">_dbContext</span><span class="p">.</span><span class="nf">BulkDeleteAsync</span><span class="p">(</span><span class="n">employees</span><span class="p">);</span>
            <span class="n">_elapsedTime</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span> <span class="p">-</span> <span class="n">_startTime</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">_elapsedTime</span><span class="p">;</span>
        <span class="p">}</span>


    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Step 7: Add connection string in appsettings.json file</strong></p>

<p><strong>appsettings.json</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"Logging"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"LogLevel"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Information"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Microsoft.AspNetCore"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Warning"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"AllowedHosts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ConnectionStrings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"DefaultConnection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Server=.;Database=EFBulkBatchDB; User Id = sa; Password = YourPassword; TrustServerCertificate=True;"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<p><strong>Step 8: Configure Program class as follows.</strong></p>

<p><strong>Program.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">EFBulkBatch.Db</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EFBulkBatch.Managers</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">EFBulkBatch</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

            <span class="c1">// Add services to the container.</span>

            <span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">();</span>

            <span class="c1">// Register the DbContext with the DI container</span>
            <span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">ApplicationDbContext</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
                           <span class="n">options</span><span class="p">.</span><span class="nf">UseSqlServer</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"DefaultConnection"</span><span class="p">)));</span>

            <span class="c1">// Register the Services with the DI container</span>
            <span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">EmployeeService</span><span class="p">&gt;();</span>
            <span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">CustomerService</span><span class="p">&gt;();</span>


            <span class="c1">// Learn more about configuring Swagger/OpenAPI at https://aka.ms/aspnetcore/swashbuckle</span>
            <span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddEndpointsApiExplorer</span><span class="p">();</span>
            <span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddSwaggerGen</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

            <span class="c1">// Configure the HTTP request pipeline.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">Environment</span><span class="p">.</span><span class="nf">IsDevelopment</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="n">app</span><span class="p">.</span><span class="nf">UseSwagger</span><span class="p">();</span>
                <span class="n">app</span><span class="p">.</span><span class="nf">UseSwaggerUI</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="n">app</span><span class="p">.</span><span class="nf">UseHttpsRedirection</span><span class="p">();</span>

            <span class="n">app</span><span class="p">.</span><span class="nf">UseAuthorization</span><span class="p">();</span>


            <span class="n">app</span><span class="p">.</span><span class="nf">MapControllers</span><span class="p">();</span>

            <span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Step 9: Create two Controller classes name CustomerController and EmployeeController in Controllers folder.</strong></p>

<p><strong>Controllers/CustomerController.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">EFBulkBatch.Managers</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Mvc</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">EFBulkBatch.Controllers</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"api/[controller]"</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">ApiController</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">CustomerController</span> <span class="p">:</span> <span class="n">Controller</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">CustomerService</span> <span class="n">_customerService</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">CustomerController</span><span class="p">(</span><span class="n">CustomerService</span> <span class="n">customerService</span><span class="p">)</span> 
        <span class="p">{</span>
            <span class="n">_customerService</span> <span class="p">=</span> <span class="n">customerService</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Index</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpPost</span><span class="p">(</span><span class="s">"AddBulkData"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">AddBulkDataAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">elapsedTime</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_customerService</span><span class="p">.</span><span class="nf">AddBulkCustomerAsync</span><span class="p">();</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">elapsedTime</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpPut</span><span class="p">(</span><span class="s">"UpdateBulkData"</span><span class="p">)]</span> 
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">UpdateBulkDataAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">elapsedTime</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_customerService</span><span class="p">.</span><span class="nf">UpdateBulkCustomerAsync</span><span class="p">();</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">elapsedTime</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpDelete</span><span class="p">(</span><span class="s">"DeleteBulkData"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">DeleteBulkDataAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">elapsedTime</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_customerService</span><span class="p">.</span><span class="nf">DeleteBulkCustomerAsync</span><span class="p">();</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">elapsedTime</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Controllers/EmployeeController.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">EFBulkBatch.Managers</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EFBulkBatch.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Mvc</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">EFBulkBatch.Controllers</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"api/[controller]"</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">ApiController</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">EmployeeController</span> <span class="p">:</span> <span class="n">Controller</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">EmployeeService</span> <span class="n">_employeeService</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">EmployeeController</span><span class="p">(</span><span class="n">EmployeeService</span> <span class="n">employeeService</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_employeeService</span> <span class="p">=</span> <span class="n">employeeService</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="k">public</span> <span class="n">IActionResult</span> <span class="nf">Index</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
        <span class="p">}</span>


        <span class="p">[</span><span class="nf">HttpPost</span><span class="p">(</span><span class="s">"AddBulkData"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">AddBulkDataAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">elapsedTime</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_employeeService</span><span class="p">.</span><span class="nf">AddBulkDataAsync</span><span class="p">();</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">elapsedTime</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpPut</span><span class="p">(</span><span class="s">"UpdateBulkData"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">UpdateBulkDataAysnc</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">elapsedTime</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_employeeService</span><span class="p">.</span><span class="nf">UpdateBulkDataAsync</span><span class="p">();</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">elapsedTime</span><span class="p">);</span>

        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpDelete</span><span class="p">(</span><span class="s">"DeleteBulkData"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">DeleteBulkDataAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">elapsedTime</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_employeeService</span><span class="p">.</span><span class="nf">DeleteBulkDataAsync</span><span class="p">();</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">elapsedTime</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Step 10: Run migration command to create database and tables.</strong></p>

<ul>
  <li>Go to tools &gt; NuGet Package Manager &gt; Package Manager Console</li>
  <li>Select EFBulkBatch from Default project dropdown</li>
  <li>Run the following command in Package Manager Console window</li>
</ul>

<div class="language-ps highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">Add-Migration</span> <span class="nf">InitialCreate</span>
<span class="nf">Update-Database</span>
</code></pre></div></div>

<p><strong>Step 11: Run the application and test the API using Postman or Swagger UI.</strong></p>

<ul>
  <li>Run the application</li>
  <li>Open Postman or Swagger UI</li>
  <li>Test the API using the endpoint and perform the bulk operation for insert, update and delete.</li>
</ul>

<p><strong><a href="https://github.com/mahedee/code-sample02/tree/master/EFBulkBatch">Source code</a></strong></p>]]></content><author><name>Mahedee Hasan</name></author><category term="ASP.NET" /><category term="ASP.NET Core" /><category term="C#" /><category term="Web API" /><category term="EF" /><category term="csharp" /><category term="aspnet" /><category term="aspnetcore" /><category term="webapi" /><category term="ef" /><summary type="html"><![CDATA[Bulk operations often serve as pivotal performance enhancers within applications. This article delves into the effective utilization of bulk operations using Entity Framework Core and EFCore.BlukExtensions, offering practical insights and guidance for implementation.]]></summary></entry><entry><title type="html">Optimistic Concurrency Management in ASP.NET Core Application Using Raw SQL and ADO.NET</title><link href="https://mahedee.net//optimistic_concurrency_management_aspnet_core_using_raw_sql/" rel="alternate" type="text/html" title="Optimistic Concurrency Management in ASP.NET Core Application Using Raw SQL and ADO.NET" /><published>2024-02-08T00:00:00-05:00</published><updated>2024-02-08T00:00:00-05:00</updated><id>https://mahedee.net//optimistic_concurrency_management_aspnet_core_using_raw_sql</id><content type="html" xml:base="https://mahedee.net//optimistic_concurrency_management_aspnet_core_using_raw_sql/"><![CDATA[<p>In a previous article <a href="https://mahedee.net/concurrency_management_in_aspnet_core_applications_with_entity_framework/">here</a>, I discussed various ways to deal with concurrency. Optimistic concurrency is a common method for handling such situations. This article is designed to illustrate the practical aspects of managing optimistic concurrency in an ASP.NET Core application using raw SQL and ADO.NET.</p>

<p><strong>Tools and Technology Used</strong></p>

<ul>
  <li>ASP.net core Web API</li>
  <li>Visual C#</li>
  <li>Entity Framework</li>
  <li>SQL Server</li>
</ul>

<p><strong>Step 1: Create a database in SQL Server name - ConcurrencySQLDB</strong></p>

<p><strong>Step 2: Create a table name Product</strong></p>
<ul>
  <li>Run the following script to create the table</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">Products</span><span class="p">](</span>
	<span class="p">[</span><span class="n">Id</span><span class="p">]</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">Name</span><span class="p">]</span> <span class="p">[</span><span class="n">nvarchar</span><span class="p">](</span><span class="k">max</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">Price</span><span class="p">]</span> <span class="p">[</span><span class="nb">decimal</span><span class="p">](</span><span class="mi">18</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">Quantity</span><span class="p">]</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">RowVersion</span><span class="p">]</span> <span class="p">[</span><span class="n">uniqueidentifier</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
 <span class="k">CONSTRAINT</span> <span class="p">[</span><span class="n">PK_Products</span><span class="p">]</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="n">CLUSTERED</span> 
<span class="p">(</span>
	<span class="p">[</span><span class="n">Id</span><span class="p">]</span> <span class="k">ASC</span>
<span class="p">)</span><span class="k">WITH</span> <span class="p">(</span><span class="n">PAD_INDEX</span> <span class="o">=</span> <span class="k">OFF</span><span class="p">,</span> <span class="n">STATISTICS_NORECOMPUTE</span> <span class="o">=</span> <span class="k">OFF</span><span class="p">,</span> <span class="n">IGNORE_DUP_KEY</span> <span class="o">=</span> <span class="k">OFF</span><span class="p">,</span> <span class="n">ALLOW_ROW_LOCKS</span> <span class="o">=</span> <span class="k">ON</span><span class="p">,</span> <span class="n">ALLOW_PAGE_LOCKS</span> <span class="o">=</span> <span class="k">ON</span><span class="p">,</span> <span class="n">OPTIMIZE_FOR_SEQUENTIAL_KEY</span> <span class="o">=</span> <span class="k">OFF</span><span class="p">)</span> <span class="k">ON</span> <span class="p">[</span><span class="k">PRIMARY</span><span class="p">]</span>
<span class="p">)</span> <span class="k">ON</span> <span class="p">[</span><span class="k">PRIMARY</span><span class="p">]</span> <span class="n">TEXTIMAGE_ON</span> <span class="p">[</span><span class="k">PRIMARY</span><span class="p">]</span>
<span class="k">GO</span>
</code></pre></div></div>

<p><strong>Step 3: Create a asp.net core web api project name ConcurrencyHandling.API</strong></p>

<p><strong>Step 4: Install the following nuget packages in the project.</strong></p>

<div class="language-ps highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">System.Data.SqlClient</span>
</code></pre></div></div>

<p><strong>Step 5: Create a Model class name Product in Models folder</strong></p>

<ul>
  <li>Product class to store Product Information</li>
  <li>In the following class RowVersion property is a Guid which is used to track the updated version of the record.</li>
</ul>

<p><strong>Product.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">namespace</span> <span class="nn">Concurrency.API.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Product</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Quantity</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">Guid</span> <span class="n">RowVersion</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Step 6: Create a DBConnector class to connect with database in Persistence folder.</strong></p>

<p><strong>DBConnector.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">System.Data.SqlClient</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Concurrency.API.Persistence</span>
<span class="p">{</span>
    <span class="c1">// This class is used to create a connection to the database.</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">DBConnector</span> <span class="p">:</span> <span class="n">IDisposable</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">SqlConnection</span> <span class="n">connection</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">DBConnector</span><span class="p">(</span><span class="kt">string</span> <span class="n">connectionString</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SqlConnection</span><span class="p">(</span><span class="n">connectionString</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">connection</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>


</code></pre></div></div>

<p><strong>Step 7: Add connection string in appsettings.json file</strong></p>

<p><strong>appsettings.json</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"Logging"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"LogLevel"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Information"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Microsoft.AspNetCore"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Warning"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"ConnectionStrings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"DefaultConnection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Server=localhost;Database=ConcurrencySQLDB;User Id=sa;Password=MyPassword;TrustServerCertificate=True;"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"AllowedHosts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<p><strong>Step 8: Create IProductRepository in Repositories/Interface folder</strong></p>

<p><strong>IProductRepository.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Concurrency.API.Models</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Concurrency.API.Repositories.Interfaces</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IProductRepository</span>
    <span class="p">{</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">GetProducts</span><span class="p">();</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">);</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">AddProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">);</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">UpdateProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">);</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">DeleteProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">rowVersion</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Step 9: Create ProductRepository in Repositories/Implementation folder</strong></p>

<p><strong>ProductRepository.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Concurrency.API.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Persistence</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Repositories.Interfaces</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Data.SqlClient</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Concurrency.API.Repositories.Implementations</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductRepository</span> <span class="p">:</span> <span class="n">IProductRepository</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">DBConnector</span> <span class="n">_connector</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">ProductRepository</span><span class="p">(</span><span class="n">DBConnector</span> <span class="n">dBConnector</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_connector</span> <span class="p">=</span> <span class="n">dBConnector</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">AddProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">model</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>   
                <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">State</span> <span class="p">==</span> <span class="n">ConnectionState</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
                <span class="kt">var</span> <span class="n">cmd</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">()</span> <span class="k">as</span> <span class="n">SqlCommand</span><span class="p">;</span>
                <span class="n">SqlTransaction</span> <span class="n">transaction</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Transaction</span> <span class="p">=</span> <span class="n">transaction</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"INSERT INTO Products (Name, Price, Quantity, RowVersion) 
                OUTPUT inserted.Id                
                VALUES (@Name, @Price, @Quantity, @RowVersion); SELECT SCOPE_IDENTITY();"</span><span class="p">;</span>

                <span class="n">Guid</span> <span class="n">rowVersion</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">();</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Name"</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Price"</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Price</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Quantity"</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Quantity</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@RowVersion"</span><span class="p">,</span> <span class="n">rowVersion</span><span class="p">);</span>

                <span class="c1">// cmd.ExecuteScalar() returns the first column of the first row in the result</span>
                <span class="c1">// set returned by the query. Additional columns or rows are ignored.</span>
                <span class="kt">int</span> <span class="n">insertedId</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteScalar</span><span class="p">());</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">insertedId</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">transaction</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="n">model</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="n">insertedId</span><span class="p">;</span>
                <span class="n">model</span><span class="p">.</span><span class="n">RowVersion</span> <span class="p">=</span> <span class="n">rowVersion</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="nf">FromResult</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="n">ex</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">finally</span>
            <span class="p">{</span>
                <span class="c1">// close connection</span>
                <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Product</span><span class="p">();</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">State</span> <span class="p">==</span> <span class="n">ConnectionState</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
                <span class="kt">var</span> <span class="n">cmd</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">()</span> <span class="k">as</span> <span class="n">SqlCommand</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"SELECT Id, Name, Price, Quantity, RowVersion FROM Products WHERE Id = @Id"</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Id"</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
                <span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteReader</span><span class="p">();</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="nf">Read</span><span class="p">())</span>
                <span class="p">{</span>
                    <span class="n">product</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="s">"Id"</span><span class="p">]);</span>
                    <span class="n">product</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Name"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Name"</span><span class="p">].</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">:</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
                    <span class="n">product</span><span class="p">.</span><span class="n">Price</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Price"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToDecimal</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="s">"Price"</span><span class="p">])</span> <span class="p">:</span> <span class="m">0</span><span class="p">;</span>
                    <span class="n">product</span><span class="p">.</span><span class="n">Quantity</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Quantity"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="s">"Quantity"</span><span class="p">])</span> <span class="p">:</span> <span class="m">0</span><span class="p">;</span>
                    <span class="n">product</span><span class="p">.</span><span class="n">RowVersion</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"RowVersion"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="p">(</span><span class="n">Guid</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="s">"RowVersion"</span><span class="p">]</span> <span class="p">:</span> <span class="n">Guid</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="n">ex</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">finally</span>
            <span class="p">{</span>
                <span class="c1">// close connection</span>
                <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// Task.FromResult is a helper method that creates a Task that's completed successfully</span>
            <span class="c1">// with the specified result.</span>
            <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="nf">FromResult</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">GetProducts</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">products</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;();</span>

            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">State</span> <span class="p">==</span> <span class="n">ConnectionState</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
                <span class="kt">var</span> <span class="n">cmd</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">()</span> <span class="k">as</span> <span class="n">SqlCommand</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"SELECT Id, Name, Price, Quantity, RowVersion FROM Products"</span><span class="p">;</span>
                <span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteReader</span><span class="p">();</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="nf">Read</span><span class="p">())</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Product</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Id</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="s">"Id"</span><span class="p">]),</span>
                        <span class="n">Name</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Name"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Name"</span><span class="p">].</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">:</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">,</span>
                        <span class="n">Price</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Price"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToDecimal</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="s">"Price"</span><span class="p">])</span> <span class="p">:</span> <span class="m">0</span><span class="p">,</span>
                        <span class="n">Quantity</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Quantity"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="s">"Quantity"</span><span class="p">])</span> <span class="p">:</span> <span class="m">0</span><span class="p">,</span>
                        <span class="n">RowVersion</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"RowVersion"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="p">(</span><span class="n">Guid</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="s">"RowVersion"</span><span class="p">]</span> <span class="p">:</span> <span class="n">Guid</span><span class="p">.</span><span class="n">Empty</span>
                    <span class="p">};</span>
                    <span class="n">products</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="n">ex</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">finally</span>
            <span class="p">{</span>
                <span class="c1">// close connection</span>
                <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">products</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">UpdateProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">{</span>

            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">State</span> <span class="p">==</span> <span class="n">ConnectionState</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
                <span class="kt">var</span> <span class="n">cmd</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">()</span> <span class="k">as</span> <span class="n">SqlCommand</span><span class="p">;</span>
                <span class="n">SqlTransaction</span> <span class="n">transaction</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Transaction</span> <span class="p">=</span> <span class="n">transaction</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"UPDATE Products SET Name = @Name, Price = @Price, Quantity = @Quantity, RowVersion = @RowVersion
                    WHERE Id = @Id AND RowVersion = @RowVersion"</span><span class="p">;</span>

                <span class="n">Guid</span> <span class="n">rowVersion</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">();</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Id"</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Name"</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Price"</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">Price</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Quantity"</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">Quantity</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@RowVersion"</span><span class="p">,</span> <span class="n">rowVersion</span><span class="p">);</span>

                <span class="kt">int</span> <span class="n">effectedRow</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">effectedRow</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">transaction</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="n">product</span><span class="p">.</span><span class="n">RowVersion</span> <span class="p">=</span> <span class="n">rowVersion</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="nf">FromResult</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="n">ex</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">finally</span>
            <span class="p">{</span>
                <span class="c1">// close connection</span>
                <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">DeleteProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">rowVersion</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">State</span> <span class="p">==</span> <span class="n">ConnectionState</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
                <span class="kt">var</span> <span class="n">cmd</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">()</span> <span class="k">as</span> <span class="n">SqlCommand</span><span class="p">;</span>
                <span class="n">SqlTransaction</span> <span class="n">transaction</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Transaction</span> <span class="p">=</span> <span class="n">transaction</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"DELETE FROM Products WHERE Id = @Id AND RowVersion = @RowVersion"</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Id"</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@RowVersion"</span><span class="p">,</span> <span class="n">rowVersion</span><span class="p">);</span>

                <span class="kt">int</span> <span class="n">effectedRow</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">effectedRow</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">transaction</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="nf">FromResult</span><span class="p">(</span><span class="k">new</span> <span class="nf">Product</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="n">ex</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">finally</span>
            <span class="p">{</span>
                <span class="c1">// close connection</span>
                <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<ul>
  <li>Look at the update and delete query. You will see, row version is checked while updating or deleting rows.</li>
</ul>

<p><strong>Step 10: Create IProductService in Services/Interfaces class</strong></p>

<p><strong>IProductService.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Concurrency.API.Models</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Concurrency.API.Services.Interfaces</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IProductService</span>
    <span class="p">{</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">GetProducts</span><span class="p">();</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">);</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">AddProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">);</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">UpdateProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">);</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">DeleteProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">rowVersion</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Step 11: Create ProductService in Services/Implementation class</strong></p>

<p><strong>ProductService.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">Concurrency.API.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Repositories.Interfaces</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Services.Interfaces</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Concurrency.API.Services.Implementations</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductService</span> <span class="p">:</span> <span class="n">IProductService</span>
    <span class="p">{</span>
        <span class="n">IProductRepository</span> <span class="n">_productRepository</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">ProductService</span><span class="p">(</span><span class="n">IProductRepository</span> <span class="n">productRepository</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_productRepository</span> <span class="p">=</span> <span class="n">productRepository</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">AddProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_productRepository</span><span class="p">.</span><span class="nf">AddProduct</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_productRepository</span><span class="p">.</span><span class="nf">GetProduct</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">GetProducts</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_productRepository</span><span class="p">.</span><span class="nf">GetProducts</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">UpdateProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_productRepository</span><span class="p">.</span><span class="nf">UpdateProduct</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">DeleteProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">rowVersion</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_productRepository</span><span class="p">.</span><span class="nf">DeleteProduct</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">rowVersion</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Step 12: Configure Program class as follows.</strong></p>

<p><strong>Program.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Concurrency.API.Persistence</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Repositories.Implementations</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Repositories.Interfaces</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Services.Implementations</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Services.Interfaces</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="c1">// Add services to the container.</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">();</span>
<span class="c1">// Learn more about configuring Swagger/OpenAPI at https://aka.ms/aspnetcore/swashbuckle</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddEndpointsApiExplorer</span><span class="p">();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddSwaggerGen</span><span class="p">();</span>


<span class="kt">string</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"DefaultConnection"</span><span class="p">);</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddTransient</span><span class="p">(</span><span class="n">_</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">DBConnector</span><span class="p">(</span><span class="n">connectionString</span><span class="p">));</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">IProductRepository</span><span class="p">,</span> <span class="n">ProductRepository</span><span class="p">&gt;();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">IProductService</span><span class="p">,</span> <span class="n">ProductService</span><span class="p">&gt;();</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

<span class="c1">// Configure the HTTP request pipeline.</span>
<span class="k">if</span> <span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">Environment</span><span class="p">.</span><span class="nf">IsDevelopment</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseSwagger</span><span class="p">();</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseSwaggerUI</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseHttpsRedirection</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseAuthorization</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">MapControllers</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>


</code></pre></div></div>

<p><strong>Step 13: Create a Controller class ProductsController in Controllers folder.</strong></p>

<p><strong>ProductsController.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">Concurrency.API.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Persistence</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Services.Interfaces</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Mvc</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Concurrency.API.Controllers</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"api/[controller]"</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">ApiController</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductsController</span> <span class="p">:</span> <span class="n">ControllerBase</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">DBConnector</span> <span class="n">_connector</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IProductService</span> <span class="n">_productService</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">ProductsController</span><span class="p">(</span> <span class="n">DBConnector</span> <span class="n">connector</span><span class="p">,</span> <span class="n">IProductService</span> <span class="n">productService</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_connector</span> <span class="p">=</span> <span class="n">connector</span><span class="p">;</span>
            <span class="n">_productService</span> <span class="p">=</span> <span class="n">productService</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// GET: api/Products</span>
        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;&gt;</span> <span class="nf">GetProducts</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">products</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_productService</span><span class="p">.</span><span class="nf">GetProducts</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">products</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">products</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// GET: api/Products/5</span>
        <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_productService</span><span class="p">.</span><span class="nf">GetProduct</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">product</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// PUT: api/Products/5</span>
        <span class="p">[</span><span class="nf">HttpPut</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">PutProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="p">!=</span> <span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_productService</span><span class="p">.</span><span class="nf">UpdateProduct</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// POST: api/Products</span>
        <span class="p">[</span><span class="n">HttpPost</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">PostProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_productService</span><span class="p">.</span><span class="nf">AddProduct</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// DELETE: api/Products/5</span>
        <span class="p">[</span><span class="nf">HttpDelete</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">DeleteProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">rowVersion</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_productService</span><span class="p">.</span><span class="nf">DeleteProduct</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">rowVersion</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>



</code></pre></div></div>

<p><strong>Step 14: Run the application and test concurrency</strong></p>

<ul>
  <li>Create a new record by Post method in swagger. Sample example for post data.</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ASUS Laptop"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mi">1200</span><span class="p">,</span><span class="w">
  </span><span class="nl">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">230</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>Update the record using the Put method in Swagger. A sample input is provided below. Meanwhile, open another tab and make an update to the record. Your record version will be altered. If you attempt to update the record using the previous record version, it will not updated due to concurrency. However, if no one else has updated it and you are using the correct record version, you can update the record.</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ASUS Laptop"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mi">1300</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">230</span><span class="p">,</span><span class="w">
    </span><span class="nl">"rowVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"04e92587-8c5d-4a27-b5d5-bbee9fc84458"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>Delete the record using the Delete method in Swagger. Meanwhile, open another tab and update the record. Your record version will be changed. If you attempt to delete the record using the previous record version, it will throw an exception due to concurrency. However, if no one else has updated it and you are using the correct record version, you can delete the record without encountering any problem.</li>
</ul>

<p><strong><a href="https://github.com/mahedee/code-sample02/tree/master/ConcurrencyRawSQL">Source code</a></strong></p>]]></content><author><name>Mahedee Hasan</name></author><category term="ASP.NET" /><category term="ASP.NET Core" /><category term="C#" /><category term="Web API" /><category term="EF" /><category term="Software Architecture" /><category term="csharp" /><category term="aspnet" /><category term="aspnetcore" /><category term="webapi" /><category term="ef" /><category term="softwarearchitecture" /><summary type="html"><![CDATA[Effectively dealing with concurrency is crucial, especially in large business applications, and it plays a significant role in financial systems. This article is designed to illustrate the practical aspects of managing concurrency in an ASP.NET Core application using raw SQL and ADO.NET.]]></summary></entry></feed>