<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.6 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Optimistic Concurrency Management in ASP.NET Core Application Using Raw SQL and ADO.NET - Think Simple</title>
<meta name="description" content="Effectively dealing with concurrency is crucial, especially in large business applications, and it plays a significant role in financial systems. This article is designed to illustrate the practical aspects of managing concurrency in an ASP.NET Core application using raw SQL and ADO.NET.">


  <meta name="author" content="Mahedee Hasan">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Think Simple">
<meta property="og:title" content="Optimistic Concurrency Management in ASP.NET Core Application Using Raw SQL and ADO.NET">
<meta property="og:url" content="https://mahedee.net//optimistic_concurrency_management_aspnet_core_using_raw_sql/">


  <meta property="og:description" content="Effectively dealing with concurrency is crucial, especially in large business applications, and it plays a significant role in financial systems. This article is designed to illustrate the practical aspects of managing concurrency in an ASP.NET Core application using raw SQL and ADO.NET.">







  <meta property="article:published_time" content="2024-02-08T00:00:00-05:00">





  

  


<link rel="canonical" href="https://mahedee.net//optimistic_concurrency_management_aspnet_core_using_raw_sql/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Mahedee Hasan",
      "url": "https://mahedee.net//"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Think Simple Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



<!-- SEO tags -->
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Optimistic Concurrency Management in ASP.NET Core Application Using Raw SQL and ADO.NET | Think Simple</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Optimistic Concurrency Management in ASP.NET Core Application Using Raw SQL and ADO.NET" />
<meta name="author" content="Mahedee Hasan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Effectively dealing with concurrency is crucial, especially in large business applications, and it plays a significant role in financial systems. This article is designed to illustrate the practical aspects of managing concurrency in an ASP.NET Core application using raw SQL and ADO.NET." />
<meta property="og:description" content="Effectively dealing with concurrency is crucial, especially in large business applications, and it plays a significant role in financial systems. This article is designed to illustrate the practical aspects of managing concurrency in an ASP.NET Core application using raw SQL and ADO.NET." />
<link rel="canonical" href="https://mahedee.net//optimistic_concurrency_management_aspnet_core_using_raw_sql/" />
<meta property="og:url" content="https://mahedee.net//optimistic_concurrency_management_aspnet_core_using_raw_sql/" />
<meta property="og:site_name" content="Think Simple" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-02-08T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Optimistic Concurrency Management in ASP.NET Core Application Using Raw SQL and ADO.NET" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@Mahedee Hasan" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Mahedee Hasan"},"dateModified":"2024-02-08T00:00:00-05:00","datePublished":"2024-02-08T00:00:00-05:00","description":"Effectively dealing with concurrency is crucial, especially in large business applications, and it plays a significant role in financial systems. This article is designed to illustrate the practical aspects of managing concurrency in an ASP.NET Core application using raw SQL and ADO.NET.","headline":"Optimistic Concurrency Management in ASP.NET Core Application Using Raw SQL and ADO.NET","mainEntityOfPage":{"@type":"WebPage","@id":"https://mahedee.net//optimistic_concurrency_management_aspnet_core_using_raw_sql/"},"url":"https://mahedee.net//optimistic_concurrency_management_aspnet_core_using_raw_sql/"}</script>
<!-- End Jekyll SEO tag -->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->



     
  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Think Simple
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/categories" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/me.jpg" alt="Mahedee Hasan" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Mahedee Hasan</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>I am a Microsoft MVP (9th times), programmer, software developer, software architect, consultant, author, researcher, technical blogger, technical speaker, trainer and learner. I have more than 15 years experience in the field of software design and development.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Toronto, Ontario, Canada</span>
        </li>
      

      
        
          
            <li><a href="mailto:mahedee.hasan@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
          
        
          
            <li><a href="https://mahedee.net" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
          
        
          
            <li><a href="https://mvp.microsoft.com/en-us/PublicProfile/5001294" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-award" aria-hidden="true"></i> MVP</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/mahedee/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://twitter.com/mahedeehasan" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
            <li><a href="https://facebook.com/mahedee19" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
          
        
          
            <li><a href="https://github.com/mahedee" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/mahedee" rel="nofollow noopener noreferrer"><i class="fab fa fa-coffee" aria-hidden="true"></i> Buy me a Coffee</a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Optimistic Concurrency Management in ASP.NET Core Application Using Raw SQL and ADO.NET">
    <meta itemprop="description" content="Effectively dealing with concurrency is crucial, especially in large business applications, and it plays a significant role in financial systems. This article is designed to illustrate the practical aspects of managing concurrency in an ASP.NET Core application using raw SQL and ADO.NET.">
    <meta itemprop="datePublished" content="February 08, 2024">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Optimistic Concurrency Management in ASP.NET Core Application Using Raw SQL and ADO.NET
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  7 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>In a previous article <a href="https://mahedee.net/concurrency_management_in_aspnet_core_applications_with_entity_framework/">here</a>, I discussed various ways to deal with concurrency. Optimistic concurrency is a common method for handling such situations. This article is designed to illustrate the practical aspects of managing optimistic concurrency in an ASP.NET Core application using raw SQL and ADO.NET.</p>

<p><strong>Tools and Technology Used</strong></p>

<ul>
  <li>ASP.net core Web API</li>
  <li>Visual C#</li>
  <li>Entity Framework</li>
  <li>SQL Server</li>
</ul>

<p><strong>Step 1: Create a database in SQL Server name - ConcurrencySQLDB</strong></p>

<p><strong>Step 2: Create a table name Product</strong></p>
<ul>
  <li>Run the following script to create the table</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">Products</span><span class="p">](</span>
	<span class="p">[</span><span class="n">Id</span><span class="p">]</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">Name</span><span class="p">]</span> <span class="p">[</span><span class="n">nvarchar</span><span class="p">](</span><span class="k">max</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">Price</span><span class="p">]</span> <span class="p">[</span><span class="nb">decimal</span><span class="p">](</span><span class="mi">18</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">Quantity</span><span class="p">]</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">RowVersion</span><span class="p">]</span> <span class="p">[</span><span class="n">uniqueidentifier</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
 <span class="k">CONSTRAINT</span> <span class="p">[</span><span class="n">PK_Products</span><span class="p">]</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="n">CLUSTERED</span> 
<span class="p">(</span>
	<span class="p">[</span><span class="n">Id</span><span class="p">]</span> <span class="k">ASC</span>
<span class="p">)</span><span class="k">WITH</span> <span class="p">(</span><span class="n">PAD_INDEX</span> <span class="o">=</span> <span class="k">OFF</span><span class="p">,</span> <span class="n">STATISTICS_NORECOMPUTE</span> <span class="o">=</span> <span class="k">OFF</span><span class="p">,</span> <span class="n">IGNORE_DUP_KEY</span> <span class="o">=</span> <span class="k">OFF</span><span class="p">,</span> <span class="n">ALLOW_ROW_LOCKS</span> <span class="o">=</span> <span class="k">ON</span><span class="p">,</span> <span class="n">ALLOW_PAGE_LOCKS</span> <span class="o">=</span> <span class="k">ON</span><span class="p">,</span> <span class="n">OPTIMIZE_FOR_SEQUENTIAL_KEY</span> <span class="o">=</span> <span class="k">OFF</span><span class="p">)</span> <span class="k">ON</span> <span class="p">[</span><span class="k">PRIMARY</span><span class="p">]</span>
<span class="p">)</span> <span class="k">ON</span> <span class="p">[</span><span class="k">PRIMARY</span><span class="p">]</span> <span class="n">TEXTIMAGE_ON</span> <span class="p">[</span><span class="k">PRIMARY</span><span class="p">]</span>
<span class="k">GO</span>
</code></pre></div></div>

<p><strong>Step 3: Create a asp.net core web api project name ConcurrencyHandling.API</strong></p>

<p><strong>Step 4: Install the following nuget packages in the project.</strong></p>

<div class="language-ps highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">System.Data.SqlClient</span>
</code></pre></div></div>

<p><strong>Step 5: Create a Model class name Product in Models folder</strong></p>

<ul>
  <li>Product class to store Product Information</li>
  <li>In the following class RowVersion property is a Guid which is used to track the updated version of the record.</li>
</ul>

<p><strong>Product.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">namespace</span> <span class="nn">Concurrency.API.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Product</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Quantity</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">Guid</span> <span class="n">RowVersion</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Step 6: Create a DBConnector class to connect with database in Persistence folder.</strong></p>

<p><strong>DBConnector.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">System.Data.SqlClient</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Concurrency.API.Persistence</span>
<span class="p">{</span>
    <span class="c1">// This class is used to create a connection to the database.</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">DBConnector</span> <span class="p">:</span> <span class="n">IDisposable</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">SqlConnection</span> <span class="n">connection</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">DBConnector</span><span class="p">(</span><span class="kt">string</span> <span class="n">connectionString</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SqlConnection</span><span class="p">(</span><span class="n">connectionString</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">connection</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>


</code></pre></div></div>

<p><strong>Step 7: Add connection string in appsettings.json file</strong></p>

<p><strong>appsettings.json</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"Logging"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"LogLevel"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Information"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Microsoft.AspNetCore"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Warning"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"ConnectionStrings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"DefaultConnection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Server=localhost;Database=ConcurrencySQLDB;User Id=sa;Password=MyPassword;TrustServerCertificate=True;"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"AllowedHosts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<p><strong>Step 8: Create IProductRepository in Repositories/Interface folder</strong></p>

<p><strong>IProductRepository.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Concurrency.API.Models</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Concurrency.API.Repositories.Interfaces</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IProductRepository</span>
    <span class="p">{</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">GetProducts</span><span class="p">();</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">);</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">AddProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">);</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">UpdateProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">);</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">DeleteProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">rowVersion</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Step 9: Create ProductRepository in Repositories/Implementation folder</strong></p>

<p><strong>ProductRepository.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Concurrency.API.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Persistence</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Repositories.Interfaces</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Data.SqlClient</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Concurrency.API.Repositories.Implementations</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductRepository</span> <span class="p">:</span> <span class="n">IProductRepository</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">DBConnector</span> <span class="n">_connector</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">ProductRepository</span><span class="p">(</span><span class="n">DBConnector</span> <span class="n">dBConnector</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_connector</span> <span class="p">=</span> <span class="n">dBConnector</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">AddProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">model</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>   
                <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">State</span> <span class="p">==</span> <span class="n">ConnectionState</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
                <span class="kt">var</span> <span class="n">cmd</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">()</span> <span class="k">as</span> <span class="n">SqlCommand</span><span class="p">;</span>
                <span class="n">SqlTransaction</span> <span class="n">transaction</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Transaction</span> <span class="p">=</span> <span class="n">transaction</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"INSERT INTO Products (Name, Price, Quantity, RowVersion) 
                OUTPUT inserted.Id                
                VALUES (@Name, @Price, @Quantity, @RowVersion); SELECT SCOPE_IDENTITY();"</span><span class="p">;</span>

                <span class="n">Guid</span> <span class="n">rowVersion</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">();</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Name"</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Price"</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Price</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Quantity"</span><span class="p">,</span> <span class="n">model</span><span class="p">.</span><span class="n">Quantity</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@RowVersion"</span><span class="p">,</span> <span class="n">rowVersion</span><span class="p">);</span>

                <span class="c1">// cmd.ExecuteScalar() returns the first column of the first row in the result</span>
                <span class="c1">// set returned by the query. Additional columns or rows are ignored.</span>
                <span class="kt">int</span> <span class="n">insertedId</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteScalar</span><span class="p">());</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">insertedId</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">transaction</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="n">model</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="n">insertedId</span><span class="p">;</span>
                <span class="n">model</span><span class="p">.</span><span class="n">RowVersion</span> <span class="p">=</span> <span class="n">rowVersion</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="nf">FromResult</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="n">ex</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">finally</span>
            <span class="p">{</span>
                <span class="c1">// close connection</span>
                <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Product</span><span class="p">();</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">State</span> <span class="p">==</span> <span class="n">ConnectionState</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
                <span class="kt">var</span> <span class="n">cmd</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">()</span> <span class="k">as</span> <span class="n">SqlCommand</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"SELECT Id, Name, Price, Quantity, RowVersion FROM Products WHERE Id = @Id"</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Id"</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
                <span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteReader</span><span class="p">();</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="nf">Read</span><span class="p">())</span>
                <span class="p">{</span>
                    <span class="n">product</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="s">"Id"</span><span class="p">]);</span>
                    <span class="n">product</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Name"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Name"</span><span class="p">].</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">:</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
                    <span class="n">product</span><span class="p">.</span><span class="n">Price</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Price"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToDecimal</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="s">"Price"</span><span class="p">])</span> <span class="p">:</span> <span class="m">0</span><span class="p">;</span>
                    <span class="n">product</span><span class="p">.</span><span class="n">Quantity</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Quantity"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="s">"Quantity"</span><span class="p">])</span> <span class="p">:</span> <span class="m">0</span><span class="p">;</span>
                    <span class="n">product</span><span class="p">.</span><span class="n">RowVersion</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"RowVersion"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="p">(</span><span class="n">Guid</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="s">"RowVersion"</span><span class="p">]</span> <span class="p">:</span> <span class="n">Guid</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="n">ex</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">finally</span>
            <span class="p">{</span>
                <span class="c1">// close connection</span>
                <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// Task.FromResult is a helper method that creates a Task that's completed successfully</span>
            <span class="c1">// with the specified result.</span>
            <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="nf">FromResult</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">GetProducts</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">products</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;();</span>

            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">State</span> <span class="p">==</span> <span class="n">ConnectionState</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
                <span class="kt">var</span> <span class="n">cmd</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">()</span> <span class="k">as</span> <span class="n">SqlCommand</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"SELECT Id, Name, Price, Quantity, RowVersion FROM Products"</span><span class="p">;</span>
                <span class="kt">var</span> <span class="n">reader</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteReader</span><span class="p">();</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="nf">Read</span><span class="p">())</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Product</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Id</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="s">"Id"</span><span class="p">]),</span>
                        <span class="n">Name</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Name"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Name"</span><span class="p">].</span><span class="nf">ToString</span><span class="p">()</span> <span class="p">:</span> <span class="n">String</span><span class="p">.</span><span class="n">Empty</span><span class="p">,</span>
                        <span class="n">Price</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Price"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToDecimal</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="s">"Price"</span><span class="p">])</span> <span class="p">:</span> <span class="m">0</span><span class="p">,</span>
                        <span class="n">Quantity</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"Quantity"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToInt32</span><span class="p">(</span><span class="n">reader</span><span class="p">[</span><span class="s">"Quantity"</span><span class="p">])</span> <span class="p">:</span> <span class="m">0</span><span class="p">,</span>
                        <span class="n">RowVersion</span> <span class="p">=</span> <span class="n">reader</span><span class="p">[</span><span class="s">"RowVersion"</span><span class="p">]</span> <span class="p">!=</span> <span class="n">DBNull</span><span class="p">.</span><span class="n">Value</span> <span class="p">?</span> <span class="p">(</span><span class="n">Guid</span><span class="p">)</span><span class="n">reader</span><span class="p">[</span><span class="s">"RowVersion"</span><span class="p">]</span> <span class="p">:</span> <span class="n">Guid</span><span class="p">.</span><span class="n">Empty</span>
                    <span class="p">};</span>
                    <span class="n">products</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="n">ex</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">finally</span>
            <span class="p">{</span>
                <span class="c1">// close connection</span>
                <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">products</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">UpdateProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">{</span>

            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">State</span> <span class="p">==</span> <span class="n">ConnectionState</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
                <span class="kt">var</span> <span class="n">cmd</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">()</span> <span class="k">as</span> <span class="n">SqlCommand</span><span class="p">;</span>
                <span class="n">SqlTransaction</span> <span class="n">transaction</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Transaction</span> <span class="p">=</span> <span class="n">transaction</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"UPDATE Products SET Name = @Name, Price = @Price, Quantity = @Quantity, RowVersion = @RowVersion
                    WHERE Id = @Id AND RowVersion = @RowVersion"</span><span class="p">;</span>

                <span class="n">Guid</span> <span class="n">rowVersion</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">();</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Id"</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Name"</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Price"</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">Price</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Quantity"</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">Quantity</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@RowVersion"</span><span class="p">,</span> <span class="n">rowVersion</span><span class="p">);</span>

                <span class="kt">int</span> <span class="n">effectedRow</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">effectedRow</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">transaction</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="n">product</span><span class="p">.</span><span class="n">RowVersion</span> <span class="p">=</span> <span class="n">rowVersion</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="nf">FromResult</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="n">ex</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">finally</span>
            <span class="p">{</span>
                <span class="c1">// close connection</span>
                <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">DeleteProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">rowVersion</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">State</span> <span class="p">==</span> <span class="n">ConnectionState</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
                <span class="kt">var</span> <span class="n">cmd</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">()</span> <span class="k">as</span> <span class="n">SqlCommand</span><span class="p">;</span>
                <span class="n">SqlTransaction</span> <span class="n">transaction</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Transaction</span> <span class="p">=</span> <span class="n">transaction</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"DELETE FROM Products WHERE Id = @Id AND RowVersion = @RowVersion"</span><span class="p">;</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@Id"</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
                <span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@RowVersion"</span><span class="p">,</span> <span class="n">rowVersion</span><span class="p">);</span>

                <span class="kt">int</span> <span class="n">effectedRow</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">effectedRow</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">transaction</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">Task</span><span class="p">.</span><span class="nf">FromResult</span><span class="p">(</span><span class="k">new</span> <span class="nf">Product</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="n">ex</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">finally</span>
            <span class="p">{</span>
                <span class="c1">// close connection</span>
                <span class="k">this</span><span class="p">.</span><span class="n">_connector</span><span class="p">.</span><span class="nf">Dispose</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<ul>
  <li>Look at the update and delete query. You will see, row version is checked while updating or deleting rows.</li>
</ul>

<p><strong>Step 10: Create IProductService in Services/Interfaces class</strong></p>

<p><strong>IProductService.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Concurrency.API.Models</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Concurrency.API.Services.Interfaces</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IProductService</span>
    <span class="p">{</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">GetProducts</span><span class="p">();</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">);</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">AddProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">);</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">UpdateProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">);</span>
        <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">DeleteProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">rowVersion</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Step 11: Create ProductService in Services/Implementation class</strong></p>

<p><strong>ProductService.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">Concurrency.API.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Repositories.Interfaces</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Services.Interfaces</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Concurrency.API.Services.Implementations</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductService</span> <span class="p">:</span> <span class="n">IProductService</span>
    <span class="p">{</span>
        <span class="n">IProductRepository</span> <span class="n">_productRepository</span><span class="p">;</span>
        <span class="k">public</span> <span class="nf">ProductService</span><span class="p">(</span><span class="n">IProductRepository</span> <span class="n">productRepository</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_productRepository</span> <span class="p">=</span> <span class="n">productRepository</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">AddProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_productRepository</span><span class="p">.</span><span class="nf">AddProduct</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_productRepository</span><span class="p">.</span><span class="nf">GetProduct</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">GetProducts</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_productRepository</span><span class="p">.</span><span class="nf">GetProducts</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">UpdateProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_productRepository</span><span class="p">.</span><span class="nf">UpdateProduct</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="nf">DeleteProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">rowVersion</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_productRepository</span><span class="p">.</span><span class="nf">DeleteProduct</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">rowVersion</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Step 12: Configure Program class as follows.</strong></p>

<p><strong>Program.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Concurrency.API.Persistence</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Repositories.Implementations</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Repositories.Interfaces</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Services.Implementations</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Services.Interfaces</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="c1">// Add services to the container.</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">();</span>
<span class="c1">// Learn more about configuring Swagger/OpenAPI at https://aka.ms/aspnetcore/swashbuckle</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddEndpointsApiExplorer</span><span class="p">();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddSwaggerGen</span><span class="p">();</span>


<span class="kt">string</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"DefaultConnection"</span><span class="p">);</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddTransient</span><span class="p">(</span><span class="n">_</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">DBConnector</span><span class="p">(</span><span class="n">connectionString</span><span class="p">));</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">IProductRepository</span><span class="p">,</span> <span class="n">ProductRepository</span><span class="p">&gt;();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">IProductService</span><span class="p">,</span> <span class="n">ProductService</span><span class="p">&gt;();</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

<span class="c1">// Configure the HTTP request pipeline.</span>
<span class="k">if</span> <span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">Environment</span><span class="p">.</span><span class="nf">IsDevelopment</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseSwagger</span><span class="p">();</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseSwaggerUI</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseHttpsRedirection</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseAuthorization</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">MapControllers</span><span class="p">();</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>


</code></pre></div></div>

<p><strong>Step 13: Create a Controller class ProductsController in Controllers folder.</strong></p>

<p><strong>ProductsController.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">Concurrency.API.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Persistence</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Concurrency.API.Services.Interfaces</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Mvc</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Concurrency.API.Controllers</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"api/[controller]"</span><span class="p">)]</span>
    <span class="p">[</span><span class="n">ApiController</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductsController</span> <span class="p">:</span> <span class="n">ControllerBase</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">DBConnector</span> <span class="n">_connector</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IProductService</span> <span class="n">_productService</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">ProductsController</span><span class="p">(</span> <span class="n">DBConnector</span> <span class="n">connector</span><span class="p">,</span> <span class="n">IProductService</span> <span class="n">productService</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_connector</span> <span class="p">=</span> <span class="n">connector</span><span class="p">;</span>
            <span class="n">_productService</span> <span class="p">=</span> <span class="n">productService</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// GET: api/Products</span>
        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;&gt;</span> <span class="nf">GetProducts</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">products</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_productService</span><span class="p">.</span><span class="nf">GetProducts</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">products</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">products</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// GET: api/Products/5</span>
        <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_productService</span><span class="p">.</span><span class="nf">GetProduct</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">product</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// PUT: api/Products/5</span>
        <span class="p">[</span><span class="nf">HttpPut</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">PutProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="p">!=</span> <span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_productService</span><span class="p">.</span><span class="nf">UpdateProduct</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// POST: api/Products</span>
        <span class="p">[</span><span class="n">HttpPost</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">PostProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_productService</span><span class="p">.</span><span class="nf">AddProduct</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// DELETE: api/Products/5</span>
        <span class="p">[</span><span class="nf">HttpDelete</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">DeleteProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Guid</span> <span class="n">rowVersion</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_productService</span><span class="p">.</span><span class="nf">DeleteProduct</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">rowVersion</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>



</code></pre></div></div>

<p><strong>Step 14: Run the application and test concurrency</strong></p>

<ul>
  <li>Create a new record by Post method in swagger. Sample example for post data.</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ASUS Laptop"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mi">1200</span><span class="p">,</span><span class="w">
  </span><span class="nl">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">230</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>Update the record using the Put method in Swagger. A sample input is provided below. Meanwhile, open another tab and make an update to the record. Your record version will be altered. If you attempt to update the record using the previous record version, it will not updated due to concurrency. However, if no one else has updated it and you are using the correct record version, you can update the record.</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ASUS Laptop"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mi">1300</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">230</span><span class="p">,</span><span class="w">
    </span><span class="nl">"rowVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"04e92587-8c5d-4a27-b5d5-bbee9fc84458"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>Delete the record using the Delete method in Swagger. Meanwhile, open another tab and update the record. Your record version will be changed. If you attempt to delete the record using the previous record version, it will throw an exception due to concurrency. However, if no one else has updated it and you are using the correct record version, you can delete the record without encountering any problem.</li>
</ul>

<p><strong><a href="https://github.com/mahedee/code-sample02/tree/master/ConcurrencyRawSQL">Source code</a></strong></p>

        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3654930341568980"
     crossorigin="anonymous"></script>
<!-- Horizontal Unit -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-3654930341568980"
     data-ad-slot="7189599032"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#aspnetcore" class="page__taxonomy-item" rel="tag">aspnetcore</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#aspnet" class="page__taxonomy-item" rel="tag">aspnet</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#csharp" class="page__taxonomy-item" rel="tag">csharp</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ef" class="page__taxonomy-item" rel="tag">ef</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#softwarearchitecture" class="page__taxonomy-item" rel="tag">softwarearchitecture</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#webapi" class="page__taxonomy-item" rel="tag">webapi</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#asp-net-core" class="page__taxonomy-item" rel="tag">ASP.NET Core</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#asp-net" class="page__taxonomy-item" rel="tag">ASP.NET</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#c" class="page__taxonomy-item" rel="tag">C#</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#ef" class="page__taxonomy-item" rel="tag">EF</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#software-architecture" class="page__taxonomy-item" rel="tag">Software Architecture</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#web-api" class="page__taxonomy-item" rel="tag">Web API</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2024-02-08T00:00:00-05:00">February 08, 2024</time></p>
        
      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Optimistic+Concurrency+Management+in+ASP.NET+Core+Application+Using+Raw+SQL+and+ADO.NET%20https%3A%2F%2Fmahedee.net%2F%2Foptimistic_concurrency_management_aspnet_core_using_raw_sql%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmahedee.net%2F%2Foptimistic_concurrency_management_aspnet_core_using_raw_sql%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fmahedee.net%2F%2Foptimistic_concurrency_management_aspnet_core_using_raw_sql%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/Step-by-Step-Guide-to-Integrating-Audit-Trail-in-ASPNET-Core-Using-ADONET/" class="pagination--pager" title="Step-by-Step Guide to Integrating Audit Trail in ASP.NET Core Using ADO.NET and Raw SQL
">Previous</a>
    
    
      <a href="/utilizing_bulk_operations_with_entity_framework_and_aspnet_core/" class="pagination--pager" title="Utilizing Bulk Operations with Entity Framework and ASP.NET Core
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/simplifying-e-commerce-order-processing-with-the-facade-design-pattern-in-csharp/" rel="permalink">Simplifying E-Commerce Order Processing with the Facade Design Pattern in C#
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Discover how the Facade Design Pattern simplifies e-commerce order processing by unifying complex subsystems into a single interface. This article provides a...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/facade_design_pattern_real_world_use_cases/" rel="permalink">Simplifying Complex Systems: 10 Real-World Use Cases of the Facade Design Pattern
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Simplify complex software systems with the Facade Design Pattern. Explore its key components and discover 10 real-world use cases where it streamlines operat...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/simplifying_complex_systems_with_the_facade_design_pattern_in_csharp/" rel="permalink">Simplifying Complex Systems with the Facade Design Pattern in C#
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Learn how to simplify complex systems with the Facade Design Pattern in C#. This article explores the key concepts behind the Facade pattern and demonstrates...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/real_time_vs_persistent_notifications_observer_pattern_or_databases/" rel="permalink">Real-Time vs Persistent Notifications: Choosing Between Observer Pattern and Databases
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Deciding between real-time notifications with the Observer pattern and persistent updates using databases can be challenging. This article breaks down their ...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>


      <ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3654930341568980"
     data-ad-slot="2244980843"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    <li><i class="fas fa-fw fa-award" aria-hidden="true"></i> <a href = "https://mvp.microsoft.com/en-us/PublicProfile/5001294">MVP Profile</a></li> 
    ||<li><i class="fas fa-fw fa-list-alt" aria-hidden="true"></i> <a href = "/categories/">Categories</a></li>
    ||<li><i class="fas fa-fw fa-code" aria-hidden="true"></i> <a href = "#">Programming</a></li>  
    ||<li><i class="fas fa-fw fa-globe" aria-hidden="true"></i> <a href = "/categories/#asp-net">ASP.NET</a></li> 
    ||<li><a href = "#">AI & ML</a></li>
    ||<li><a href = "#">Javascript</a></li>
    ||<li><a href = "#">Software Architecture</a></li>
    ||<li><a href = "#">Database</a></li>
    ||<li><a href = "#">OOP</a></li>
    ||<li><a href = "#">Design Pattern</a></li>  
    ||<li><a href = "#">Algorithm</a></li>
    ||<li><a href = "#">Interview Tips</a></li>
    ||<li><a href = "#">Opinions</a></li>
    ||<li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 Mahedee Hasan. 
  <!-- Powered by  -->
  <!-- <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>. -->
</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=1641495303280571";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
  





        <!-- Add sense code for all page : added globaly -->
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3654930341568980"
        crossorigin="anonymous"></script>

  </body>
</html>
