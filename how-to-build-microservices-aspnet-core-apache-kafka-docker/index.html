<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.6 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>How to Build a Sample Microservices Application Using ASP.NET Core, Apache Kafka, and Docker - Think Simple</title>
<meta name="description" content="This step-by-step tutorial demonstrates how to build a sample microservices application using ASP.NET Core, Apache Kafka, and Docker. You will learn how to design independent services, implement event-driven communication, integrate SQL Server with Entity Framework Core, and run everything in containers for local development.">


  <meta name="author" content="Mahedee Hasan">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Think Simple">
<meta property="og:title" content="How to Build a Sample Microservices Application Using ASP.NET Core, Apache Kafka, and Docker">
<meta property="og:url" content="https://mahedee.net/how-to-build-microservices-aspnet-core-apache-kafka-docker/">


  <meta property="og:description" content="This step-by-step tutorial demonstrates how to build a sample microservices application using ASP.NET Core, Apache Kafka, and Docker. You will learn how to design independent services, implement event-driven communication, integrate SQL Server with Entity Framework Core, and run everything in containers for local development.">



  <meta property="og:image" content="https://mahedee.net/assets/images/post_banner01.jpeg">





  <meta property="article:published_time" content="2026-01-26T00:00:00-05:00">





  

  


<link rel="canonical" href="https://mahedee.net/how-to-build-microservices-aspnet-core-apache-kafka-docker/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Mahedee Hasan",
      "url": "https://mahedee.net/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Think Simple Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



<!-- SEO tags -->
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>How to Build a Sample Microservices Application Using ASP.NET Core, Apache Kafka, and Docker | Think Simple</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="How to Build a Sample Microservices Application Using ASP.NET Core, Apache Kafka, and Docker" />
<meta name="author" content="Mahedee Hasan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This step-by-step tutorial demonstrates how to build a sample microservices application using ASP.NET Core, Apache Kafka, and Docker. You will learn how to design independent services, implement event-driven communication, integrate SQL Server with Entity Framework Core, and run everything in containers for local development." />
<meta property="og:description" content="This step-by-step tutorial demonstrates how to build a sample microservices application using ASP.NET Core, Apache Kafka, and Docker. You will learn how to design independent services, implement event-driven communication, integrate SQL Server with Entity Framework Core, and run everything in containers for local development." />
<link rel="canonical" href="https://mahedee.net/how-to-build-microservices-aspnet-core-apache-kafka-docker/" />
<meta property="og:url" content="https://mahedee.net/how-to-build-microservices-aspnet-core-apache-kafka-docker/" />
<meta property="og:site_name" content="Think Simple" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2026-01-26T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How to Build a Sample Microservices Application Using ASP.NET Core, Apache Kafka, and Docker" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@Mahedee Hasan" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Mahedee Hasan"},"dateModified":"2026-01-26T00:00:00-05:00","datePublished":"2026-01-26T00:00:00-05:00","description":"This step-by-step tutorial demonstrates how to build a sample microservices application using ASP.NET Core, Apache Kafka, and Docker. You will learn how to design independent services, implement event-driven communication, integrate SQL Server with Entity Framework Core, and run everything in containers for local development.","headline":"How to Build a Sample Microservices Application Using ASP.NET Core, Apache Kafka, and Docker","mainEntityOfPage":{"@type":"WebPage","@id":"https://mahedee.net/how-to-build-microservices-aspnet-core-apache-kafka-docker/"},"url":"https://mahedee.net/how-to-build-microservices-aspnet-core-apache-kafka-docker/"}</script>
<!-- End Jekyll SEO tag -->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->



     
  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Think Simple
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/categories" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/me.jpg" alt="Mahedee Hasan" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Mahedee Hasan</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>I am a Microsoft MVP (11th times), programmer, software developer, software architect, consultant, author, researcher, technical blogger, technical speaker, trainer and learner. I have more than 17 years experience in the field of software design and development.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Toronto, Ontario, Canada</span>
        </li>
      

      
        
          
            <li><a href="mailto:mahedee.hasan@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
          
        
          
            <li><a href="https://mahedee.net" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
          
        
          
            <li><a href="https://mvp.microsoft.com/en-us/PublicProfile/5001294" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-award" aria-hidden="true"></i> MVP</a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/mahedee/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://twitter.com/mahedeehasan" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
            <li><a href="https://facebook.com/mahedee19" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
          
        
          
            <li><a href="https://github.com/mahedee" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
            <li><a href="https://www.buymeacoffee.com/mahedee" rel="nofollow noopener noreferrer"><i class="fab fa fa-coffee" aria-hidden="true"></i> Buy me a Coffee</a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="How to Build a Sample Microservices Application Using ASP.NET Core, Apache Kafka, and Docker">
    <meta itemprop="description" content="This step-by-step tutorial demonstrates how to build a sample microservices application using ASP.NET Core, Apache Kafka, and Docker. You will learn how to design independent services, implement event-driven communication, integrate SQL Server with Entity Framework Core, and run everything in containers for local development.">
    <meta itemprop="datePublished" content="January 26, 2026">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">How to Build a Sample Microservices Application Using ASP.NET Core, Apache Kafka, and Docker
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  24 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Microservices architecture has become increasingly popular for building scalable, maintainable applications. In this comprehensive tutorial, we’ll build a sample e-commerce application with two microservices using ASP.NET Core, Apache Kafka for event-driven communication, and Docker for containerization.</p>

<h2 id="what-well-build">What We’ll Build</h2>

<p>We’ll create a simple e-commerce system with two microservices:</p>
<ul>
  <li><strong>Product Service</strong>: Manages product catalog</li>
  <li><strong>Order Service</strong>: Handles order processing</li>
</ul>

<p>These services will communicate through Apache Kafka events, each having its own SQL Server database. When a product is created, the Product Service will publish a <code class="language-plaintext highlighter-rouge">ProductCreated</code> event. The Order Service will subscribe to this event to update its local cache or perform other actions. On the other hand, when an order is created, the Order Service will publish an <code class="language-plaintext highlighter-rouge">OrderCreated</code> event and the Product Service can listen to it for inventory updates.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>Before we start, make sure you have:</p>
<ul>
  <li>.NET 10 SDK</li>
  <li>Docker Desktop</li>
  <li>Visual Studio 2026 or Visual Studio Code</li>
  <li>Basic knowledge of ASP.NET Core, Docker, and microservices concepts</li>
</ul>

<h2 id="project-structure">Project Structure</h2>

<p>Let’s start by creating our solution structure:</p>

<p><img src="/assets/images/posts/2026/solution_structure.png" alt="" /></p>

<h2 id="step-1-create-the-solution-and-projects">Step 1: Create the Solution and Projects</h2>

<p>Open a terminal and create the solution structure:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>MicroservicesDemo
<span class="nb">cd </span>MicroservicesDemo

<span class="c"># Create solution file</span>
dotnet new sln

<span class="c"># Create directories</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> src/Services/ProductService
<span class="nb">mkdir</span> <span class="nt">-p</span> src/Services/OrderService
<span class="nb">mkdir</span> <span class="nt">-p</span> src/Shared/EventBus

<span class="c"># Create projects</span>
<span class="nb">cd </span>src/Services/ProductService
dotnet new webapi <span class="nt">-n</span> ProductService

<span class="nb">cd</span> ../OrderService
dotnet new webapi <span class="nt">-n</span> OrderService

<span class="nb">cd</span> ../../Shared/EventBus
dotnet new classlib <span class="nt">-n</span> EventBus

<span class="c"># Add projects to solution</span>
<span class="nb">cd</span> ../../../
dotnet sln add .<span class="se">\s</span>rc<span class="se">\S</span>ervices<span class="se">\P</span>roductService<span class="se">\P</span>roductService<span class="se">\P</span>roductService.csproj
  
dotnet sln add .<span class="se">\s</span>rc<span class="se">\S</span>ervices<span class="se">\O</span>rderService<span class="se">\O</span>rderService<span class="se">\O</span>rderService.csproj
dotnet sln add .<span class="se">\s</span>rc<span class="se">\S</span>hared<span class="se">\E</span>ventBus<span class="se">\E</span>ventBus<span class="se">\E</span>ventBus.csproj
</code></pre></div></div>

<h2 id="step-2-create-shared-event-bus-library">Step 2: Create Shared Event Bus Library</h2>

<p>First, let’s create our shared event bus library for Kafka integration. The purpose of this library is to provide a common interface and implementation for publishing and subscribing to events using Apache Kafka.</p>

<h3 id="create-event-bus-interface">Create Event Bus Interface</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">IEventBus</code> interface in the <code class="language-plaintext highlighter-rouge">EventBus</code> project. The interface will define methods for publishing and subscribing to events. 
<strong>EventBus/IEventBus.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">EventBus</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">interface</span> <span class="nc">IEventBus</span>
    <span class="p">{</span>
        <span class="n">Task</span> <span class="n">PublishAsync</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">T</span> <span class="n">@event</span><span class="p">)</span> <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="k">class</span><span class="err">;</span>
        <span class="nc">Task</span> <span class="n">SubscribeAsync</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Task</span><span class="p">&gt;</span> <span class="n">handler</span><span class="p">)</span> <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="k">class</span><span class="err">;</span>
    <span class="err">}</span>
<span class="err">}</span>
</code></pre></div></div>

<h3 id="create-base-event-class">Create Base Event Class</h3>
<p>Create a base event class name <code class="language-plaintext highlighter-rouge">BaseEvent</code> that other events will inherit from. This abstract class has properties for event ID and creation timestamp which are common to all events.</p>

<p><strong>EventBus/Events/BaseEvent.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">EventBus.Events</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">BaseEvent</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">Guid</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">protected</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DateTime</span> <span class="n">CreatedAt</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">protected</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="nf">BaseEvent</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Id</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">();</span>
            <span class="n">CreatedAt</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="create-productcreatedevent">Create ProductCreatedEvent</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">ProductCreatedEvent</code> class that represents the event published when a new product is created.</p>

<p><strong>EventBus/Events/ProductCreatedEvent.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nn">EventBus.Events</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductCreatedEvent</span> <span class="p">:</span> <span class="n">BaseEvent</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">ProductId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Stock</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="create-ordercreatedevent">Create OrderCreatedEvent</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">OrderCreatedEvent</code> class that represents the event published when a new order is created.</p>

<p><strong>EventBus/Events/OrderCreatedEvent.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nn">EventBus.Events</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">OrderCreatedEvent</span> <span class="p">:</span> <span class="n">BaseEvent</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">OrderId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">ProductId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Quantity</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">TotalPrice</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">CustomerEmail</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="create-productupdatedevent">Create ProductUpdatedEvent</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">ProductUpdatedEvent</code> class that represents the event published when a product is updated.</p>

<p><strong>EventBus/Events/ProductUpdatedEvent.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nn">EventBus.Events</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductUpdatedEvent</span> <span class="p">:</span> <span class="n">BaseEvent</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">ProductId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Description</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Stock</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">PreviousPrice</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PreviousStock</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h3 id="create-kafkaeventbus-implementation">Create KafkaEventBus Implementation</h3>
<p>Now, let’s implement the <code class="language-plaintext highlighter-rouge">KafkaEventBus</code> class that uses Confluent.Kafka to publish and subscribe to events. In this implementation, we will handle event serialization/deserialization, topic management, and error handling. KafkaEventBus implements the IEventBus interface using Apache Kafka as the underlying message broker, featuring core properties like _producer for publishing events, _consumer for receiving messages, _handlers dictionary to store event type-specific callback functions, and _subscribedTopics list to track active subscriptions. The PublishAsync<T> method serializes events to JSON and sends them to dynamically named Kafka topics (e.g., "microservices.ProductCreatedEvent"), while SubscribeAsync<T> registers event handlers and manages topic subscriptions, automatically starting a background consumer task via StartConsumerAsync() that continuously polls Kafka topics for incoming messages. This architecture enables loose coupling between microservices by allowing them to communicate asynchronously through events rather than direct API calls - for instance, when ProductService creates a product, it publishes a ProductCreatedEvent that OrderService automatically receives and processes to update its local product cache, ensuring real-time data synchronization across the distributed system without services needing to know about each other's existence or endpoints.</T></T></p>

<h3 id="eventbuskafkaeventbuscs">EventBus/KafkaEventBus.cs</h3>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Confluent.Kafka</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text.Json</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Extensions.Logging</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.Extensions.Configuration</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">EventBus</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">KafkaEventBus</span> <span class="p">:</span> <span class="n">IEventBus</span><span class="p">,</span> <span class="n">IDisposable</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IProducer</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">_producer</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IConsumer</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">_consumer</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">KafkaEventBus</span><span class="p">&gt;</span> <span class="n">_logger</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">_topicPrefix</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Func</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Task</span><span class="p">&gt;&gt;</span> <span class="n">_handlers</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">_subscribedTopics</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
        <span class="k">private</span> <span class="kt">bool</span> <span class="n">_isConsuming</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">KafkaEventBus</span><span class="p">(</span><span class="n">IConfiguration</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">KafkaEventBus</span><span class="p">&gt;</span> <span class="n">logger</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_logger</span> <span class="p">=</span> <span class="n">logger</span><span class="p">;</span>
            <span class="n">_topicPrefix</span> <span class="p">=</span> <span class="n">configuration</span><span class="p">[</span><span class="s">"Kafka:TopicPrefix"</span><span class="p">]</span> <span class="p">??</span> <span class="s">"microservices"</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">producerConfig</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProducerConfig</span>
            <span class="p">{</span>
                <span class="n">BootstrapServers</span> <span class="p">=</span> <span class="n">configuration</span><span class="p">[</span><span class="s">"Kafka:BootstrapServers"</span><span class="p">]</span>
            <span class="p">};</span>

            <span class="kt">var</span> <span class="n">consumerConfig</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConsumerConfig</span>
            <span class="p">{</span>
                <span class="n">BootstrapServers</span> <span class="p">=</span> <span class="n">configuration</span><span class="p">[</span><span class="s">"Kafka:BootstrapServers"</span><span class="p">],</span>
                <span class="n">GroupId</span> <span class="p">=</span> <span class="n">configuration</span><span class="p">[</span><span class="s">"Kafka:GroupId"</span><span class="p">],</span>
                <span class="n">AutoOffsetReset</span> <span class="p">=</span> <span class="n">AutoOffsetReset</span><span class="p">.</span><span class="n">Earliest</span>
            <span class="p">};</span>

            <span class="n">_producer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProducerBuilder</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span><span class="n">producerConfig</span><span class="p">).</span><span class="nf">Build</span><span class="p">();</span>
            <span class="n">_consumer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ConsumerBuilder</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span><span class="n">consumerConfig</span><span class="p">).</span><span class="nf">Build</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="n">PublishAsync</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">T</span> <span class="n">@event</span><span class="p">)</span> <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="k">class</span>
        <span class="err">{</span>
            <span class="nc">var</span> <span class="n">topic</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="n">_topicPrefix</span><span class="p">}</span><span class="s">.</span><span class="p">{</span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">).</span><span class="n">Name</span><span class="p">}</span><span class="s">"</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">message</span> <span class="p">=</span> <span class="n">JsonSerializer</span><span class="p">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="n">@event</span><span class="p">);</span>

            <span class="k">try</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_producer</span><span class="p">.</span><span class="nf">ProduceAsync</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="k">new</span> <span class="n">Message</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span>
                <span class="p">{</span>
                    <span class="n">Key</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">().</span><span class="nf">ToString</span><span class="p">(),</span>
                    <span class="n">Value</span> <span class="p">=</span> <span class="n">message</span>
                <span class="p">});</span>

                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Event published to topic </span><span class="p">{</span><span class="n">topic</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">result</span><span class="p">.</span><span class="n">Status</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">$"Failed to publish event to topic </span><span class="p">{</span><span class="n">topic</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="k">throw</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="n">SubscribeAsync</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Task</span><span class="p">&gt;</span> <span class="n">handler</span><span class="p">)</span> <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="k">class</span>
        <span class="err">{</span>
            <span class="nc">var</span> <span class="n">topic</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="n">_topicPrefix</span><span class="p">}</span><span class="s">.</span><span class="p">{</span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">).</span><span class="n">Name</span><span class="p">}</span><span class="s">"</span><span class="p">;</span>
            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Subscribing to topic: </span><span class="p">{</span><span class="n">topic</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="c1">// Store the handler for this topic</span>
                <span class="n">_handlers</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="p">=</span> <span class="k">async</span> <span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="p">=&gt;</span>
                <span class="p">{</span>
                    <span class="kt">var</span> <span class="n">@event</span> <span class="p">=</span> <span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Deserialize</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">message</span><span class="p">);</span>
                    <span class="k">await</span> <span class="nf">handler</span><span class="p">(</span><span class="n">@event</span><span class="p">);</span>
                <span class="p">};</span>

                <span class="n">_subscribedTopics</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Added topic </span><span class="p">{</span><span class="n">topic</span><span class="p">}</span><span class="s"> to subscription list"</span><span class="p">);</span>

                <span class="c1">// Start the consumer if not already started</span>
                <span class="k">if</span> <span class="p">(!</span><span class="n">_isConsuming</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">await</span> <span class="nf">StartConsumerAsync</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="c1">// Re-subscribe to all topics</span>
                    <span class="n">_consumer</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">_subscribedTopics</span><span class="p">);</span>
                    <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Re-subscribed to all topics: </span><span class="p">{</span><span class="kt">string</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="s">", "</span><span class="p">,</span> <span class="n">_subscribedTopics</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Successfully subscribed to topic: </span><span class="p">{</span><span class="n">topic</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">$"Failed to subscribe to topic: </span><span class="p">{</span><span class="n">topic</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="k">throw</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">StartConsumerAsync</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_isConsuming</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">_consumer</span><span class="p">.</span><span class="nf">Subscribe</span><span class="p">(</span><span class="n">_subscribedTopics</span><span class="p">);</span>
            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Subscribed to topics: </span><span class="p">{</span><span class="kt">string</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="s">", "</span><span class="p">,</span> <span class="n">_subscribedTopics</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>

            <span class="n">_</span> <span class="p">=</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Starting consumer task for topics: </span><span class="p">{</span><span class="kt">string</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="s">", "</span><span class="p">,</span> <span class="n">_subscribedTopics</span><span class="p">)}</span><span class="s">"</span><span class="p">);</span>
                <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">try</span>
                    <span class="p">{</span>
                        <span class="n">_logger</span><span class="p">.</span><span class="nf">LogDebug</span><span class="p">(</span><span class="s">$"Polling for messages on topics: </span><span class="p">{</span><span class="kt">string</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="s">", "</span><span class="p">,</span> <span class="n">_subscribedTopics</span><span class="p">)}</span><span class="s">..."</span><span class="p">);</span>
                        <span class="kt">var</span> <span class="n">consumeResult</span> <span class="p">=</span> <span class="n">_consumer</span><span class="p">.</span><span class="nf">Consume</span><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMilliseconds</span><span class="p">(</span><span class="m">1000</span><span class="p">));</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">consumeResult</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="kt">var</span> <span class="n">topic</span> <span class="p">=</span> <span class="n">consumeResult</span><span class="p">.</span><span class="n">Topic</span><span class="p">;</span>
                            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Received message from topic </span><span class="p">{</span><span class="n">topic</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">consumeResult</span><span class="p">.</span><span class="n">Message</span><span class="p">.</span><span class="n">Value</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                            
                            <span class="k">if</span> <span class="p">(</span><span class="n">_handlers</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">handler</span><span class="p">))</span>
                            <span class="p">{</span>
                                <span class="k">await</span> <span class="nf">handler</span><span class="p">(</span><span class="n">consumeResult</span><span class="p">.</span><span class="n">Message</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
                                <span class="n">_consumer</span><span class="p">.</span><span class="nf">Commit</span><span class="p">(</span><span class="n">consumeResult</span><span class="p">);</span>
                                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Successfully processed message from topic </span><span class="p">{</span><span class="n">topic</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                            <span class="p">}</span>
                            <span class="k">else</span>
                            <span class="p">{</span>
                                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">$"No handler found for topic </span><span class="p">{</span><span class="n">topic</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="k">else</span>
                        <span class="p">{</span>
                            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogDebug</span><span class="p">(</span><span class="s">$"No message received from any topic, continuing polling..."</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">_logger</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">$"Error consuming message from topics"</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">_producer</span><span class="p">?.</span><span class="nf">Dispose</span><span class="p">();</span>
            <span class="n">_consumer</span><span class="p">?.</span><span class="nf">Dispose</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="update-eventbuscsproj">Update EventBus.csproj</h3>

<p>Finally, update the <code class="language-plaintext highlighter-rouge">EventBus.csproj</code> file to include the necessary NuGet packages for Kafka integration and logging.</p>

<p><strong>EventBus/EventBus.csproj</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>net8.0<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;ImplicitUsings&gt;</span>enable<span class="nt">&lt;/ImplicitUsings&gt;</span>
    <span class="nt">&lt;Nullable&gt;</span>enable<span class="nt">&lt;/Nullable&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Confluent.Kafka"</span> <span class="na">Version=</span><span class="s">"2.3.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Microsoft.Extensions.Configuration.Abstractions"</span> <span class="na">Version=</span><span class="s">"8.0.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Microsoft.Extensions.Logging.Abstractions"</span> <span class="na">Version=</span><span class="s">"8.0.0"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

<span class="nt">&lt;/Project&gt;</span>

</code></pre></div></div>

<h2 id="step-3-build-product-service">Step 3: Build Product Service</h2>

<h3 id="create-product-model">Create Product Model</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">Product</code> model class that represents the product entity in the Product Service.</p>

<p><strong>ProductService/Models/Product.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System.ComponentModel.DataAnnotations</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ProductService.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Product</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">StringLength</span><span class="p">(</span><span class="m">100</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        
        <span class="p">[</span><span class="nf">StringLength</span><span class="p">(</span><span class="m">500</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Description</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0.01</span><span class="p">,</span> <span class="kt">double</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="kt">int</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Stock</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        
        <span class="k">public</span> <span class="n">DateTime</span> <span class="n">CreatedAt</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="create-productcontext">Create ProductContext</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">ProductContext</code> class that represents the Entity Framework Core database context for the Product Service.</p>

<p><strong>ProductService/Data/ProductContext.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ProductService.Models</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ProductService.Data</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">ProductContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="p">&lt;</span><span class="n">ProductContext</span><span class="p">&gt;</span> <span class="n">options</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;</span> <span class="n">Products</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;(</span><span class="n">entity</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">HasKey</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">Property</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Name</span><span class="p">).</span><span class="nf">IsRequired</span><span class="p">().</span><span class="nf">HasMaxLength</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">Property</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Description</span><span class="p">).</span><span class="nf">HasMaxLength</span><span class="p">(</span><span class="m">500</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">Property</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Price</span><span class="p">).</span><span class="nf">HasColumnType</span><span class="p">(</span><span class="s">"decimal(18,2)"</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">HasIndex</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="create-ordereventhandler">Create OrderEventHandler</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">OrderEventHandler</code> class that will handle events from the Order Service. OrderEventHandler is called automatically when an order is placed in the OrderService through the event-driven architecture. It is configured in Program.cs file.</p>

<p><strong>ProductService/Services/OrderEventHandler.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">EventBus.Events</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ProductService.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EventBus</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ProductService.Services</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">OrderEventHandler</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">OrderEventHandler</span><span class="p">&gt;</span> <span class="n">_logger</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IServiceScopeFactory</span> <span class="n">_scopeFactory</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">OrderEventHandler</span><span class="p">(</span><span class="n">ILogger</span><span class="p">&lt;</span><span class="n">OrderEventHandler</span><span class="p">&gt;</span> <span class="n">logger</span><span class="p">,</span> <span class="n">IServiceScopeFactory</span> <span class="n">scopeFactory</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_logger</span> <span class="p">=</span> <span class="n">logger</span><span class="p">;</span>
            <span class="n">_scopeFactory</span> <span class="p">=</span> <span class="n">scopeFactory</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">OrderCreatedEvent</span> <span class="n">@event</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Order created event received: Order </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">OrderId</span><span class="p">}</span><span class="s">, Product </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">}</span><span class="s">, Quantity </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">Quantity</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            
            <span class="k">using</span> <span class="nn">var</span> <span class="n">scope</span> <span class="p">=</span> <span class="n">_scopeFactory</span><span class="p">.</span><span class="nf">CreateScope</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">ProductContext</span><span class="p">&gt;();</span>
            <span class="kt">var</span> <span class="n">eventBus</span> <span class="p">=</span> <span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">IEventBus</span><span class="p">&gt;();</span>
            
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="c1">// Find the product</span>
                <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Products</span><span class="p">.</span><span class="nf">FindAsync</span><span class="p">(</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">product</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// Update product stock (reduce by order quantity)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">Stock</span> <span class="p">&gt;=</span> <span class="n">@event</span><span class="p">.</span><span class="n">Quantity</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="kt">var</span> <span class="n">originalStock</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Stock</span><span class="p">;</span>
                        <span class="n">product</span><span class="p">.</span><span class="n">Stock</span> <span class="p">-=</span> <span class="n">@event</span><span class="p">.</span><span class="n">Quantity</span><span class="p">;</span>
                        <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>
                        
                        <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Product </span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">}</span><span class="s"> stock updated. Stock: </span><span class="p">{</span><span class="n">originalStock</span><span class="p">}</span><span class="s"> → </span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Stock</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                        
                        <span class="c1">// Publish ProductUpdatedEvent to notify other services about stock change</span>
                        <span class="kt">var</span> <span class="n">productUpdatedEvent</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProductUpdatedEvent</span>
                        <span class="p">{</span>
                            <span class="n">ProductId</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
                            <span class="n">Name</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
                            <span class="n">Description</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Description</span><span class="p">,</span>
                            <span class="n">Price</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span>
                            <span class="n">Stock</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Stock</span><span class="p">,</span>
                            <span class="n">PreviousStock</span> <span class="p">=</span> <span class="n">originalStock</span><span class="p">,</span>
                            <span class="n">PreviousPrice</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Price</span>  <span class="c1">// Price didn't change</span>
                        <span class="p">};</span>

                        <span class="k">await</span> <span class="n">eventBus</span><span class="p">.</span><span class="nf">PublishAsync</span><span class="p">(</span><span class="n">productUpdatedEvent</span><span class="p">);</span>
                        <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"ProductUpdatedEvent published for Product </span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">}</span><span class="s"> due to order </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">OrderId</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                        
                        <span class="c1">// Check if stock is low</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">Stock</span> <span class="p">&lt;=</span> <span class="m">10</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">$"LOW STOCK ALERT: Product </span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="s"> (ID: </span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">}</span><span class="s">) has only </span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Stock</span><span class="p">}</span><span class="s"> units remaining!"</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">else</span>
                    <span class="p">{</span>
                        <span class="n">_logger</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">$"Insufficient stock for Product </span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">}</span><span class="s">. Available: </span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Stock</span><span class="p">}</span><span class="s">, Requested: </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">Quantity</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">_logger</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">$"Product with ID </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">}</span><span class="s"> not found when processing order </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">OrderId</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">$"Error processing order created event for Order </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">OrderId</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="create-productscontroller">Create ProductsController</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">ProductsController</code> class that exposes RESTful APIs for managing products in the Product Service.</p>

<p><strong>ProductService/Controllers/ProductsController.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Mvc</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ProductService.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ProductService.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EventBus</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EventBus.Events</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ProductService.Controllers</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">ApiController</span><span class="p">]</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"api/[controller]"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductsController</span> <span class="p">:</span> <span class="n">ControllerBase</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ProductContext</span> <span class="n">_context</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IEventBus</span> <span class="n">_eventBus</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">ProductsController</span><span class="p">&gt;</span> <span class="n">_logger</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">ProductsController</span><span class="p">(</span><span class="n">ProductContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEventBus</span> <span class="n">eventBus</span><span class="p">,</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">ProductsController</span><span class="p">&gt;</span> <span class="n">logger</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_context</span> <span class="p">=</span> <span class="n">context</span><span class="p">;</span>
            <span class="n">_eventBus</span> <span class="p">=</span> <span class="n">eventBus</span><span class="p">;</span>
            <span class="n">_logger</span> <span class="p">=</span> <span class="n">logger</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;&gt;</span> <span class="nf">GetProducts</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Products</span><span class="p">.</span><span class="nf">ToListAsync</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">GetProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Products</span><span class="p">.</span><span class="nf">FindAsync</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">product</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">product</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">HttpPost</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;&gt;</span> <span class="nf">CreateProduct</span><span class="p">(</span><span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_context</span><span class="p">.</span><span class="n">Products</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>

            <span class="c1">// Publish event</span>
            <span class="kt">var</span> <span class="n">productCreatedEvent</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProductCreatedEvent</span>
            <span class="p">{</span>
                <span class="n">ProductId</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
                <span class="n">Name</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
                <span class="n">Price</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span>
                <span class="n">Stock</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Stock</span>
            <span class="p">};</span>

            <span class="k">await</span> <span class="n">_eventBus</span><span class="p">.</span><span class="nf">PublishAsync</span><span class="p">(</span><span class="n">productCreatedEvent</span><span class="p">);</span>
            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Product created and event published: </span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

            <span class="k">return</span> <span class="nf">CreatedAtAction</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">GetProduct</span><span class="p">),</span> <span class="k">new</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Id</span> <span class="p">},</span> <span class="n">product</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpPut</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">UpdateProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">Product</span> <span class="n">product</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="p">!=</span> <span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span>
                <span class="k">return</span> <span class="nf">BadRequest</span><span class="p">();</span>

            <span class="c1">// Get the original product to track changes</span>
            <span class="kt">var</span> <span class="n">originalProduct</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Products</span><span class="p">.</span><span class="nf">AsNoTracking</span><span class="p">().</span><span class="nf">FirstOrDefaultAsync</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">originalProduct</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>

            <span class="n">_context</span><span class="p">.</span><span class="nf">Entry</span><span class="p">(</span><span class="n">product</span><span class="p">).</span><span class="n">State</span> <span class="p">=</span> <span class="n">EntityState</span><span class="p">.</span><span class="n">Modified</span><span class="p">;</span>

            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>
                
                <span class="c1">// Publish product updated event</span>
                <span class="kt">var</span> <span class="n">productUpdatedEvent</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProductUpdatedEvent</span>
                <span class="p">{</span>
                    <span class="n">ProductId</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
                    <span class="n">Name</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
                    <span class="n">Description</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Description</span><span class="p">,</span>
                    <span class="n">Price</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span>
                    <span class="n">Stock</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Stock</span><span class="p">,</span>
                    <span class="n">PreviousPrice</span> <span class="p">=</span> <span class="n">originalProduct</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span>
                    <span class="n">PreviousStock</span> <span class="p">=</span> <span class="n">originalProduct</span><span class="p">.</span><span class="n">Stock</span>
                <span class="p">};</span>

                <span class="k">await</span> <span class="n">_eventBus</span><span class="p">.</span><span class="nf">PublishAsync</span><span class="p">(</span><span class="n">productUpdatedEvent</span><span class="p">);</span>
                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Product updated and event published: </span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="s">. Price: $</span><span class="p">{</span><span class="n">originalProduct</span><span class="p">.</span><span class="n">Price</span><span class="p">}</span><span class="s"> → $</span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Price</span><span class="p">}</span><span class="s">, Stock: </span><span class="p">{</span><span class="n">originalProduct</span><span class="p">.</span><span class="n">Stock</span><span class="p">}</span><span class="s"> → </span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Stock</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">DbUpdateConcurrencyException</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(!</span><span class="nf">ProductExists</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
                    <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>
                <span class="k">throw</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nf">NoContent</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpDelete</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">DeleteProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Products</span><span class="p">.</span><span class="nf">FindAsync</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">product</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>

            <span class="n">_context</span><span class="p">.</span><span class="n">Products</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>

            <span class="k">return</span> <span class="nf">NoContent</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"low-stock"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;&gt;&gt;</span> <span class="nf">GetLowStockProducts</span><span class="p">([</span><span class="n">FromQuery</span><span class="p">]</span> <span class="kt">int</span> <span class="n">threshold</span> <span class="p">=</span> <span class="m">10</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">lowStockProducts</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Products</span>
                <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Stock</span> <span class="p">&lt;=</span> <span class="n">threshold</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="k">new</span> 
                <span class="p">{</span>
                    <span class="n">p</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
                    <span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
                    <span class="n">p</span><span class="p">.</span><span class="n">Stock</span><span class="p">,</span>
                    <span class="n">p</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span>
                    <span class="n">Status</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">Stock</span> <span class="p">==</span> <span class="m">0</span> <span class="p">?</span> <span class="s">"Out of Stock"</span> <span class="p">:</span> <span class="s">"Low Stock"</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="nf">ToListAsync</span><span class="p">();</span>

            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">lowStockProducts</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpPut</span><span class="p">(</span><span class="s">"{id}/stock"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">UpdateStock</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="p">[</span><span class="n">FromBody</span><span class="p">]</span> <span class="n">UpdateStockRequest</span> <span class="n">request</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">product</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Products</span><span class="p">.</span><span class="nf">FindAsync</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">product</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>

            <span class="kt">var</span> <span class="n">originalStock</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Stock</span><span class="p">;</span>
            <span class="n">product</span><span class="p">.</span><span class="n">Stock</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">NewStock</span><span class="p">;</span>
            <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>

            <span class="c1">// Publish ProductUpdatedEvent for stock changes</span>
            <span class="kt">var</span> <span class="n">productUpdatedEvent</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProductUpdatedEvent</span>
            <span class="p">{</span>
                <span class="n">ProductId</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
                <span class="n">Name</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
                <span class="n">Description</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Description</span><span class="p">,</span>
                <span class="n">Price</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span>
                <span class="n">Stock</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Stock</span><span class="p">,</span>
                <span class="n">PreviousStock</span> <span class="p">=</span> <span class="n">originalStock</span><span class="p">,</span>
                <span class="n">PreviousPrice</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">Price</span>  <span class="c1">// Price didn't change, so previous = current</span>
            <span class="p">};</span>

            <span class="k">await</span> <span class="n">_eventBus</span><span class="p">.</span><span class="nf">PublishAsync</span><span class="p">(</span><span class="n">productUpdatedEvent</span><span class="p">);</span>
            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Stock updated for product </span><span class="p">{</span><span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">originalStock</span><span class="p">}</span><span class="s"> → </span><span class="p">{</span><span class="n">request</span><span class="p">.</span><span class="n">NewStock</span><span class="p">}</span><span class="s"> and event published"</span><span class="p">);</span>
            
            <span class="k">return</span> <span class="nf">NoContent</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="kt">bool</span> <span class="nf">ProductExists</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_context</span><span class="p">.</span><span class="n">Products</span><span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">record</span> <span class="nc">UpdateStockRequest</span><span class="p">(</span><span class="kt">int</span> <span class="n">NewStock</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="modify-programcs">Modify Program.cs</h3>
<p>Modify the <code class="language-plaintext highlighter-rouge">Program.cs</code> as follows to set up the services, database context, and event subscriptions.</p>

<p><strong>ProductService/Program.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ProductService.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">ProductService.Services</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EventBus</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EventBus.Events</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="c1">// Add services to the container</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddEndpointsApiExplorer</span><span class="p">();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddSwaggerGen</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">c</span><span class="p">.</span><span class="nf">SwaggerDoc</span><span class="p">(</span><span class="s">"v1"</span><span class="p">,</span> <span class="k">new</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">OpenApi</span><span class="p">.</span><span class="n">Models</span><span class="p">.</span><span class="n">OpenApiInfo</span>
    <span class="p">{</span>
        <span class="n">Title</span> <span class="p">=</span> <span class="s">"Product Service API"</span><span class="p">,</span>
        <span class="n">Version</span> <span class="p">=</span> <span class="s">"v1"</span><span class="p">,</span>
        <span class="n">Description</span> <span class="p">=</span> <span class="s">"API for managing products in the microservices demo"</span><span class="p">,</span>
        <span class="n">Contact</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">OpenApi</span><span class="p">.</span><span class="n">Models</span><span class="p">.</span><span class="n">OpenApiContact</span>
        <span class="p">{</span>
            <span class="n">Name</span> <span class="p">=</span> <span class="s">"Product Service Team"</span><span class="p">,</span>
            <span class="n">Email</span> <span class="p">=</span> <span class="s">"products@microservicesdemo.com"</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Add Entity Framework</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">ProductContext</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
    <span class="n">options</span><span class="p">.</span><span class="nf">UseSqlServer</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"DefaultConnection"</span><span class="p">)));</span>

<span class="c1">// Add EventBus</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">IEventBus</span><span class="p">,</span> <span class="n">KafkaEventBus</span><span class="p">&gt;();</span>

<span class="c1">// Add Event Handlers</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">OrderEventHandler</span><span class="p">&gt;();</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

<span class="c1">// Configure the HTTP request pipeline</span>
<span class="k">if</span> <span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">Environment</span><span class="p">.</span><span class="nf">IsDevelopment</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseSwagger</span><span class="p">();</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseSwaggerUI</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">c</span><span class="p">.</span><span class="nf">SwaggerEndpoint</span><span class="p">(</span><span class="s">"/swagger/v1/swagger.json"</span><span class="p">,</span> <span class="s">"Product Service API v1"</span><span class="p">);</span>
        <span class="n">c</span><span class="p">.</span><span class="n">RoutePrefix</span> <span class="p">=</span> <span class="s">"swagger"</span><span class="p">;</span>
        <span class="n">c</span><span class="p">.</span><span class="n">DocumentTitle</span> <span class="p">=</span> <span class="s">"Product Service API Documentation"</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseAuthorization</span><span class="p">();</span>
<span class="n">app</span><span class="p">.</span><span class="nf">MapControllers</span><span class="p">();</span>

<span class="c1">// Ensure database is created with retry logic</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">scope</span> <span class="p">=</span> <span class="n">app</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">CreateScope</span><span class="p">())</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">ProductContext</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">logger</span> <span class="p">=</span> <span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">ILogger</span><span class="p">&lt;</span><span class="n">Program</span><span class="p">&gt;&gt;();</span>
    
    <span class="kt">var</span> <span class="n">retryCount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">maxRetries</span> <span class="p">=</span> <span class="m">30</span><span class="p">;</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">retryCount</span> <span class="p">&lt;</span> <span class="n">maxRetries</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"Attempting to connect to database, attempt {Attempt}"</span><span class="p">,</span> <span class="n">retryCount</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
            <span class="n">context</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="nf">EnsureCreated</span><span class="p">();</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"Database connection successful!"</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">retryCount</span><span class="p">++;</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">"Database connection failed (attempt {Attempt}/{MaxAttempts}): {Error}"</span><span class="p">,</span> <span class="n">retryCount</span><span class="p">,</span> <span class="n">maxRetries</span><span class="p">,</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">retryCount</span> <span class="p">&gt;=</span> <span class="n">maxRetries</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="s">"Failed to connect to database after {MaxAttempts} attempts. Exiting."</span><span class="p">,</span> <span class="n">maxRetries</span><span class="p">);</span>
                <span class="k">throw</span><span class="p">;</span>
            <span class="p">}</span>
            
            <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">2000</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Subscribe to events</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">scope</span> <span class="p">=</span> <span class="n">app</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">CreateScope</span><span class="p">())</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">eventBus</span> <span class="p">=</span> <span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">IEventBus</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">orderEventHandler</span> <span class="p">=</span> <span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">OrderEventHandler</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">logger</span> <span class="p">=</span> <span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">ILogger</span><span class="p">&lt;</span><span class="n">Program</span><span class="p">&gt;&gt;();</span>
    
    <span class="n">logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"Subscribing to OrderCreatedEvent..."</span><span class="p">);</span>
    <span class="k">await</span> <span class="n">eventBus</span><span class="p">.</span><span class="n">SubscribeAsync</span><span class="p">&lt;</span><span class="n">OrderCreatedEvent</span><span class="p">&gt;(</span><span class="n">orderEventHandler</span><span class="p">.</span><span class="n">Handle</span><span class="p">);</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"Successfully subscribed to OrderCreatedEvent"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>

</code></pre></div></div>

<h3 id="modify-appsettingsjson">Modify appsettings.json</h3>
<p>Modify the <code class="language-plaintext highlighter-rouge">appsettings.json</code> as follows to include the database connection string and Kafka configuration.</p>

<p><strong>ProductService/appsettings.json</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"ConnectionStrings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"DefaultConnection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Server=sqlserver,1433;Database=ProductsDB;User Id=sa;Password=YourPassword123!;TrustServerCertificate=True;"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"Kafka"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"BootstrapServers"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kafka:9092"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"TopicPrefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ecommerce"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"GroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"product-service"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"Logging"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"LogLevel"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Information"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Microsoft.AspNetCore"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Warning"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"AllowedHosts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="update-productservicecsproj">Update ProductService.csproj</h3>
<p>Update the <code class="language-plaintext highlighter-rouge">ProductService.csproj</code> file to include the necessary NuGet packages for Entity Framework Core, Swagger, and reference the EventBus project. It also references the shared EventBus project to enable event-driven communication.</p>

<p><strong>ProductService/ProductService.csproj</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk.Web"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>net8.0<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;Nullable&gt;</span>enable<span class="nt">&lt;/Nullable&gt;</span>
    <span class="nt">&lt;ImplicitUsings&gt;</span>enable<span class="nt">&lt;/ImplicitUsings&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Microsoft.AspNetCore.OpenApi"</span> <span class="na">Version=</span><span class="s">"8.0.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Swashbuckle.AspNetCore"</span> <span class="na">Version=</span><span class="s">"6.5.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Microsoft.EntityFrameworkCore"</span> <span class="na">Version=</span><span class="s">"8.0.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Microsoft.EntityFrameworkCore.SqlServer"</span> <span class="na">Version=</span><span class="s">"8.0.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Microsoft.EntityFrameworkCore.Design"</span> <span class="na">Version=</span><span class="s">"8.0.0"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;ProjectReference</span> <span class="na">Include=</span><span class="s">"..\..\..\Shared\EventBus\EventBus\EventBus.csproj"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

<span class="nt">&lt;/Project&gt;</span>

</code></pre></div></div>

<h2 id="step-4-build-order-service">Step 4: Build Order Service</h2>

<h3 id="create-order-model">Create Order Model</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">Order</code> model class that represents the order entity in the Order Service.</p>

<p><strong>OrderService/Models/Order.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System.ComponentModel.DataAnnotations</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">OrderService.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Order</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">ProductId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">StringLength</span><span class="p">(</span><span class="m">100</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">ProductName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="kt">int</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Quantity</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0.01</span><span class="p">,</span> <span class="kt">double</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">UnitPrice</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">0.01</span><span class="p">,</span> <span class="kt">double</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">TotalPrice</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">StringLength</span><span class="p">(</span><span class="m">100</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">CustomerEmail</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        
        <span class="k">public</span> <span class="n">OrderStatus</span> <span class="n">Status</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="n">OrderStatus</span><span class="p">.</span><span class="n">Pending</span><span class="p">;</span>
        
        <span class="k">public</span> <span class="n">DateTime</span> <span class="n">CreatedAt</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">enum</span> <span class="n">OrderStatus</span>
    <span class="p">{</span>
        <span class="n">Pending</span><span class="p">,</span>
        <span class="n">Confirmed</span><span class="p">,</span>
        <span class="n">Cancelled</span><span class="p">,</span>
        <span class="n">Shipped</span><span class="p">,</span>
        <span class="n">Delivered</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="create-productcache-model">Create ProductCache Model</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">ProductCache</code> model class that represents a cached product in the Order Service.</p>

<p><strong>OrderService/Models/ProductCache.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System.ComponentModel.DataAnnotations</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">OrderService.Models</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductCache</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">ProductId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="p">[</span><span class="nf">StringLength</span><span class="p">(</span><span class="m">100</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        
        <span class="p">[</span><span class="nf">StringLength</span><span class="p">(</span><span class="m">500</span><span class="p">)]</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Description</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Price</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        
        <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Stock</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        
        <span class="k">public</span> <span class="n">DateTime</span> <span class="n">LastUpdated</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">;</span>
        
        <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsAvailable</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="create-ordercontext">Create OrderContext</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">OrderContext</code> class that represents the Entity Framework Core database context for the Order Service.</p>

<p><strong>OrderService/Data/OrderContext.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">OrderService.Models</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">OrderService.Data</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">OrderContext</span> <span class="p">:</span> <span class="n">DbContext</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">OrderContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="p">&lt;</span><span class="n">OrderContext</span><span class="p">&gt;</span> <span class="n">options</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;</span> <span class="n">Orders</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">ProductCache</span><span class="p">&gt;</span> <span class="n">ProductCache</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;(</span><span class="n">entity</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">HasKey</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">Property</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">ProductName</span><span class="p">).</span><span class="nf">IsRequired</span><span class="p">().</span><span class="nf">HasMaxLength</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">Property</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">CustomerEmail</span><span class="p">).</span><span class="nf">IsRequired</span><span class="p">().</span><span class="nf">HasMaxLength</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">Property</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">UnitPrice</span><span class="p">).</span><span class="nf">HasColumnType</span><span class="p">(</span><span class="s">"decimal(18,2)"</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">Property</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">TotalPrice</span><span class="p">).</span><span class="nf">HasColumnType</span><span class="p">(</span><span class="s">"decimal(18,2)"</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">Property</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Status</span><span class="p">).</span><span class="n">HasConversion</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">HasIndex</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">CustomerEmail</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">HasIndex</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Status</span><span class="p">);</span>
            <span class="p">});</span>

            <span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="p">&lt;</span><span class="n">ProductCache</span><span class="p">&gt;(</span><span class="n">entity</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">HasKey</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">Property</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Name</span><span class="p">).</span><span class="nf">IsRequired</span><span class="p">().</span><span class="nf">HasMaxLength</span><span class="p">(</span><span class="m">100</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">Property</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Description</span><span class="p">).</span><span class="nf">HasMaxLength</span><span class="p">(</span><span class="m">500</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">Property</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Price</span><span class="p">).</span><span class="nf">HasColumnType</span><span class="p">(</span><span class="s">"decimal(18,2)"</span><span class="p">);</span>
                <span class="n">entity</span><span class="p">.</span><span class="nf">HasIndex</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="create-producteventhandler">Create ProductEventHandler</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">ProductEventHandler</code> class that will handle events from the Product Service. ProductEventHandler is called automatically when a product is created or updated in the ProductService through the event-driven architecture. It is configured in Program.cs file.</p>

<p><strong>OrderService/Services/ProductEventHandler.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">EventBus.Events</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">OrderService.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">OrderService.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">OrderService.Services</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">ProductEventHandler</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">ProductEventHandler</span><span class="p">&gt;</span> <span class="n">_logger</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IServiceScopeFactory</span> <span class="n">_scopeFactory</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">ProductEventHandler</span><span class="p">(</span><span class="n">ILogger</span><span class="p">&lt;</span><span class="n">ProductEventHandler</span><span class="p">&gt;</span> <span class="n">logger</span><span class="p">,</span> <span class="n">IServiceScopeFactory</span> <span class="n">scopeFactory</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_logger</span> <span class="p">=</span> <span class="n">logger</span><span class="p">;</span>
            <span class="n">_scopeFactory</span> <span class="p">=</span> <span class="n">scopeFactory</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ProductCreatedEvent</span> <span class="n">@event</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Product created event received: </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">}</span><span class="s"> - </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            
            <span class="k">using</span> <span class="nn">var</span> <span class="n">scope</span> <span class="p">=</span> <span class="n">_scopeFactory</span><span class="p">.</span><span class="nf">CreateScope</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">OrderContext</span><span class="p">&gt;();</span>
            
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="c1">// Cache the product information locally for faster order processing</span>
                <span class="kt">var</span> <span class="n">cachedProduct</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProductCache</span>
                <span class="p">{</span>
                    <span class="n">ProductId</span> <span class="p">=</span> <span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">,</span>
                    <span class="n">Name</span> <span class="p">=</span> <span class="n">@event</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
                    <span class="n">Description</span> <span class="p">=</span> <span class="s">""</span><span class="p">,</span> <span class="c1">// ProductCreatedEvent doesn't include description</span>
                    <span class="n">Price</span> <span class="p">=</span> <span class="n">@event</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span>
                    <span class="n">Stock</span> <span class="p">=</span> <span class="n">@event</span><span class="p">.</span><span class="n">Stock</span><span class="p">,</span>
                    <span class="n">IsAvailable</span> <span class="p">=</span> <span class="n">@event</span><span class="p">.</span><span class="n">Stock</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">,</span>
                    <span class="n">LastUpdated</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span>
                <span class="p">};</span>

                <span class="n">context</span><span class="p">.</span><span class="n">ProductCache</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">cachedProduct</span><span class="p">);</span>
                <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>
                
                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Product </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">}</span><span class="s"> cached locally. Stock: </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">Stock</span><span class="p">}</span><span class="s">, Available: </span><span class="p">{</span><span class="n">cachedProduct</span><span class="p">.</span><span class="n">IsAvailable</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">$"Error caching product created event for Product </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">ProductUpdatedEvent</span> <span class="n">@event</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Product updated event received: </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">}</span><span class="s"> - </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            
            <span class="k">using</span> <span class="nn">var</span> <span class="n">scope</span> <span class="p">=</span> <span class="n">_scopeFactory</span><span class="p">.</span><span class="nf">CreateScope</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">OrderContext</span><span class="p">&gt;();</span>
            
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="c1">// Update cached product information</span>
                <span class="kt">var</span> <span class="n">cachedProduct</span> <span class="p">=</span> <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">ProductCache</span>
                    <span class="p">.</span><span class="nf">FirstOrDefaultAsync</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">ProductId</span> <span class="p">==</span> <span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">cachedProduct</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">cachedProduct</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">@event</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
                    <span class="n">cachedProduct</span><span class="p">.</span><span class="n">Description</span> <span class="p">=</span> <span class="n">@event</span><span class="p">.</span><span class="n">Description</span><span class="p">;</span>
                    <span class="n">cachedProduct</span><span class="p">.</span><span class="n">Price</span> <span class="p">=</span> <span class="n">@event</span><span class="p">.</span><span class="n">Price</span><span class="p">;</span>
                    <span class="n">cachedProduct</span><span class="p">.</span><span class="n">Stock</span> <span class="p">=</span> <span class="n">@event</span><span class="p">.</span><span class="n">Stock</span><span class="p">;</span>
                    <span class="n">cachedProduct</span><span class="p">.</span><span class="n">IsAvailable</span> <span class="p">=</span> <span class="n">@event</span><span class="p">.</span><span class="n">Stock</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">;</span>
                    <span class="n">cachedProduct</span><span class="p">.</span><span class="n">LastUpdated</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">;</span>

                    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>
                    
                    <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Product </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">}</span><span class="s"> cache updated. Stock: </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">Stock</span><span class="p">}</span><span class="s">, Available: </span><span class="p">{</span><span class="n">cachedProduct</span><span class="p">.</span><span class="n">IsAvailable</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

                    <span class="c1">// Check for price changes and log important business events</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">@event</span><span class="p">.</span><span class="n">Price</span> <span class="p">!=</span> <span class="n">@event</span><span class="p">.</span><span class="n">PreviousPrice</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="n">_logger</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">$"PRICE CHANGE: Product </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">}</span><span class="s"> price changed from $</span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">PreviousPrice</span><span class="p">:</span><span class="n">F2</span><span class="p">}</span><span class="s"> to $</span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">Price</span><span class="p">:</span><span class="n">F2</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                        
                        <span class="c1">// Check pending orders with old price</span>
                        <span class="k">await</span> <span class="nf">CheckPendingOrdersForPriceChanges</span><span class="p">(</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">,</span> <span class="n">@event</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span> <span class="n">@event</span><span class="p">.</span><span class="n">PreviousPrice</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="c1">// Check for stock changes</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">@event</span><span class="p">.</span><span class="n">Stock</span> <span class="p">!=</span> <span class="n">@event</span><span class="p">.</span><span class="n">PreviousStock</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">@event</span><span class="p">.</span><span class="n">Stock</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">$"OUT OF STOCK: Product </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">}</span><span class="s"> is now out of stock"</span><span class="p">);</span>
                            <span class="k">await</span> <span class="nf">CheckPendingOrdersForOutOfStock</span><span class="p">(</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">,</span> <span class="n">context</span><span class="p">);</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">@event</span><span class="p">.</span><span class="n">PreviousStock</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">@event</span><span class="p">.</span><span class="n">Stock</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"BACK IN STOCK: Product </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">}</span><span class="s"> is now available with </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">Stock</span><span class="p">}</span><span class="s"> units"</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">_logger</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">$"Product </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">}</span><span class="s"> not found in cache when processing update event"</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">$"Error processing product updated event for Product </span><span class="p">{</span><span class="n">@event</span><span class="p">.</span><span class="n">ProductId</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">CheckPendingOrdersForPriceChanges</span><span class="p">(</span><span class="kt">int</span> <span class="n">productId</span><span class="p">,</span> <span class="kt">decimal</span> <span class="n">newPrice</span><span class="p">,</span> <span class="kt">decimal</span> <span class="n">oldPrice</span><span class="p">,</span> <span class="n">OrderContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Find pending orders for this product</span>
            <span class="kt">var</span> <span class="n">pendingOrders</span> <span class="p">=</span> <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Orders</span>
                <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="n">o</span><span class="p">.</span><span class="n">ProductId</span> <span class="p">==</span> <span class="n">productId</span> <span class="p">&amp;&amp;</span> <span class="n">o</span><span class="p">.</span><span class="n">Status</span> <span class="p">==</span> <span class="n">OrderStatus</span><span class="p">.</span><span class="n">Pending</span> <span class="p">&amp;&amp;</span> <span class="n">o</span><span class="p">.</span><span class="n">UnitPrice</span> <span class="p">==</span> <span class="n">oldPrice</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">ToListAsync</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">pendingOrders</span><span class="p">.</span><span class="nf">Any</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">$"Found </span><span class="p">{</span><span class="n">pendingOrders</span><span class="p">.</span><span class="n">Count</span><span class="p">}</span><span class="s"> pending orders for Product </span><span class="p">{</span><span class="n">productId</span><span class="p">}</span><span class="s"> with old price $</span><span class="p">{</span><span class="n">oldPrice</span><span class="p">:</span><span class="n">F2</span><span class="p">}</span><span class="s">. New price: $</span><span class="p">{</span><span class="n">newPrice</span><span class="p">:</span><span class="n">F2</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                
                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">order</span> <span class="k">in</span> <span class="n">pendingOrders</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Order </span><span class="p">{</span><span class="n">order</span><span class="p">.</span><span class="n">Id</span><span class="p">}</span><span class="s"> may need price adjustment: ordered at $</span><span class="p">{</span><span class="n">order</span><span class="p">.</span><span class="n">UnitPrice</span><span class="p">:</span><span class="n">F2</span><span class="p">}</span><span class="s">, current price $</span><span class="p">{</span><span class="n">newPrice</span><span class="p">:</span><span class="n">F2</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">CheckPendingOrdersForOutOfStock</span><span class="p">(</span><span class="kt">int</span> <span class="n">productId</span><span class="p">,</span> <span class="n">OrderContext</span> <span class="n">context</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Find pending orders for out-of-stock products</span>
            <span class="kt">var</span> <span class="n">pendingOrders</span> <span class="p">=</span> <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="n">Orders</span>
                <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="n">o</span><span class="p">.</span><span class="n">ProductId</span> <span class="p">==</span> <span class="n">productId</span> <span class="p">&amp;&amp;</span> <span class="n">o</span><span class="p">.</span><span class="n">Status</span> <span class="p">==</span> <span class="n">OrderStatus</span><span class="p">.</span><span class="n">Pending</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">ToListAsync</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">pendingOrders</span><span class="p">.</span><span class="nf">Any</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="n">_logger</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">$"ALERT: Found </span><span class="p">{</span><span class="n">pendingOrders</span><span class="p">.</span><span class="n">Count</span><span class="p">}</span><span class="s"> pending orders for out-of-stock Product </span><span class="p">{</span><span class="n">productId</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
                
                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">order</span> <span class="k">in</span> <span class="n">pendingOrders</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">_logger</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">$"Order </span><span class="p">{</span><span class="n">order</span><span class="p">.</span><span class="n">Id</span><span class="p">}</span><span class="s"> for Product </span><span class="p">{</span><span class="n">productId</span><span class="p">}</span><span class="s"> may need to be cancelled - product out of stock"</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="create-orderscontroller">Create OrdersController</h3>
<p>Create the <code class="language-plaintext highlighter-rouge">OrdersController</code> class that exposes RESTful APIs for managing orders in the Order Service.</p>

<p><strong>OrderService/Controllers/OrdersController.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Mvc</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">OrderService.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">OrderService.Models</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EventBus</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EventBus.Events</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">OrderService.Controllers</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">ApiController</span><span class="p">]</span>
    <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"api/[controller]"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">OrdersController</span> <span class="p">:</span> <span class="n">ControllerBase</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">OrderContext</span> <span class="n">_context</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IEventBus</span> <span class="n">_eventBus</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">OrdersController</span><span class="p">&gt;</span> <span class="n">_logger</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">OrdersController</span><span class="p">(</span><span class="n">OrderContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IEventBus</span> <span class="n">eventBus</span><span class="p">,</span> <span class="n">ILogger</span><span class="p">&lt;</span><span class="n">OrdersController</span><span class="p">&gt;</span> <span class="n">logger</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_context</span> <span class="p">=</span> <span class="n">context</span><span class="p">;</span>
            <span class="n">_eventBus</span> <span class="p">=</span> <span class="n">eventBus</span><span class="p">;</span>
            <span class="n">_logger</span> <span class="p">=</span> <span class="n">logger</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;&gt;&gt;</span> <span class="nf">GetOrders</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Orders</span><span class="p">.</span><span class="nf">ToListAsync</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"{id}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;&gt;</span> <span class="nf">GetOrder</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">order</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Orders</span><span class="p">.</span><span class="nf">FindAsync</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">order</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">order</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="n">HttpPost</span><span class="p">]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;&gt;</span> <span class="nf">CreateOrder</span><span class="p">(</span><span class="n">CreateOrderRequest</span> <span class="n">request</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">order</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Order</span>
            <span class="p">{</span>
                <span class="n">ProductId</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">ProductId</span><span class="p">,</span>
                <span class="n">ProductName</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">ProductName</span><span class="p">,</span>
                <span class="n">Quantity</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">Quantity</span><span class="p">,</span>
                <span class="n">UnitPrice</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">UnitPrice</span><span class="p">,</span>
                <span class="n">TotalPrice</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">Quantity</span> <span class="p">*</span> <span class="n">request</span><span class="p">.</span><span class="n">UnitPrice</span><span class="p">,</span>
                <span class="n">CustomerEmail</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">CustomerEmail</span>
            <span class="p">};</span>

            <span class="n">_context</span><span class="p">.</span><span class="n">Orders</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>

            <span class="c1">// Publish event</span>
            <span class="kt">var</span> <span class="n">orderCreatedEvent</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OrderCreatedEvent</span>
            <span class="p">{</span>
                <span class="n">OrderId</span> <span class="p">=</span> <span class="n">order</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
                <span class="n">ProductId</span> <span class="p">=</span> <span class="n">order</span><span class="p">.</span><span class="n">ProductId</span><span class="p">,</span>
                <span class="n">Quantity</span> <span class="p">=</span> <span class="n">order</span><span class="p">.</span><span class="n">Quantity</span><span class="p">,</span>
                <span class="n">TotalPrice</span> <span class="p">=</span> <span class="n">order</span><span class="p">.</span><span class="n">TotalPrice</span><span class="p">,</span>
                <span class="n">CustomerEmail</span> <span class="p">=</span> <span class="n">order</span><span class="p">.</span><span class="n">CustomerEmail</span>
            <span class="p">};</span>

            <span class="k">await</span> <span class="n">_eventBus</span><span class="p">.</span><span class="nf">PublishAsync</span><span class="p">(</span><span class="n">orderCreatedEvent</span><span class="p">);</span>
            <span class="n">_logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">$"Order created and event published: </span><span class="p">{</span><span class="n">order</span><span class="p">.</span><span class="n">Id</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

            <span class="k">return</span> <span class="nf">CreatedAtAction</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">GetOrder</span><span class="p">),</span> <span class="k">new</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="n">order</span><span class="p">.</span><span class="n">Id</span> <span class="p">},</span> <span class="n">order</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpPut</span><span class="p">(</span><span class="s">"{id}/status"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">IActionResult</span><span class="p">&gt;</span> <span class="nf">UpdateOrderStatus</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="n">UpdateOrderStatusRequest</span> <span class="n">request</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">order</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Orders</span><span class="p">.</span><span class="nf">FindAsync</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">order</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">return</span> <span class="nf">NotFound</span><span class="p">();</span>

            <span class="n">order</span><span class="p">.</span><span class="n">Status</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">Status</span><span class="p">;</span>
            <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="nf">SaveChangesAsync</span><span class="p">();</span>

            <span class="k">return</span> <span class="nf">NoContent</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"product-cache"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;&gt;&gt;</span> <span class="nf">GetCachedProducts</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">cachedProducts</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">ProductCache</span>
                <span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="k">new</span>
                <span class="p">{</span>
                    <span class="n">Id</span> <span class="p">=</span> <span class="n">p</span><span class="p">.</span><span class="n">ProductId</span><span class="p">,</span>  <span class="c1">// Return the actual ProductId from ProductService</span>
                    <span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
                    <span class="n">p</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span>
                    <span class="n">p</span><span class="p">.</span><span class="n">Stock</span><span class="p">,</span>
                    <span class="n">p</span><span class="p">.</span><span class="n">IsAvailable</span><span class="p">,</span>
                    <span class="n">p</span><span class="p">.</span><span class="n">LastUpdated</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="nf">ToListAsync</span><span class="p">();</span>

            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">cachedProducts</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="p">[</span><span class="nf">HttpGet</span><span class="p">(</span><span class="s">"pending-by-product/{productId}"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">ActionResult</span><span class="p">&lt;</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;&gt;&gt;</span> <span class="nf">GetPendingOrdersByProduct</span><span class="p">(</span><span class="kt">int</span> <span class="n">productId</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">orders</span> <span class="p">=</span> <span class="k">await</span> <span class="n">_context</span><span class="p">.</span><span class="n">Orders</span>
                <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="n">o</span><span class="p">.</span><span class="n">ProductId</span> <span class="p">==</span> <span class="n">productId</span> <span class="p">&amp;&amp;</span> <span class="n">o</span><span class="p">.</span><span class="n">Status</span> <span class="p">==</span> <span class="n">OrderStatus</span><span class="p">.</span><span class="n">Pending</span><span class="p">)</span>
                <span class="p">.</span><span class="nf">ToListAsync</span><span class="p">();</span>

            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">orders</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">record</span> <span class="nc">CreateOrderRequest</span><span class="p">(</span>
        <span class="kt">int</span> <span class="n">ProductId</span><span class="p">,</span>
        <span class="kt">string</span> <span class="n">ProductName</span><span class="p">,</span>
        <span class="kt">int</span> <span class="n">Quantity</span><span class="p">,</span>
        <span class="kt">decimal</span> <span class="n">UnitPrice</span><span class="p">,</span>
        <span class="kt">string</span> <span class="n">CustomerEmail</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">record</span> <span class="nc">UpdateOrderStatusRequest</span><span class="p">(</span><span class="n">OrderStatus</span> <span class="n">Status</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="modify-programcs-1">Modify Program.cs</h3>
<p>Modify the <code class="language-plaintext highlighter-rouge">Program.cs</code> as follows to set up the services, database context, and event subscriptions.</p>

<p><strong>OrderService/Program.cs</strong></p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">using</span> <span class="nn">Microsoft.EntityFrameworkCore</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">OrderService.Data</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">OrderService.Services</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EventBus</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">EventBus.Events</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="c1">// Add services to the container</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddControllers</span><span class="p">();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddEndpointsApiExplorer</span><span class="p">();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">AddSwaggerGen</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="n">c</span><span class="p">.</span><span class="nf">SwaggerDoc</span><span class="p">(</span><span class="s">"v1"</span><span class="p">,</span> <span class="k">new</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">OpenApi</span><span class="p">.</span><span class="n">Models</span><span class="p">.</span><span class="n">OpenApiInfo</span>
    <span class="p">{</span>
        <span class="n">Title</span> <span class="p">=</span> <span class="s">"Order Service API"</span><span class="p">,</span>
        <span class="n">Version</span> <span class="p">=</span> <span class="s">"v1"</span><span class="p">,</span>
        <span class="n">Description</span> <span class="p">=</span> <span class="s">"API for managing orders in the microservices demo"</span><span class="p">,</span>
        <span class="n">Contact</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">OpenApi</span><span class="p">.</span><span class="n">Models</span><span class="p">.</span><span class="n">OpenApiContact</span>
        <span class="p">{</span>
            <span class="n">Name</span> <span class="p">=</span> <span class="s">"Order Service Team"</span><span class="p">,</span>
            <span class="n">Email</span> <span class="p">=</span> <span class="s">"orders@microservicesdemo.com"</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Add Entity Framework</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">OrderContext</span><span class="p">&gt;(</span><span class="n">options</span> <span class="p">=&gt;</span>
    <span class="n">options</span><span class="p">.</span><span class="nf">UseSqlServer</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="nf">GetConnectionString</span><span class="p">(</span><span class="s">"DefaultConnection"</span><span class="p">)));</span>

<span class="c1">// Add EventBus and handlers</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">IEventBus</span><span class="p">,</span> <span class="n">KafkaEventBus</span><span class="p">&gt;();</span>
<span class="n">builder</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">AddSingleton</span><span class="p">&lt;</span><span class="n">ProductEventHandler</span><span class="p">&gt;();</span>

<span class="kt">var</span> <span class="n">app</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span>

<span class="c1">// Configure the HTTP request pipeline</span>
<span class="k">if</span> <span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">Environment</span><span class="p">.</span><span class="nf">IsDevelopment</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseSwagger</span><span class="p">();</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">UseSwaggerUI</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="n">c</span><span class="p">.</span><span class="nf">SwaggerEndpoint</span><span class="p">(</span><span class="s">"/swagger/v1/swagger.json"</span><span class="p">,</span> <span class="s">"Order Service API v1"</span><span class="p">);</span>
        <span class="n">c</span><span class="p">.</span><span class="n">RoutePrefix</span> <span class="p">=</span> <span class="s">"swagger"</span><span class="p">;</span>
        <span class="n">c</span><span class="p">.</span><span class="n">DocumentTitle</span> <span class="p">=</span> <span class="s">"Order Service API Documentation"</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="nf">UseAuthorization</span><span class="p">();</span>
<span class="n">app</span><span class="p">.</span><span class="nf">MapControllers</span><span class="p">();</span>

<span class="c1">// Ensure database is created with retry logic</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">scope</span> <span class="p">=</span> <span class="n">app</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="nf">CreateScope</span><span class="p">())</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">OrderContext</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">logger</span> <span class="p">=</span> <span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">ILogger</span><span class="p">&lt;</span><span class="n">Program</span><span class="p">&gt;&gt;();</span>
    
    <span class="kt">var</span> <span class="n">retryCount</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">maxRetries</span> <span class="p">=</span> <span class="m">30</span><span class="p">;</span>
    
    <span class="k">while</span> <span class="p">(</span><span class="n">retryCount</span> <span class="p">&lt;</span> <span class="n">maxRetries</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"Attempting to connect to database, attempt {Attempt}"</span><span class="p">,</span> <span class="n">retryCount</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
            
            <span class="c1">// For demo purposes, we'll recreate the database to ensure schema is current</span>
            <span class="n">context</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="nf">EnsureDeleted</span><span class="p">();</span>
            <span class="n">context</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="nf">EnsureCreated</span><span class="p">();</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"Database connection successful!"</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">retryCount</span><span class="p">++;</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">LogWarning</span><span class="p">(</span><span class="s">"Database connection failed (attempt {Attempt}/{MaxAttempts}): {Error}"</span><span class="p">,</span> <span class="n">retryCount</span><span class="p">,</span> <span class="n">maxRetries</span><span class="p">,</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">retryCount</span> <span class="p">&gt;=</span> <span class="n">maxRetries</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="s">"Failed to connect to database after {MaxAttempts} attempts. Exiting."</span><span class="p">,</span> <span class="n">maxRetries</span><span class="p">);</span>
                <span class="k">throw</span><span class="p">;</span>
            <span class="p">}</span>
            
            <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="nf">Delay</span><span class="p">(</span><span class="m">2000</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Subscribe to events</span>
<span class="k">try</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">eventBus</span> <span class="p">=</span> <span class="n">app</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">IEventBus</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">productEventHandler</span> <span class="p">=</span> <span class="n">app</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="p">&lt;</span><span class="n">ProductEventHandler</span><span class="p">&gt;();</span>
    
    <span class="n">app</span><span class="p">.</span><span class="n">Logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"Setting up event subscriptions..."</span><span class="p">);</span>
    
    <span class="k">await</span> <span class="n">eventBus</span><span class="p">.</span><span class="n">SubscribeAsync</span><span class="p">&lt;</span><span class="n">ProductCreatedEvent</span><span class="p">&gt;(</span><span class="n">productEventHandler</span><span class="p">.</span><span class="n">Handle</span><span class="p">);</span>
    <span class="n">app</span><span class="p">.</span><span class="n">Logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"Subscribed to ProductCreatedEvent"</span><span class="p">);</span>
    
    <span class="k">await</span> <span class="n">eventBus</span><span class="p">.</span><span class="n">SubscribeAsync</span><span class="p">&lt;</span><span class="n">ProductUpdatedEvent</span><span class="p">&gt;(</span><span class="n">productEventHandler</span><span class="p">.</span><span class="n">Handle</span><span class="p">);</span>
    <span class="n">app</span><span class="p">.</span><span class="n">Logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"Subscribed to ProductUpdatedEvent"</span><span class="p">);</span>
    
    <span class="n">app</span><span class="p">.</span><span class="n">Logger</span><span class="p">.</span><span class="nf">LogInformation</span><span class="p">(</span><span class="s">"Event subscriptions setup completed"</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">app</span><span class="p">.</span><span class="n">Logger</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="s">"Failed to setup event subscriptions"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">app</span><span class="p">.</span><span class="nf">Run</span><span class="p">();</span>

</code></pre></div></div>
<h3 id="modify-appsettingsjson-1">Modify appsettings.json</h3>
<p>Modify the <code class="language-plaintext highlighter-rouge">appsettings.json</code> as follows to include the database connection string and Kafka configuration.</p>

<p><strong>OrderService/appsettings.json</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"ConnectionStrings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"DefaultConnection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Server=sqlserver,1433;Database=OrdersDB;User Id=sa;Password=YourPassword123!;TrustServerCertificate=True;"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"Kafka"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"BootstrapServers"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kafka:9092"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"TopicPrefix"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ecommerce"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"GroupId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"order-service"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"Logging"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"LogLevel"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"Default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Debug"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Microsoft.AspNetCore"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Warning"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"EventBus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Debug"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"AllowedHosts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<h3 id="modify-orderservicecsproj">Modify OrderService.csproj</h3>
<p>Modify the <code class="language-plaintext highlighter-rouge">OrderService.csproj</code> file to include the necessary NuGet packages for Entity Framework Core, Swagger, and reference the EventBus project. It also references the shared EventBus project to enable event-driven communication.</p>

<p><strong>OrderService/OrderService.csproj</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;Project</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk.Web"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>net8.0<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;Nullable&gt;</span>enable<span class="nt">&lt;/Nullable&gt;</span>
    <span class="nt">&lt;ImplicitUsings&gt;</span>enable<span class="nt">&lt;/ImplicitUsings&gt;</span>
  <span class="nt">&lt;/PropertyGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Microsoft.AspNetCore.OpenApi"</span> <span class="na">Version=</span><span class="s">"8.0.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Swashbuckle.AspNetCore"</span> <span class="na">Version=</span><span class="s">"6.5.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Microsoft.EntityFrameworkCore"</span> <span class="na">Version=</span><span class="s">"8.0.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Microsoft.EntityFrameworkCore.SqlServer"</span> <span class="na">Version=</span><span class="s">"8.0.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;PackageReference</span> <span class="na">Include=</span><span class="s">"Microsoft.EntityFrameworkCore.Design"</span> <span class="na">Version=</span><span class="s">"8.0.0"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

  <span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;ProjectReference</span> <span class="na">Include=</span><span class="s">"..\..\..\Shared\EventBus\EventBus\EventBus.csproj"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/ItemGroup&gt;</span>

<span class="nt">&lt;/Project&gt;</span>


</code></pre></div></div>

<h2 id="step-5-docker-configuration">Step 5: Docker Configuration</h2>

<h3 id="create-docker-composeyml">Create docker-compose.yml</h3>

<p>Create the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file to define the services, including SQL Server, Zookeeper, Kafka, Product Service, and Order Service. It should be placed in the root directory of your solution.</p>

<p><strong>docker-compose.yml</strong></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># SQL Server</span>
  <span class="na">sqlserver</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mcr.microsoft.com/mssql/server:2022-latest</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">SA_PASSWORD</span><span class="pi">:</span> <span class="s2">"</span><span class="s">YourPassword123!"</span>
      <span class="na">ACCEPT_EULA</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Y"</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">1433:1433"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">sqlserver_data:/var/opt/mssql</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="s">/opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P "YourPassword123!" -C -Q "SELECT 1"</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">3s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">10</span>
      <span class="na">start_period</span><span class="pi">:</span> <span class="s">10s</span>

  <span class="c1"># Zookeeper (required for Kafka)</span>
  <span class="na">zookeeper</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">confluentinc/cp-zookeeper:7.4.0</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">ZOOKEEPER_CLIENT_PORT</span><span class="pi">:</span> <span class="m">2181</span>
      <span class="na">ZOOKEEPER_TICK_TIME</span><span class="pi">:</span> <span class="m">2000</span>

  <span class="c1"># Apache Kafka</span>
  <span class="na">kafka</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">confluentinc/cp-kafka:7.4.0</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">zookeeper</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9092:9092"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">KAFKA_BROKER_ID</span><span class="pi">:</span> <span class="m">1</span>
      <span class="na">KAFKA_ZOOKEEPER_CONNECT</span><span class="pi">:</span> <span class="s">zookeeper:2181</span>
      <span class="na">KAFKA_ADVERTISED_LISTENERS</span><span class="pi">:</span> <span class="s">PLAINTEXT://kafka:9092</span>
      <span class="na">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class="pi">:</span> <span class="m">1</span>
      <span class="na">KAFKA_AUTO_CREATE_TOPICS_ENABLE</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>

  <span class="c1"># Product Service</span>
  <span class="na">productservice</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">src/Services/ProductService/Dockerfile</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5001:8080"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="na">sqlserver</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span>
      <span class="na">kafka</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_started</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ASPNETCORE_ENVIRONMENT=Development</span>
      <span class="pi">-</span> <span class="s">ConnectionStrings__DefaultConnection=Server=sqlserver,1433;Database=ProductsDB;User Id=sa;Password=YourPassword123!;TrustServerCertificate=True;</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">on-failure</span>

  <span class="c1"># Order Service</span>
  <span class="na">orderservice</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">src/Services/OrderService/Dockerfile</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">5002:8080"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="na">sqlserver</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span>
      <span class="na">kafka</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_started</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">ASPNETCORE_ENVIRONMENT=Development</span>
      <span class="pi">-</span> <span class="s">ConnectionStrings__DefaultConnection=Server=sqlserver,1433;Database=OrdersDB;User Id=sa;Password=YourPassword123!;TrustServerCertificate=True;</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">on-failure</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">sqlserver_data</span><span class="pi">:</span>

</code></pre></div></div>
<h3 id="create-dockerfiles-for-product-and-order-services">Create Dockerfiles for Product and Order Services</h3>

<p>Create <code class="language-plaintext highlighter-rouge">Dockerfile</code> for both Product Service and Order Service. Place them in their respective service directories.</p>

<p><strong>src/Services/ProductService/Dockerfile</strong></p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="w"> </span><span class="s">mcr.microsoft.com/dotnet/aspnet:8.0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">base</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">EXPOSE</span><span class="s"> 8080</span>

<span class="k">FROM</span><span class="w"> </span><span class="s">mcr.microsoft.com/dotnet/sdk:8.0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build</span>
<span class="k">WORKDIR</span><span class="s"> /src</span>

<span class="c"># Copy project files</span>
<span class="k">COPY</span><span class="s"> ["src/Services/ProductService/ProductService/ProductService.csproj", "src/Services/ProductService/ProductService/"]</span>
<span class="k">COPY</span><span class="s"> ["src/Shared/EventBus/EventBus/EventBus.csproj", "src/Shared/EventBus/EventBus/"]</span>

<span class="c"># Restore dependencies</span>
<span class="k">RUN </span>dotnet restore <span class="s2">"src/Services/ProductService/ProductService/ProductService.csproj"</span>

<span class="c"># Copy source code</span>
<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">WORKDIR</span><span class="s"> "/src/src/Services/ProductService/ProductService"</span>
<span class="k">RUN </span>dotnet build <span class="s2">"ProductService.csproj"</span> <span class="nt">-c</span> Release <span class="nt">-o</span> /app/build

<span class="k">FROM</span><span class="w"> </span><span class="s">build</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">publish</span>
<span class="k">RUN </span>dotnet publish <span class="s2">"ProductService.csproj"</span> <span class="nt">-c</span> Release <span class="nt">-o</span> /app/publish

<span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">final</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> --from=publish /app/publish .</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["dotnet", "ProductService.dll"]</span>
</code></pre></div></div>

<p><strong>src/Services/OrderService/Dockerfile</strong></p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">FROM</span><span class="w"> </span><span class="s">mcr.microsoft.com/dotnet/aspnet:8.0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">base</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">EXPOSE</span><span class="s"> 8080</span>

<span class="k">FROM</span><span class="w"> </span><span class="s">mcr.microsoft.com/dotnet/sdk:8.0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build</span>
<span class="k">WORKDIR</span><span class="s"> /src</span>

<span class="c"># Copy project files</span>
<span class="k">COPY</span><span class="s"> ["src/Services/OrderService/OrderService/OrderService.csproj", "src/Services/OrderService/OrderService/"]</span>
<span class="k">COPY</span><span class="s"> ["src/Shared/EventBus/EventBus/EventBus.csproj", "src/Shared/EventBus/EventBus/"]</span>

<span class="c"># Restore dependencies</span>
<span class="k">RUN </span>dotnet restore <span class="s2">"src/Services/OrderService/OrderService/OrderService.csproj"</span>

<span class="c"># Copy source code</span>
<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">WORKDIR</span><span class="s"> "/src/src/Services/OrderService/OrderService"</span>
<span class="k">RUN </span>dotnet build <span class="s2">"OrderService.csproj"</span> <span class="nt">-c</span> Release <span class="nt">-o</span> /app/build

<span class="k">FROM</span><span class="w"> </span><span class="s">build</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">publish</span>
<span class="k">RUN </span>dotnet publish <span class="s2">"OrderService.csproj"</span> <span class="nt">-c</span> Release <span class="nt">-o</span> /app/publish

<span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">final</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> --from=publish /app/publish .</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["dotnet", "OrderService.dll"]</span>

</code></pre></div></div>

<h3 id="create-dockerignore-file">Create .dockerignore file</h3>
<p>Create a <code class="language-plaintext highlighter-rouge">.dockerignore</code> file in the root directory to exclude unnecessary files from the Docker build context.
<strong>.dockerignore</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>**/.dockerignore
**/.env
**/.git
**/.gitignore
**/.vs
**/.vscode
**/**/bin
**/**/obj
**/.toolstarget
**/node_modules
**/npm-debug.log
**/Dockerfile*
**/docker-compose*
**/README.md
**/LICENSE
**/CHANGELOG.md
</code></pre></div></div>

<!-- Completed up to  -->

<h2 id="step-6-running-the-application">Step 6: Running the Application</h2>

<h3 id="build-and-run-with-docker-compose">Build and Run with Docker Compose</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Build and start all services</span>
docker-compose up <span class="nt">--build</span>

<span class="c"># Or run in detached mode</span>
docker-compose up <span class="nt">-d</span> <span class="nt">--build</span>
</code></pre></div></div>

<h3 id="verify-services-are-running">Verify Services are Running</h3>

<p>Check that all containers are running:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose ps
</code></pre></div></div>

<p>You should see:</p>
<ul>
  <li>SQL Server running on port 1433</li>
  <li>Kafka and Zookeeper running</li>
  <li>ProductService running on port 5001</li>
  <li>OrderService running on port 5002</li>
</ul>

<p><strong>Note:</strong> Kafka is used for event-driven communication between services. You can use tools like Kafka UI (e.g., Kafdrop, Kafka Manager) to visualize topics and messages. Zookeeper is required for Kafka to manage its cluster state. To set up a Kafka UI, you can add another service in the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file.</p>

<h2 id="step-7-testing-the-microservices">Step 7: Testing the Microservices</h2>

<h3 id="test-product-service">Test Product Service</h3>
<p>After running docker-compose, test the Product Service endpoints. Browse to http://localhost:5001/swagger to access the Swagger UI for Product Service. Now you can create a product with quantity in stock.</p>

<p><strong>Swagger UI:</strong>
<img src="/assets/images/posts/2026/product_service01.png" alt="" /></p>

<p><strong>Create Product:</strong>
<img src="/assets/images/posts/2026/product_service02.png" alt="" /></p>

<h3 id="test-order-service">Test Order Service</h3>
<p><strong>Swagger UI:</strong>
<img src="/assets/images/posts/2026/order_service01.png" alt="" /></p>

<p><strong>Create Order:</strong>
<img src="/assets/images/posts/2026/order_service02.png" alt="" /></p>

<h2 id="step-8-monitoring-kafka-events">Step 8: Monitoring Kafka Events</h2>

<p>You can check if events are being published to Kafka topics:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># List topics</span>
docker <span class="nb">exec</span> <span class="nt">-it</span> &lt;kafka-container-id&gt; kafka-topics <span class="nt">--list</span> <span class="nt">--bootstrap-server</span> localhost:9092

<span class="c"># Monitor events</span>
docker <span class="nb">exec</span> <span class="nt">-it</span> &lt;kafka-container-id&gt; kafka-console-consumer <span class="nt">--bootstrap-server</span> localhost:9092 <span class="nt">--topic</span> ecommerce.ProductCreatedEvent <span class="nt">--from-beginning</span>
</code></pre></div></div>

<h2 id="key-benefits-of-this-architecture">Key Benefits of This Architecture</h2>

<ol>
  <li><strong>Loose Coupling</strong>: Services communicate through events, not direct API calls</li>
  <li><strong>Scalability</strong>: Each service can be scaled independently</li>
  <li><strong>Resilience</strong>: If one service fails, others continue to operate</li>
  <li><strong>Technology Diversity</strong>: Each service can use different technologies</li>
  <li><strong>Database Independence</strong>: Each service has its own database</li>
  <li><strong>Event-Driven</strong>: Asynchronous processing improves performance</li>
</ol>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="common-issues">Common Issues:</h3>

<ol>
  <li><strong>Services can’t connect to SQL Server</strong>: Make sure the connection string is correct and SQL Server container is running</li>
  <li><strong>Kafka connection issues</strong>: Verify Kafka and Zookeeper containers are healthy</li>
  <li><strong>Port conflicts</strong>: Check if ports 1433, 9092, 5001, 5002 are available</li>
  <li><strong>Database creation fails</strong>: Ensure SQL Server is fully initialized before services start</li>
</ol>

<h3 id="useful-docker-commands">Useful Docker Commands:</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># View logs</span>
docker-compose logs productservice
docker-compose logs orderservice

<span class="c"># Stop all services</span>
docker-compose down

<span class="c"># Clean up volumes</span>
docker-compose down <span class="nt">-v</span>

<span class="c"># Rebuild specific service</span>
docker-compose build productservice
</code></pre></div></div>

<h2 id="next-steps">Next Steps</h2>

<p>To extend this application, you could:</p>

<ol>
  <li>Add API Gateway using Ocelot or YARP</li>
  <li>Implement Circuit Breaker pattern with Polly</li>
  <li>Add distributed tracing with OpenTelemetry</li>
  <li>Implement event sourcing</li>
  <li>Add authentication and authorization</li>
  <li>Create a web frontend with React or Angular</li>
  <li>Add monitoring with Prometheus and Grafana</li>
</ol>

<h2 id="conclusion">Conclusion</h2>

<p>In this tutorial, we’ve successfully built a microservices application using ASP.NET Core, Apache Kafka, and Docker. We created two independent services that communicate through events, each with its own database. This architecture provides the foundation for building scalable, maintainable applications.</p>

<p>The event-driven approach using Kafka ensures loose coupling between services while providing reliable message delivery. Docker containers make the application portable and easy to deploy across different environments.</p>

<p>This pattern can be extended to handle more complex business scenarios and larger-scale applications while maintaining the benefits of microservices architecture.</p>

<p>Please leave your comments and suggestions for further improvements! Share this tutorial if you found it helpful. Happy coding!</p>

<p><strong><a href="https://github.com/mahedee/code-sample02/tree/main/MicroservicesDemo">Complete Source Code on GitHub</a></strong></p>


        
        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#aspnetcore" class="page__taxonomy-item" rel="tag">aspnetcore</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#csharp" class="page__taxonomy-item" rel="tag">csharp</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#designpattern" class="page__taxonomy-item" rel="tag">designpattern</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#devops" class="page__taxonomy-item" rel="tag">devops</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#docker" class="page__taxonomy-item" rel="tag">docker</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#dotnet" class="page__taxonomy-item" rel="tag">dotnet</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#microservices" class="page__taxonomy-item" rel="tag">microservices</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#software-architecture" class="page__taxonomy-item" rel="tag">software-architecture</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#asp-net-core" class="page__taxonomy-item" rel="tag">ASP.NET Core</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#docker" class="page__taxonomy-item" rel="tag">Docker</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#microservices" class="page__taxonomy-item" rel="tag">Microservices</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#software-architecture" class="page__taxonomy-item" rel="tag">Software Architecture</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2026-01-26T00:00:00-05:00">January 26, 2026</time></p>
        
      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=How+to+Build+a+Sample+Microservices+Application+Using+ASP.NET+Core%2C+Apache+Kafka%2C+and+Docker%20https%3A%2F%2Fmahedee.net%2Fhow-to-build-microservices-aspnet-core-apache-kafka-docker%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmahedee.net%2Fhow-to-build-microservices-aspnet-core-apache-kafka-docker%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fmahedee.net%2Fhow-to-build-microservices-aspnet-core-apache-kafka-docker%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/implementing-distributed-transactions-saga-pattern-rabbitmq-aspnetcore.md/" class="pagination--pager" title="Implementing Distributed Transactions in Microservices: SAGA Pattern with RabbitMQ and ASP.NET Core
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Comments</h4>
      <div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v18.0&appId=1641495303280571"></script>

<div class="fb-comments" 
     data-href="https://mahedee.net/how-to-build-microservices-aspnet-core-apache-kafka-docker/" 
     data-width="100%" 
     data-numposts="10"
     data-colorscheme="light"
     data-order-by="social"
     data-mobile="true">
</div>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/post_banner01.jpeg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/implementing-distributed-transactions-saga-pattern-rabbitmq-aspnetcore.md/" rel="permalink">Implementing Distributed Transactions in Microservices: SAGA Pattern with RabbitMQ and ASP.NET Core
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  25 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Learn how to implement distributed transactions in microservices using the SAGA choreography pattern with RabbitMQ and ASP.NET Core. This comprehensive guide...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/post_banner01.jpeg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/middleware-in-aspnet-core-why-it-matters-and-how-to-build-custom-middleware/" rel="permalink">Middleware in ASP.NET Core: Why It Matters and How to Build Custom Middleware with a Real-World Examples
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Learn why middleware matters in ASP.NET Core and how to build custom middleware with practical, real-world examples used in modern applications.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/post_banner01.jpeg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/factory-design-pattern-explained-with-10-real-world-use-cases/" rel="permalink">Factory Design Pattern Explained with 10 Real-World Use Cases
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Explore 10 practical real-world applications of the Factory Design Pattern, from payment gateways and notification systems to cloud services and game develop...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/post_banner01.jpeg"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/factory-design-pattern-using-csharp/" rel="permalink">Factory Design Pattern using C# with a real world banking example
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  7 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Learn how to implement the Factory Design Pattern in C# through a practical banking application example. Understand object creation delegation, loose couplin...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>


      <!-- AdSense disabled:
      <ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-3654930341568980"
     data-ad-slot="2244980843"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
     -->

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    <li><i class="fas fa-fw fa-award" aria-hidden="true"></i> <a href = "https://mvp.microsoft.com/en-us/PublicProfile/5001294">MVP Profile</a></li> 
    ||<li><i class="fas fa-fw fa-list-alt" aria-hidden="true"></i> <a href = "/categories/">Categories</a></li>
    ||<li><i class="fas fa-fw fa-code" aria-hidden="true"></i> <a href = "#">Programming</a></li>  
    ||<li><i class="fas fa-fw fa-globe" aria-hidden="true"></i> <a href = "/categories/#asp-net">ASP.NET</a></li> 
    ||<li><a href = "#">AI & ML</a></li>
    ||<li><a href = "#">Javascript</a></li>
    ||<li><a href = "#">Software Architecture</a></li>
    ||<li><a href = "#">Database</a></li>
    ||<li><a href = "#">OOP</a></li>
    ||<li><a href = "#">Design Pattern</a></li>  
    ||<li><a href = "#">Algorithm</a></li>
    ||<li><a href = "#">Interview Tips</a></li>
    ||<li><a href = "#">Opinions</a></li>
    ||<li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2026 Mahedee Hasan. 
  <!-- Powered by  -->
  <!-- <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>. -->
</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '', { 'anonymize_ip': false});
</script>











        <!-- AdSense disabled: Add sense code for all page : added globaly
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3654930341568980"
        crossorigin="anonymous"></script>
        -->

  </body>
</html>
